<!DOCTYPE html>
<!-- saved from url=(0038)https://zhuanlan.zhihu.com/p/607734474 -->
<html lang="zh" data-hairline="true" class="itcauecng" data-theme="light" data-rh="data-theme"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>你需要了解有关C++17中std::variant的全部信息 - 知乎</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="renderer" content="webkit"><meta name="force-rendering" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=10,chrome=1"><meta name="google-site-verification" content="FTeR0c8arOPKh8c5DYh_9uu98_zJbaWw53J-Sch9MTg"><meta data-rh="true" name="keywords" content="C++,C++ STL"><meta data-rh="true" name="description" content="在C++17标准出现之前，有一些神奇的术语，像&amp;#34;discriminated union&amp;#34;，&amp;#34;type-safe union&amp;#34;和&amp;#34;sum type&amp;#34;。后来它们都意味着相同的类型：&amp;#34;variant&amp;#34;。 本文我们将全面介绍C++17中的std:…"><meta data-rh="true" property="og:title" content="你需要了解有关C++17中std::variant的全部信息"><meta data-rh="true" property="og:url" content="https://zhuanlan.zhihu.com/p/607734474"><meta data-rh="true" property="og:description" content="在C++17标准出现之前，有一些神奇的术语，像&amp;#34;discriminated union&amp;#34;，&amp;#34;type-safe union&amp;#34;和&amp;#34;sum type&amp;#34;。后来它们都意味着相同的类型：&amp;#34;variant&amp;#34;。 本文我们将全面介绍C++17中的std:…"><meta data-rh="true" property="og:image" content=""><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="og:site_name" content="知乎专栏"><link data-rh="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-152.81060cab.png"><link data-rh="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-152.81060cab.png" sizes="152x152"><link data-rh="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-120.d5793cac.png" sizes="120x120"><link data-rh="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-76.7abf3393.png" sizes="76x76"><link data-rh="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-60.362a8eac.png" sizes="60x60"><link crossorigin="" rel="shortcut icon" type="image/x-icon" href="https://static.zhihu.com/heifetz/favicon.ico"><link crossorigin="" rel="search" type="application/opensearchdescription+xml" href="https://static.zhihu.com/heifetz/search.xml" title="知乎"><link rel="dns-prefetch" href="https://static.zhimg.com/"><link rel="dns-prefetch" href="https://pica.zhimg.com/"><link rel="dns-prefetch" href="https://picx.zhimg.com/"><link rel="dns-prefetch" href="https://pic1.zhimg.com/"><link rel="dns-prefetch" href="https://pic2.zhimg.com/"><link rel="dns-prefetch" href="https://pic3.zhimg.com/"><link rel="dns-prefetch" href="https://pic4.zhimg.com/"><link rel="dns-prefetch" href="https://static.zhihu.com/"><script nonce="" data-web-reporter-config="{&quot;platform&quot;:&quot;web&quot;,&quot;project&quot;:&quot;heifetz&quot;}">!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).webReporter={})}(this,function(e){"use strict";var t={},n=!1,o=function(){var e,o,r,a,i;return n||(e=document.querySelector("script[data-web-reporter-config]"),o=e&&e.dataset.webReporterConfig||"{}",r=JSON.parse(o),a=r.platform,i=r.project,t={platform:a,project:i},n=!0),t};function r(e){return a(function(){return localStorage.getItem(e)})()}function a(e){return function(){try{return e.apply(void 0,arguments)}catch(e){}}}var i=a(function(e,t){var n={platform:"web",project:o().project,clientTimestamp:+new Date};!function(e,t,n){"1"===r("weber:logenabled")&&console.log("[web-reporter]%o",{type:e,base:t,data:n})}(e,n,t),function(e,t){var n=btoa(JSON.stringify(t));if("undefined"!=typeof Blob&&window.navigator&&window.navigator.sendBeacon){var o=new Blob([n],{type:"text/plain"});navigator.sendBeacon(e,o)}else{var r=new XMLHttpRequest;r.open("POST",e),r.withCredentials=!1,r.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),r.send(n)}}(r("weber:api")||"https://apm.zhihu.com/collector/web_json",{type:e,base:n,data:t})});e.report=i,Object.defineProperty(e,"__esModule",{value:!0})});
</script><link href="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/3978.216a26f4.e99cc2e9a3b9a76d026e.css" crossorigin="" rel="stylesheet"><link href="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/column.216a26f4.b7c9ebb394c3a5813ff6.css" crossorigin="" rel="stylesheet"><link rel="stylesheet" type="text/css" href="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/user-hover-card.216a26f4.114ccd738b474ebe66af.css" crossorigin="anonymous"><link rel="stylesheet" type="text/css" href="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/GoodsRecommendGoodsCardList.216a26f4.d95ce79191cdf8d7ac28.css" crossorigin="anonymous"><link rel="stylesheet" type="text/css" href="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/5622.216a26f4.888fdfb9f9776e6a9ae7.css" crossorigin="anonymous"><link rel="stylesheet" type="text/css" href="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/report_modals.216a26f4.f5c255d74aca8f612bcc.css" crossorigin="anonymous"><link rel="stylesheet" type="text/css" href="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/3280.216a26f4.14fb82be69ab6ed49d76.css" crossorigin="anonymous"><link rel="stylesheet" type="text/css" href="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/ECommerceAd.216a26f4.f500eb4c598fc98e44d8.css" crossorigin="anonymous"><link rel="stylesheet" type="text/css" href="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/1638.216a26f4.e6a691609930a17462cb.css" crossorigin="anonymous"><link rel="stylesheet" type="text/css" href="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/EditableV2.216a26f4.3297c35b9f736388f612.css" crossorigin="anonymous"><script nonce="">!function(){"use strict";!function(e,n){var r=[];function t(e){return function(){r.push([e,arguments])}}n.Raven={captureException:t("captureException"),captureMessage:t("captureMessage"),captureBreadcrumb:t("captureBreadcrumb")};var a,o,c,i,s,u="undefined"!=typeof DOMError;function d(e){var n=e instanceof Error||e instanceof ErrorEvent||u&&e instanceof DOMError||e instanceof DOMException;Raven.captureException(n?e:new Error(e.message||e.reason))}n.addEventListener("unhandledrejection",d),n.addEventListener("error",d,!0),a=e.src,o=e,c=function(){r.forEach(function(e){var n;(n=Raven)[e[0]].apply(n,e[1])}),n.removeEventListener("unhandledrejection",d),n.removeEventListener("error",d,!0)},i=document.head||document.getElementsByTagName("head")[0],(s=document.createElement("script")).crossOrigin=o.crossOrigin,s.dataset.sentryConfig=o["data-sentry-config"],s.onload=c,s.src=a,i.appendChild(s)}({"defer":true,"crossOrigin":"anonymous","src":"https://unpkg.zhimg.com/@cfe/sentry-script@1.3.1/dist/init.js","data-sentry-config":"{\"dsn\":\"https://2d8d764432cc4f6fb3bc78ab9528299d@crash2.zhihu.com/1224\",\"sampleRate\":0.1,\"release\":\"1149-8fa9cf10\",\"ignoreErrorNames\":[\"NetworkError\",\"SecurityError\"],\"ignoreErrorsPreset\":\"ReactApp\",\"tags\":{\"app_name\":\"heifetz\"}}"},window)}();
</script><script crossorigin="anonymous" data-sentry-config="{&quot;dsn&quot;:&quot;https://2d8d764432cc4f6fb3bc78ab9528299d@crash2.zhihu.com/1224&quot;,&quot;sampleRate&quot;:0.1,&quot;release&quot;:&quot;1149-8fa9cf10&quot;,&quot;ignoreErrorNames&quot;:[&quot;NetworkError&quot;,&quot;SecurityError&quot;],&quot;ignoreErrorsPreset&quot;:&quot;ReactApp&quot;,&quot;tags&quot;:{&quot;app_name&quot;:&quot;heifetz&quot;}}" src="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/init.js"></script><style data-emotion-css="55n9hh">.css-55n9hh{position:fixed;top:0;right:0;left:0;z-index:101;display:none;height:2px;pointer-events:none;background:#1772F6;-webkit-transform:translateX(-100%);-ms-transform:translateX(-100%);transform:translateX(-100%);}</style><style data-emotion-css="1l12z7y">.css-1l12z7y{box-shadow:0px 16px 32px rgba(0,0,0,0.04);}</style><style data-emotion-css="1hlrcxk">.css-1hlrcxk{-webkit-transition-property:fill;transition-property:fill;-webkit-transition-duration:0.25s;transition-duration:0.25s;-webkit-transition-timing-function:ease-in;transition-timing-function:ease-in;}</style><style data-emotion-css="icip60">.css-icip60{border-radius:2px;}</style><style data-emotion-css="fnnb9l">.css-fnnb9l{box-sizing:border-box;margin:0;min-width:0;max-width:100%;height:auto;background-color:#ffffff;width:30px;height:30px;border-radius:2px;}</style><style data-emotion-css="uodor8">.css-uodor8{border-radius:50%;}</style><style data-emotion-css="1syywx2">.css-1syywx2{box-sizing:border-box;margin:0;min-width:0;max-width:100%;height:auto;background-color:#ffffff;width:38px;height:38px;border-radius:50%;}</style><style data-emotion-css="1cd9gw4">.css-1cd9gw4{margin-left:.3em;}</style><style data-emotion-css="1nt4zps">.css-1nt4zps{box-sizing:border-box;margin:0;min-width:0;color:#093e8b;display:inline-block;margin-left:.3em;}</style><style data-emotion-css="18biwo">.css-18biwo{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><style data-emotion-css="1ifz0go">.css-1ifz0go{overflow:visible!important;}</style><style data-emotion-css="1yuhvjn">.css-1yuhvjn{margin-top:16px;}</style><style data-emotion-css="376mun">.css-376mun{position:relative;display:inline;}</style><style data-emotion-css="1dlndns">.css-1dlndns{position:absolute;left:NaNpx;top:0;}</style><style data-emotion-css="ldd79s">.css-ldd79s{box-sizing:border-box;margin:0;min-width:0;position:absolute;left:NaNpx;top:0;}</style><style data-emotion-css="dg64xe">.css-dg64xe .FileLinkCard{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(248,248,250,0.88);border-radius:12px;box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:1em auto;max-width:100%;overflow:hidden;padding:12px;position:relative;width:390px;}.css-dg64xe .FileLinkCard-icon{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;height:30px;width:30px;}.css-dg64xe .FileLinkCard-info{margin-left:12px;}.css-dg64xe .FileLinkCard-name{color:#191B1F;font-size:15px;font-weight:500;line-height:21px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-dg64xe .FileLinkCard-meta{color:#9196a1;font-size:12px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;line-height:14px;margin-top:5px;}.css-dg64xe .FileLinkCard-source{white-space:pre;}.css-dg64xe img[data-uncomfortable]{content:url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20344.88888888888886%20194%22%3E%3CforeignObject%20width%3D%22344.88888888888886%22%20height%3D%22194%22%3E%0A%20%20%20%20%20%20%3Cdiv%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%20style%3D%22font-size%3A%2013px%3B%20font-family%3A%20-apple-system%2C%20BlinkMacSystemFont%2C%20Microsoft%20YaHei%2C%20sans-serif%3B%20color%3A%20%23fff%3B%20width%3A100%25%3B%20height%3A194px%3B%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20style%3D%22display%3A%20flex%3B%20flex-direction%3A%20column%3B%20align-items%3A%20center%3B%20justify-content%3A%20center%3B%20height%3A%20100%25%3B%22%3E%0A%20%20%20%20%20%20%20%20%20%20%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2218%22%20height%3D%2218%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22currentColor%22%3E%3Cpath%20d%3D%22M8%203.65a7%207%200%2000-1.353.128.65.65%200%2011-.25-1.275A8.3%208.3%200%20018%202.35c2.387%200%204.172.954%205.357%202.125C14.511%205.615%2015.15%207.022%2015.15%208c0%20.621-.257%201.391-.699%202.134a7.076%207.076%200%2001-1.403%201.68l.495.46a.65.65%200%2011-.886.951l-.998-.929a.645.645%200%2001-.104-.097L9.73%2010.501a.647.647%200%2001-.29.301%203.15%203.15%200%2001-4.313-4.094.647.647%200%2001.234-.275L3.908%205.08a5.774%205.774%200%2000-1.283%201.522C2.282%207.198%202.15%207.707%202.15%208c0%20.522.41%201.616%201.407%202.6.965.954%202.43%201.75%204.443%201.75.468%200%20.905-.043%201.311-.12a.65.65%200%2001.243%201.277A8.322%208.322%200%20018%2013.65c-2.387%200-4.172-.954-5.357-2.125C1.49%2010.385.85%208.978.85%208c0-.598.238-1.333.648-2.046A7.054%207.054%200%20012.95%204.188l-.547-.509a.65.65%200%2011.886-.951l8.8%208.194a5.793%205.793%200%20001.244-1.453c.372-.624.516-1.163.516-1.469%200-.522-.41-1.616-1.407-2.6-.965-.954-2.43-1.75-4.443-1.75zM6.29%207.296a1.85%201.85%200%20002.534%202.36l-2.535-2.36zM8%204.85a.65.65%200%20100%201.3%201.85%201.85%200%20011.843%201.694.65.65%200%20101.296-.11A3.15%203.15%200%20008%204.85z%22%20fill-rule%3D%22evenodd%22%20clip-rule%3D%22evenodd%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E%0A%20%20%20%20%20%20%20%20%20%20%3Cdiv%20style%3D%22margin%3A%20.6em%200%201.2em%22%3E%E8%AF%A5%E5%9B%BE%E7%89%87%E6%9C%89%E5%8F%AF%E8%83%BD%E4%BC%9A%E5%BC%95%E8%B5%B7%E4%B8%8D%E9%80%82%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%20%20%3Cbutton%20style%3D%22padding%3A%204px%201em%3B%20font-size%3A%201.1em%3B%20color%3A%20inherit%3B%20background%3A%20none%3B%20border%3A%201px%20solid%20rgba%28255%2C255%2C255%2C.5%29%3B%20border-radius%3A%209999px%3B%22%3E%E7%BB%A7%E7%BB%AD%E6%9F%A5%E7%9C%8B%3C%2Fbutton%3E%0A%20%20%20%20%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3C%2FforeignObject%3E%3C%2Fsvg%3E);width:100%;height:194px;background:url(https://pic1.zhimg.com/v2-cf70d0759d787c70091857151c1cad4a.jpeg) no-repeat rgba(191,191,191,0.7);background-size:cover;cursor:pointer!important;}.css-dg64xe img.content_image[data-size="normal"],.css-dg64xe img.origin_image[data-size="normal"]{width:100%;max-width:100%;}.css-dg64xe img.content_image[data-size="small"],.css-dg64xe img.origin_image[data-size="small"]{width:320px;max-width:100%;}</style><style data-emotion-css="1vqsdx1">.css-1vqsdx1 .LinkCard.new{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;box-sizing:border-box;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:390px;min-height:84px;border-radius:8px;max-width:100%;overflow:hidden;margin:16px auto;padding:12px 12px 9px 12px;background-color:#f8f8fa;}.css-1vqsdx1 .LinkCard.new,.css-1vqsdx1 .LinkCard.new:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-1vqsdx1 .LinkCard.new .LinkCard-contents{display:block;-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;position:relative;}.css-1vqsdx1 .LinkCard.new .LinkCard-contents .loading{height:14px;background:#ebeced;border-radius:7px;}.css-1vqsdx1 .LinkCard.new .LinkCard-contents.withTitle{margin-bottom:3px;}.css-1vqsdx1 .LinkCard.new .LinkCard-title{display:-webkit-box;font-size:15px;font-weight:500;line-height:1.4;margin-bottom:2px;color:#191B1F;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-1vqsdx1 .LinkCard.new .LinkCard-title.two-line{line-height:20px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-1vqsdx1 .LinkCard.new .LinkCard-title.loading{margin-bottom:8px;width:80%;}.css-1vqsdx1 .LinkCard.new .LinkCard-title.loading.withTitle{margin-bottom:6px;}.css-1vqsdx1 .LinkCard.new .LinkCard-title.loadingTitle{margin-bottom:5px;}.css-1vqsdx1 .LinkCard.new .LinkCard-excerpt{display:-webkit-box;text-overflow:ellipsis;font-size:13px;line-height:18px;color:#9196a1;margin-bottom:4px;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-1vqsdx1 .LinkCard.new .LinkCard-excerpt .LinkCard-author{color:#373a40;}.css-1vqsdx1 .LinkCard.new .LinkCard-desc{display:-webkit-box;font-size:13px;height:18px;line-height:18px;color:#9196a1;word-break:break-all;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-1vqsdx1 .LinkCard.new .LinkCard-desc .LinkCard-tag,.css-1vqsdx1 .LinkCard.new .LinkCard-desc .tag{display:inline-block;font-size:11px;margin-left:8px;padding:0 4px;border-radius:3px;background:rgba(196,199,206,0.3);}.css-1vqsdx1 .LinkCard.new .LinkCard-desc.loading{width:40%;}.css-1vqsdx1 .LinkCard.new .LinkCard-desc svg{margin-right:2px;}.css-1vqsdx1 .LinkCard.new .LinkCard-image{-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;background-color:#ebeced;background-size:cover;background-position:center;position:relative;display:block;width:60px;height:60px;margin-left:20px;object-fit:cover;border-radius:inherit;overflow:hidden;}.css-1vqsdx1 .LinkCard.new .LinkCard-image.LinkCard-image--default{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;background-color:#ebeced;color:#c4c7ce;}.css-1vqsdx1 .LinkCard.new .LinkCard-image.LinkCard-image--default svg{color:#9196a1;}.css-1vqsdx1 .LinkCard.new .LinkCard-image img{width:100%;height:100%;object-fit:cover;}.css-1vqsdx1 .LinkCard.new .LinkCard-image .LinkCard-image--video{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;position:absolute;top:50%;left:50%;-webkit-transform:translateX(-50%) translateY(-50%);-ms-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);width:24px;height:24px;border-radius:12px;background:rgba(255,255,255,0.9);pointer-events:none;}.css-1vqsdx1 .LinkCard.new .LinkCard-image .LinkCard-image--video svg{color:#373a40;}.css-1vqsdx1 .LinkCard.new .LinkCard-richText .text{color:#373a40;}.css-1vqsdx1 .LinkCard.new .LinkCard-richText .bold{font-weight:600;}.css-1vqsdx1 .LinkCard.new .LinkCard-richText .tag{margin-left:4px;}.css-1vqsdx1 .LinkCard.old{position:relative;display:block;margin:1em auto;width:390px;box-sizing:border-box;border-radius:12px;max-width:100%;overflow:hidden;}.css-1vqsdx1 .LinkCard.old,.css-1vqsdx1 .LinkCard.old:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-1vqsdx1 .LinkCard-ecommerceLoadingCard{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;padding:12px;border-radius:inherit;height:80px;box-sizing:border-box;background:rgba(248,248,250,0.88);color:#c4c7ce;}.css-1vqsdx1 .LinkCard-ecommerceLoadingCardAvatarWrapper{width:60px;height:60px;background:#ebeced;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:6px;margin-right:10px;}.css-1vqsdx1 .LinkCard-ecommerceLoadingCardNetwork{width:20px;height:20px;}.css-1vqsdx1 .LinkCard-ecommerceLoadingCardLoadingbar{height:60px;-webkit-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}.css-1vqsdx1 .LinkCard-ecommerceLoadingCardLoadingbar span{height:16px;display:inline-block;background:#ebeced;}.css-1vqsdx1 .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(1){width:60px;margin-bottom:4px;}.css-1vqsdx1 .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(2){width:127px;}</style><style data-emotion-css="yxro2d">.css-yxro2d .LinkCard.old{position:relative;display:block;margin:1em auto;width:390px;box-sizing:border-box;border-radius:12px;max-width:100%;overflow:hidden;}.css-yxro2d .LinkCard.old,.css-yxro2d .LinkCard.old:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-yxro2d .LinkCard-ecommerceLoadingCard{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;padding:12px;border-radius:inherit;height:80px;box-sizing:border-box;background:rgba(248,248,250,0.88);color:#c4c7ce;}.css-yxro2d .LinkCard-ecommerceLoadingCardAvatarWrapper{width:60px;height:60px;background:#ebeced;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:6px;margin-right:10px;}.css-yxro2d .LinkCard-ecommerceLoadingCardNetwork{width:20px;height:20px;}.css-yxro2d .LinkCard-ecommerceLoadingCardLoadingbar{height:60px;-webkit-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}.css-yxro2d .LinkCard-ecommerceLoadingCardLoadingbar span{height:16px;display:inline-block;background:#ebeced;}.css-yxro2d .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(1){width:60px;margin-bottom:4px;}.css-yxro2d .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(2){width:127px;}.css-yxro2d .LinkCard.new{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;box-sizing:border-box;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:390px;min-height:84px;border-radius:8px;max-width:100%;overflow:hidden;margin:16px auto;padding:12px 12px 9px 12px;background-color:#f8f8fa;}.css-yxro2d .LinkCard.new,.css-yxro2d .LinkCard.new:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-yxro2d .LinkCard.new .LinkCard-contents{display:block;-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;position:relative;}.css-yxro2d .LinkCard.new .LinkCard-contents .loading{height:14px;background:#ebeced;border-radius:7px;}.css-yxro2d .LinkCard.new .LinkCard-contents.withTitle{margin-bottom:3px;}.css-yxro2d .LinkCard.new .LinkCard-title{display:-webkit-box;font-size:15px;font-weight:500;line-height:1.4;margin-bottom:2px;color:#191B1F;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-yxro2d .LinkCard.new .LinkCard-title.two-line{line-height:20px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-yxro2d .LinkCard.new .LinkCard-title.loading{margin-bottom:8px;width:80%;}.css-yxro2d .LinkCard.new .LinkCard-title.loading.withTitle{margin-bottom:6px;}.css-yxro2d .LinkCard.new .LinkCard-title.loadingTitle{margin-bottom:5px;}.css-yxro2d .LinkCard.new .LinkCard-excerpt{display:-webkit-box;text-overflow:ellipsis;font-size:13px;line-height:18px;color:#9196a1;margin-bottom:4px;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-yxro2d .LinkCard.new .LinkCard-excerpt .LinkCard-author{color:#373a40;}.css-yxro2d .LinkCard.new .LinkCard-desc{display:-webkit-box;font-size:13px;height:18px;line-height:18px;color:#9196a1;word-break:break-all;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-yxro2d .LinkCard.new .LinkCard-desc .LinkCard-tag,.css-yxro2d .LinkCard.new .LinkCard-desc .tag{display:inline-block;font-size:11px;margin-left:8px;padding:0 4px;border-radius:3px;background:rgba(196,199,206,0.3);}.css-yxro2d .LinkCard.new .LinkCard-desc.loading{width:40%;}.css-yxro2d .LinkCard.new .LinkCard-desc svg{margin-right:2px;}.css-yxro2d .LinkCard.new .LinkCard-image{-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;background-color:#ebeced;background-size:cover;background-position:center;position:relative;display:block;width:60px;height:60px;margin-left:20px;object-fit:cover;border-radius:inherit;overflow:hidden;}.css-yxro2d .LinkCard.new .LinkCard-image.LinkCard-image--default{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;background-color:#ebeced;color:#c4c7ce;}.css-yxro2d .LinkCard.new .LinkCard-image.LinkCard-image--default svg{color:#9196a1;}.css-yxro2d .LinkCard.new .LinkCard-image img{width:100%;height:100%;object-fit:cover;}.css-yxro2d .LinkCard.new .LinkCard-image .LinkCard-image--video{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;position:absolute;top:50%;left:50%;-webkit-transform:translateX(-50%) translateY(-50%);-ms-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);width:24px;height:24px;border-radius:12px;background:rgba(255,255,255,0.9);pointer-events:none;}.css-yxro2d .LinkCard.new .LinkCard-image .LinkCard-image--video svg{color:#373a40;}.css-yxro2d .LinkCard.new .LinkCard-richText .text{color:#373a40;}.css-yxro2d .LinkCard.new .LinkCard-richText .bold{font-weight:600;}.css-yxro2d .LinkCard.new .LinkCard-richText .tag{margin-left:4px;}.css-yxro2d .FileLinkCard{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(248,248,250,0.88);border-radius:12px;box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:1em auto;max-width:100%;overflow:hidden;padding:12px;position:relative;width:390px;}.css-yxro2d .FileLinkCard-icon{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;height:30px;width:30px;}.css-yxro2d .FileLinkCard-info{margin-left:12px;}.css-yxro2d .FileLinkCard-name{color:#191B1F;font-size:15px;font-weight:500;line-height:21px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-yxro2d .FileLinkCard-meta{color:#9196a1;font-size:12px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;line-height:14px;margin-top:5px;}.css-yxro2d .FileLinkCard-source{white-space:pre;}.css-yxro2d img[data-uncomfortable]{content:url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20344.88888888888886%20194%22%3E%3CforeignObject%20width%3D%22344.88888888888886%22%20height%3D%22194%22%3E%0A%20%20%20%20%20%20%3Cdiv%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%20style%3D%22font-size%3A%2013px%3B%20font-family%3A%20-apple-system%2C%20BlinkMacSystemFont%2C%20Microsoft%20YaHei%2C%20sans-serif%3B%20color%3A%20%23fff%3B%20width%3A100%25%3B%20height%3A194px%3B%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20style%3D%22display%3A%20flex%3B%20flex-direction%3A%20column%3B%20align-items%3A%20center%3B%20justify-content%3A%20center%3B%20height%3A%20100%25%3B%22%3E%0A%20%20%20%20%20%20%20%20%20%20%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2218%22%20height%3D%2218%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22currentColor%22%3E%3Cpath%20d%3D%22M8%203.65a7%207%200%2000-1.353.128.65.65%200%2011-.25-1.275A8.3%208.3%200%20018%202.35c2.387%200%204.172.954%205.357%202.125C14.511%205.615%2015.15%207.022%2015.15%208c0%20.621-.257%201.391-.699%202.134a7.076%207.076%200%2001-1.403%201.68l.495.46a.65.65%200%2011-.886.951l-.998-.929a.645.645%200%2001-.104-.097L9.73%2010.501a.647.647%200%2001-.29.301%203.15%203.15%200%2001-4.313-4.094.647.647%200%2001.234-.275L3.908%205.08a5.774%205.774%200%2000-1.283%201.522C2.282%207.198%202.15%207.707%202.15%208c0%20.522.41%201.616%201.407%202.6.965.954%202.43%201.75%204.443%201.75.468%200%20.905-.043%201.311-.12a.65.65%200%2001.243%201.277A8.322%208.322%200%20018%2013.65c-2.387%200-4.172-.954-5.357-2.125C1.49%2010.385.85%208.978.85%208c0-.598.238-1.333.648-2.046A7.054%207.054%200%20012.95%204.188l-.547-.509a.65.65%200%2011.886-.951l8.8%208.194a5.793%205.793%200%20001.244-1.453c.372-.624.516-1.163.516-1.469%200-.522-.41-1.616-1.407-2.6-.965-.954-2.43-1.75-4.443-1.75zM6.29%207.296a1.85%201.85%200%20002.534%202.36l-2.535-2.36zM8%204.85a.65.65%200%20100%201.3%201.85%201.85%200%20011.843%201.694.65.65%200%20101.296-.11A3.15%203.15%200%20008%204.85z%22%20fill-rule%3D%22evenodd%22%20clip-rule%3D%22evenodd%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E%0A%20%20%20%20%20%20%20%20%20%20%3Cdiv%20style%3D%22margin%3A%20.6em%200%201.2em%22%3E%E8%AF%A5%E5%9B%BE%E7%89%87%E6%9C%89%E5%8F%AF%E8%83%BD%E4%BC%9A%E5%BC%95%E8%B5%B7%E4%B8%8D%E9%80%82%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%20%20%3Cbutton%20style%3D%22padding%3A%204px%201em%3B%20font-size%3A%201.1em%3B%20color%3A%20inherit%3B%20background%3A%20none%3B%20border%3A%201px%20solid%20rgba%28255%2C255%2C255%2C.5%29%3B%20border-radius%3A%209999px%3B%22%3E%E7%BB%A7%E7%BB%AD%E6%9F%A5%E7%9C%8B%3C%2Fbutton%3E%0A%20%20%20%20%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3C%2FforeignObject%3E%3C%2Fsvg%3E);width:100%;height:194px;background:url(https://pic1.zhimg.com/v2-cf70d0759d787c70091857151c1cad4a.jpeg) no-repeat rgba(191,191,191,0.7);background-size:cover;cursor:pointer!important;}.css-yxro2d img.content_image[data-size="normal"],.css-yxro2d img.origin_image[data-size="normal"]{width:100%;max-width:100%;}.css-yxro2d img.content_image[data-size="small"],.css-yxro2d img.origin_image[data-size="small"]{width:320px;max-width:100%;}</style><style data-emotion-css="olurbu animation-1yvu044">.css-olurbu{word-break:break-word;line-height:1.6;}.css-olurbu > [data-first-child]{margin-top:0;}.css-olurbu > :last-child{margin-bottom:0;}.css-olurbu h1,.css-olurbu h2{clear:left;margin-top:calc((1.4em * 2) / 1.2);margin-bottom:calc(1.4em / 1.2);font-size:1.2em;line-height:1.5;font-weight:600;}.css-olurbu h3,.css-olurbu h4,.css-olurbu h5,.css-olurbu h6{clear:left;margin-top:calc((1.4em * 1.5) / 1.1);margin-bottom:calc(1.4em / 1.1);font-size:1.1em;line-height:1.5;font-weight:600;}.css-olurbu u{-webkit-text-decoration:none;text-decoration:none;border-bottom:1px solid #373a40;}.css-olurbu b{font-weight:600;}.css-olurbu sup{font-size:0.8em;}.css-olurbu sup[data-draft-type='reference']{color:#093e8b;}.css-olurbu a:focus{outline:none;-webkit-transition:box-shadow 0.3s;transition:box-shadow 0.3s;}html[data-focus-visible] .css-olurbu a:focus{box-shadow:0 0 0 2px #ffffff,0 0 0 4px rgba(23,114,246,0.3);}.css-olurbu a.ztext-link,.css-olurbu a.internal,.css-olurbu a.external{-webkit-text-decoration:none;text-decoration:none;cursor:pointer;border-bottom:1px solid #81858f;}.css-olurbu a.ztext-link:hover,.css-olurbu a.internal:hover,.css-olurbu a.external:hover{color:#093e8b;border-bottom:1px solid #093e8b;}.css-olurbu a.ztext-link > .ellipsis::after,.css-olurbu a.internal > .ellipsis::after,.css-olurbu a.external > .ellipsis::after{content:'...';}.css-olurbu a.ztext-link > .invisible,.css-olurbu a.internal > .invisible,.css-olurbu a.external > .invisible{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;}.css-olurbu a.ztext-link u,.css-olurbu a.internal u,.css-olurbu a.external u{border:none;}.css-olurbu a.member_mention{color:#093e8b;}.css-olurbu a.member_mention:hover{border-bottom:1px solid #093e8b;}.css-olurbu a.UserLink-link{color:#093e8b;}.css-olurbu a.UserLink-link:hover{border-bottom:1px solid #093e8b;}.css-olurbu p{margin:1.4em 0;}.css-olurbu p.ztext-empty-paragraph{margin:calc((2.8em- (1.4em * 2 + 1.6em)) / 2) 0;}.css-olurbu p.ztext-empty-paragraph + .ztext-empty-paragraph{margin:1.4em 0;}.css-olurbu hr{margin:4em auto;width:240px;max-width:100%;border:none;border-top:1px solid #c4c7ce;}.css-olurbu img[eeimg]{max-width:100%;vertical-align:middle;}.css-olurbu img[eeimg="1"]{margin:0 3px;max-width:calc(100% - 6px);display:inline-block;}.css-olurbu img[eeimg="2"]{margin:1.4em auto;display:block;}.css-olurbu blockquote{margin:1.4em 0;padding-left:1em;color:#535861;border-left:3px solid #c4c7ce;}.css-olurbu ol,.css-olurbu ul{margin:1.4em 0;padding:0;width:100%;}.css-olurbu ol ol,.css-olurbu ul ol,.css-olurbu ol ul,.css-olurbu ul ul{margin:0;}.css-olurbu ol li::before,.css-olurbu ul li::before{width:1em;}.css-olurbu ol > ol,.css-olurbu ul > ol,.css-olurbu ol > ul,.css-olurbu ul > ul{display:table-row;}.css-olurbu ol > ol::before,.css-olurbu ul > ol::before,.css-olurbu ol > ul::before,.css-olurbu ul > ul::before{display:table-cell;content:'';}.css-olurbu ul{display:table;}.css-olurbu ul>li{display:table-row;list-style:none;}.css-olurbu ul>li::before{display:table-cell;content:'•  ';white-space:pre;}.css-olurbu ol{display:table;counter-reset:ol;}.css-olurbu ol > li{display:table-row;list-style:none;}.css-olurbu ol > li::before{display:table-cell;text-align:right;counter-increment:ol;content:counter(ol) '. ';white-space:pre;}.css-olurbu ol ol{counter-reset:ol2;}.css-olurbu ol ol li::before{counter-increment:ol2;content:counter(ol2) '. ';}.css-olurbu ol ol ol{counter-reset:ol3;}.css-olurbu ol ol ol li::before{counter-increment:ol3;content:counter(ol3) '. ';}.css-olurbu ol ol ol ol{counter-reset:ol4;}.css-olurbu ol ol ol ol li::before{counter-increment:ol4;content:counter(ol4) '. ';}.css-olurbu figure{margin:1.4em 0;}.css-olurbu figure .content_image,.css-olurbu figure .origin_image{margin:0 auto;}.css-olurbu figure figcaption{margin-top:calc(0.6em / 0.9);padding:0 1em;font-size:0.9em;line-height:1.5;text-align:center;color:#9196a1;}.css-olurbu figure + figure{margin-top:calc(1.4em * 1.6);}.css-olurbu figure[data-size='small'],.css-olurbu figure:not([data-size]) > [data-size='small']{clear:both;}.css-olurbu figure[data-size='left'],.css-olurbu figure:not([data-size]) > [data-size='left']{float:left;margin:0 20px 20px 0;max-width:33%;}.css-olurbu figure[data-size='right'],.css-olurbu figure:not([data-size]) > [data-size='right']{float:right;margin:0 0 20px 20px;max-width:33%;}.css-olurbu figure[data-size='collapse']{margin-bottom:0;}.css-olurbu figure[data-size='collapse'] + figure{margin-top:0;}.css-olurbu .content_image,.css-olurbu .origin_image{display:block;max-width:100%;height:auto;margin:1.4em auto;}.css-olurbu .content_image[data-size='small'],.css-olurbu .origin_image[data-size='small']{max-width:40%;}.css-olurbu .content_image.zh-lightbox-thumb,.css-olurbu .origin_image.zh-lightbox-thumb{cursor:-webkit-zoom-in;cursor:-moz-zoom-in;cursor:zoom-in;}.css-olurbu code{margin:0 2px;padding:3px 4px;border-radius:3px;font-family:Menlo,Monaco,Consolas,'Andale Mono','lucida console','Courier New',monospace;font-size:0.9em;background-color:#f8f8fa;}.css-olurbu pre{margin:1.4em 0;padding:calc(0.8em / 0.9);font-size:0.9em;word-break:initial;word-wrap:initial;white-space:pre;overflow:auto;-webkit-overflow-scrolling:touch;background:#f8f8fa;border-radius:4px;}.css-olurbu pre code{margin:0;padding:0;font-size:inherit;border-radius:0;background-color:inherit;}.css-olurbu li pre{white-space:pre-wrap;}.css-olurbu table[data-draft-type='table']{border-collapse:collapse;font-size:15px;margin:1.4em auto;max-width:100%;table-layout:fixed;text-align:left;width:100%;}.css-olurbu table[data-draft-type='table'][data-size='small']{min-width:260px;width:40%;}.css-olurbu table[data-draft-type='table'][data-row-style='striped'] tr:nth-of-type(2n + 1){background:#f8f8fa;}.css-olurbu table[data-draft-type='table'] td,.css-olurbu table[data-draft-type='table'] th{border:1px solid #c4c7ce;line-height:24px;height:24px;padding:3px 12px;}.css-olurbu table[data-draft-type='table'] th{background:#ebeced;color:#191B1F;font-weight:500;}.css-olurbu .video-box,.css-olurbu .link-box{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;margin:1.4em 0;overflow:auto;white-space:normal;cursor:pointer;border:solid 1px #ebeced;border-radius:4px;}.css-olurbu .lazy[data-lazy-status]{background-color:#f8f8fa;}.css-olurbu .lazy[data-lazy-status="ok"]{background-color:transparent;-webkit-animation:animation-1yvu044 0.5s ease-in;animation:animation-1yvu044 0.5s ease-in;}.css-olurbu .highlight{margin:1em 0;}.css-olurbu .highlight pre{margin:0;}.css-olurbu .highlight .hll{background-color:#f8f8fa;}.css-olurbu .highlight .c{font-style:italic;color:#9196a1;}.css-olurbu .highlight .err{color:#D95350;}.css-olurbu .highlight .k{font-weight:600;}.css-olurbu .highlight .o{font-weight:600;}.css-olurbu .highlight .cm{font-style:italic;color:#9196a1;}.css-olurbu .highlight .cp{font-weight:600;color:#9196a1;}.css-olurbu .highlight .c1{font-style:italic;color:#9196a1;}.css-olurbu .highlight .cs{font-style:italic;font-weight:600;color:#9196a1;}.css-olurbu .highlight .gd{color:#F05159;}.css-olurbu .highlight .ge{font-style:italic;}.css-olurbu .highlight .gr{color:#D95350;}.css-olurbu .highlight .gh{color:#9196a1;}.css-olurbu .highlight .gi{color:#12b370;}.css-olurbu .highlight .go{color:#81858f;}.css-olurbu .highlight .gp{color:#535861;}.css-olurbu .highlight .gs{font-weight:600;}.css-olurbu .highlight .gu{color:#9196a1;}.css-olurbu .highlight .gt{color:#D95350;}.css-olurbu .highlight .kc{font-weight:600;}.css-olurbu .highlight .kd{font-weight:600;}.css-olurbu .highlight .kn{font-weight:600;}.css-olurbu .highlight .kp{font-weight:600;}.css-olurbu .highlight .kr{font-weight:600;}.css-olurbu .highlight .kt{font-weight:600;color:#093e8b;}.css-olurbu .highlight .m{color:#1772F6;}.css-olurbu .highlight .s{color:#D95350;}.css-olurbu .highlight .na{color:#1772F6;}.css-olurbu .highlight .nb{color:#1772F6;}.css-olurbu .highlight .nc{font-weight:600;color:#093e8b;}.css-olurbu .highlight .no{color:#1772F6;}.css-olurbu .highlight .ni{color:#6A5FF3;}.css-olurbu .highlight .ne{font-weight:600;color:#D95350;}.css-olurbu .highlight .nf{font-weight:600;color:#D95350;}.css-olurbu .highlight .nn{color:#535861;}.css-olurbu .highlight .nt{color:#093e8b;}.css-olurbu .highlight .nv{color:#1772F6;}.css-olurbu .highlight .ow{font-weight:600;}.css-olurbu .highlight .w{color:#adb1b7;}.css-olurbu .highlight .mf{color:#1772F6;}.css-olurbu .highlight .mh{color:#1772F6;}.css-olurbu .highlight .mi{color:#1772F6;}.css-olurbu .highlight .mo{color:#1772F6;}.css-olurbu .highlight .sb{color:#D95350;}.css-olurbu .highlight .sc{color:#D95350;}.css-olurbu .highlight .sd{color:#D95350;}.css-olurbu .highlight .s2{color:#D95350;}.css-olurbu .highlight .se{color:#D95350;}.css-olurbu .highlight .sh{color:#D95350;}.css-olurbu .highlight .si{color:#D95350;}.css-olurbu .highlight .sx{color:#D95350;}.css-olurbu .highlight .sr{color:#A5542F;}.css-olurbu .highlight .s1{color:#D95350;}.css-olurbu .highlight .ss{color:#D95350;}.css-olurbu .highlight .bp{color:#9196a1;}.css-olurbu .highlight .vc{color:#1772F6;}.css-olurbu .highlight .vg{color:#1772F6;}.css-olurbu .highlight .vi{color:#1772F6;}.css-olurbu .highlight .il{color:#1772F6;}.css-olurbu .highlight::-webkit-scrollbar{width:6px;height:6px;}.css-olurbu .highlight::-webkit-scrollbar-thumb:horizontal{background-color:rgba(25,27,31,0.5);border-radius:6px;}.css-olurbu .highlight::-webkit-scrollbar-thumb:horizontal:hover{background-color:rgba(25,27,31,0.6);}.css-olurbu .LinkCard.old{position:relative;display:block;margin:1em auto;width:390px;box-sizing:border-box;border-radius:12px;max-width:100%;overflow:hidden;}.css-olurbu .LinkCard.old,.css-olurbu .LinkCard.old:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-olurbu .LinkCard-ecommerceLoadingCard{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;padding:12px;border-radius:inherit;height:80px;box-sizing:border-box;background:rgba(248,248,250,0.88);color:#c4c7ce;}.css-olurbu .LinkCard-ecommerceLoadingCardAvatarWrapper{width:60px;height:60px;background:#ebeced;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:6px;margin-right:10px;}.css-olurbu .LinkCard-ecommerceLoadingCardNetwork{width:20px;height:20px;}.css-olurbu .LinkCard-ecommerceLoadingCardLoadingbar{height:60px;-webkit-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}.css-olurbu .LinkCard-ecommerceLoadingCardLoadingbar span{height:16px;display:inline-block;background:#ebeced;}.css-olurbu .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(1){width:60px;margin-bottom:4px;}.css-olurbu .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(2){width:127px;}.css-olurbu .LinkCard.new{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;box-sizing:border-box;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:390px;min-height:84px;border-radius:8px;max-width:100%;overflow:hidden;margin:16px auto;padding:12px 12px 9px 12px;background-color:#f8f8fa;}.css-olurbu .LinkCard.new,.css-olurbu .LinkCard.new:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-olurbu .LinkCard.new .LinkCard-contents{display:block;-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;position:relative;}.css-olurbu .LinkCard.new .LinkCard-contents .loading{height:14px;background:#ebeced;border-radius:7px;}.css-olurbu .LinkCard.new .LinkCard-contents.withTitle{margin-bottom:3px;}.css-olurbu .LinkCard.new .LinkCard-title{display:-webkit-box;font-size:15px;font-weight:500;line-height:1.4;margin-bottom:2px;color:#191B1F;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-olurbu .LinkCard.new .LinkCard-title.two-line{line-height:20px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-olurbu .LinkCard.new .LinkCard-title.loading{margin-bottom:8px;width:80%;}.css-olurbu .LinkCard.new .LinkCard-title.loading.withTitle{margin-bottom:6px;}.css-olurbu .LinkCard.new .LinkCard-title.loadingTitle{margin-bottom:5px;}.css-olurbu .LinkCard.new .LinkCard-excerpt{display:-webkit-box;text-overflow:ellipsis;font-size:13px;line-height:18px;color:#9196a1;margin-bottom:4px;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-olurbu .LinkCard.new .LinkCard-excerpt .LinkCard-author{color:#373a40;}.css-olurbu .LinkCard.new .LinkCard-desc{display:-webkit-box;font-size:13px;height:18px;line-height:18px;color:#9196a1;word-break:break-all;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-olurbu .LinkCard.new .LinkCard-desc .LinkCard-tag,.css-olurbu .LinkCard.new .LinkCard-desc .tag{display:inline-block;font-size:11px;margin-left:8px;padding:0 4px;border-radius:3px;background:rgba(196,199,206,0.3);}.css-olurbu .LinkCard.new .LinkCard-desc.loading{width:40%;}.css-olurbu .LinkCard.new .LinkCard-desc svg{margin-right:2px;}.css-olurbu .LinkCard.new .LinkCard-image{-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;background-color:#ebeced;background-size:cover;background-position:center;position:relative;display:block;width:60px;height:60px;margin-left:20px;object-fit:cover;border-radius:inherit;overflow:hidden;}.css-olurbu .LinkCard.new .LinkCard-image.LinkCard-image--default{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;background-color:#ebeced;color:#c4c7ce;}.css-olurbu .LinkCard.new .LinkCard-image.LinkCard-image--default svg{color:#9196a1;}.css-olurbu .LinkCard.new .LinkCard-image img{width:100%;height:100%;object-fit:cover;}.css-olurbu .LinkCard.new .LinkCard-image .LinkCard-image--video{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;position:absolute;top:50%;left:50%;-webkit-transform:translateX(-50%) translateY(-50%);-ms-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);width:24px;height:24px;border-radius:12px;background:rgba(255,255,255,0.9);pointer-events:none;}.css-olurbu .LinkCard.new .LinkCard-image .LinkCard-image--video svg{color:#373a40;}.css-olurbu .LinkCard.new .LinkCard-richText .text{color:#373a40;}.css-olurbu .LinkCard.new .LinkCard-richText .bold{font-weight:600;}.css-olurbu .LinkCard.new .LinkCard-richText .tag{margin-left:4px;}.css-olurbu .FileLinkCard{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(248,248,250,0.88);border-radius:12px;box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:1em auto;max-width:100%;overflow:hidden;padding:12px;position:relative;width:390px;}.css-olurbu .FileLinkCard-icon{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;height:30px;width:30px;}.css-olurbu .FileLinkCard-info{margin-left:12px;}.css-olurbu .FileLinkCard-name{color:#191B1F;font-size:15px;font-weight:500;line-height:21px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-olurbu .FileLinkCard-meta{color:#9196a1;font-size:12px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;line-height:14px;margin-top:5px;}.css-olurbu .FileLinkCard-source{white-space:pre;}.css-olurbu img[data-uncomfortable]{content:url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20344.88888888888886%20194%22%3E%3CforeignObject%20width%3D%22344.88888888888886%22%20height%3D%22194%22%3E%0A%20%20%20%20%20%20%3Cdiv%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%20style%3D%22font-size%3A%2013px%3B%20font-family%3A%20-apple-system%2C%20BlinkMacSystemFont%2C%20Microsoft%20YaHei%2C%20sans-serif%3B%20color%3A%20%23fff%3B%20width%3A100%25%3B%20height%3A194px%3B%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20style%3D%22display%3A%20flex%3B%20flex-direction%3A%20column%3B%20align-items%3A%20center%3B%20justify-content%3A%20center%3B%20height%3A%20100%25%3B%22%3E%0A%20%20%20%20%20%20%20%20%20%20%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2218%22%20height%3D%2218%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22currentColor%22%3E%3Cpath%20d%3D%22M8%203.65a7%207%200%2000-1.353.128.65.65%200%2011-.25-1.275A8.3%208.3%200%20018%202.35c2.387%200%204.172.954%205.357%202.125C14.511%205.615%2015.15%207.022%2015.15%208c0%20.621-.257%201.391-.699%202.134a7.076%207.076%200%2001-1.403%201.68l.495.46a.65.65%200%2011-.886.951l-.998-.929a.645.645%200%2001-.104-.097L9.73%2010.501a.647.647%200%2001-.29.301%203.15%203.15%200%2001-4.313-4.094.647.647%200%2001.234-.275L3.908%205.08a5.774%205.774%200%2000-1.283%201.522C2.282%207.198%202.15%207.707%202.15%208c0%20.522.41%201.616%201.407%202.6.965.954%202.43%201.75%204.443%201.75.468%200%20.905-.043%201.311-.12a.65.65%200%2001.243%201.277A8.322%208.322%200%20018%2013.65c-2.387%200-4.172-.954-5.357-2.125C1.49%2010.385.85%208.978.85%208c0-.598.238-1.333.648-2.046A7.054%207.054%200%20012.95%204.188l-.547-.509a.65.65%200%2011.886-.951l8.8%208.194a5.793%205.793%200%20001.244-1.453c.372-.624.516-1.163.516-1.469%200-.522-.41-1.616-1.407-2.6-.965-.954-2.43-1.75-4.443-1.75zM6.29%207.296a1.85%201.85%200%20002.534%202.36l-2.535-2.36zM8%204.85a.65.65%200%20100%201.3%201.85%201.85%200%20011.843%201.694.65.65%200%20101.296-.11A3.15%203.15%200%20008%204.85z%22%20fill-rule%3D%22evenodd%22%20clip-rule%3D%22evenodd%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E%0A%20%20%20%20%20%20%20%20%20%20%3Cdiv%20style%3D%22margin%3A%20.6em%200%201.2em%22%3E%E8%AF%A5%E5%9B%BE%E7%89%87%E6%9C%89%E5%8F%AF%E8%83%BD%E4%BC%9A%E5%BC%95%E8%B5%B7%E4%B8%8D%E9%80%82%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%20%20%3Cbutton%20style%3D%22padding%3A%204px%201em%3B%20font-size%3A%201.1em%3B%20color%3A%20inherit%3B%20background%3A%20none%3B%20border%3A%201px%20solid%20rgba%28255%2C255%2C255%2C.5%29%3B%20border-radius%3A%209999px%3B%22%3E%E7%BB%A7%E7%BB%AD%E6%9F%A5%E7%9C%8B%3C%2Fbutton%3E%0A%20%20%20%20%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3C%2FforeignObject%3E%3C%2Fsvg%3E);width:100%;height:194px;background:url(https://pic1.zhimg.com/v2-cf70d0759d787c70091857151c1cad4a.jpeg) no-repeat rgba(191,191,191,0.7);background-size:cover;cursor:pointer!important;}.css-olurbu img.content_image[data-size="normal"],.css-olurbu img.origin_image[data-size="normal"]{width:100%;max-width:100%;}.css-olurbu img.content_image[data-size="small"],.css-olurbu img.origin_image[data-size="small"]{width:320px;max-width:100%;}@-webkit-keyframes animation-1yvu044{from{opacity:0;}to{opacity:1;}}@keyframes animation-1yvu044{from{opacity:0;}to{opacity:1;}}</style><style data-emotion-css="ch8ocw">.css-ch8ocw{position:relative;display:inline-block;height:30px;padding:0 12px;font-size:14px;line-height:30px;color:#1772F6;vertical-align:top;border-radius:100px;background:rgba(23,114,246,0.1);}.css-ch8ocw:hover{background-color:rgba(23,114,246,0.15);}</style><style data-emotion-css="1xlfegr">.css-1xlfegr{background:transparent;box-shadow:none;}</style><style data-emotion-css="1gomreu">.css-1gomreu{position:relative;display:inline-block;}</style><style data-emotion-css="1u7r5c9">.css-1u7r5c9{box-sizing:border-box;margin:0;min-width:0;max-width:100%;height:auto;background-color:#ffffff;width:40px;height:40px;border-radius:50%;}</style><style data-emotion="css"></style></head><body class="WhiteBg-body PostIndex-body" aria-basefontsize="16" data-rh="class"><a id="ariaTipText" role="pagedescription" aria-label="欢迎进入 你需要了解有关C++17中std::variant的全部信息 - 知乎,盲人用户使用操作智能引导，请按快捷键Ctrl+Alt+R；阅读详细操作说明请按快捷键Ctrl+Alt+问号键。" aria-atomic="true" href="javascript:void(0)" class="skipAutoFix" style="width: 1px; height: 1px;"><img src="https://zhuanlan.zhihu.com/p/607734474" style="width:1px !important;height:1px !important;position:absolute;top:0;"></a><div id="root"><div class="App"><div class="LoadingBar  css-55n9hh"></div><div><span style="position:absolute;top:-10000px;left:-10000px" role="log" aria-live="assertive"></span></div><main role="main" class="App-main"><div class="Post-content" data-zop-usertoken="{&quot;userToken&quot;:&quot;hexu1985&quot;}" data-zop="{&quot;authorName&quot;:&quot;勿忘心安&quot;,&quot;itemId&quot;:607734474,&quot;title&quot;:&quot;你需要了解有关C++17中std::variant的全部信息&quot;,&quot;type&quot;:&quot;article&quot;}" data-za-detail-view-path-module="PostItem" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Post&quot;,&quot;token&quot;:&quot;607734474&quot;}}}"><div class="ColumnPageHeader-Wrapper"><div><div class="Sticky ColumnPageHeader is-fixed css-1l12z7y" style="width: 1731.82px; top: 0px; left: 0px;"><div class="ColumnPageHeader-content"><a href="https://www.zhihu.com/" aria-label="知乎"><svg viewBox="0 0 64 30" fill="#1772F6" width="64" height="30" class="css-1hlrcxk"><path d="M29.05 4.582H16.733V25.94h3.018l.403 2.572 4.081-2.572h4.815V4.582zm-5.207 18.69l-2.396 1.509-.235-1.508h-1.724V7.233h6.78v16.04h-2.425zM14.46 14.191H9.982c0-.471.033-.954.039-1.458v-5.5h5.106V5.935a1.352 1.352 0 0 0-.404-.957 1.378 1.378 0 0 0-.968-.396H5.783c.028-.088.056-.177.084-.255.274-.82 1.153-3.326 1.153-3.326a4.262 4.262 0 0 0-2.413.698c-.57.4-.912.682-1.371 1.946-.532 1.453-.997 2.856-1.31 3.693C1.444 8.674.28 11.025.28 11.025a5.85 5.85 0 0 0 2.52-.61c1.119-.593 1.679-1.502 2.054-2.883l.09-.3h2.334v5.5c0 .5-.045.982-.073 1.46h-4.12c-.71 0-1.39.278-1.893.775a2.638 2.638 0 0 0-.783 1.874h6.527a17.717 17.717 0 0 1-.778 3.649 16.796 16.796 0 0 1-3.012 5.273A33.104 33.104 0 0 1 0 28.74s3.13 1.175 5.425-.954c1.388-1.292 2.631-3.814 3.23-5.727a28.09 28.09 0 0 0 1.12-5.229h5.967v-1.37a1.254 1.254 0 0 0-.373-.899 1.279 1.279 0 0 0-.909-.37z"></path><path d="M11.27 19.675l-2.312 1.491 5.038 7.458a6.905 6.905 0 0 0 .672-2.218 3.15 3.15 0 0 0-.28-2.168l-3.118-4.563zM51.449 15.195V5.842c4.181-.205 7.988-.405 9.438-.483l.851-.05c.387-.399.885-2.395.689-3.021-.073-.25-.213-.666-.638-.555a33.279 33.279 0 0 1-4.277.727c-2.766.321-3.97.404-7.804.682-6.718.487-12.709.72-12.709.72a2.518 2.518 0 0 0 .788 1.834 2.567 2.567 0 0 0 1.883.706c2.278-.095 5.598-.25 8.996-.41v9.203h-12.78c0 .703.281 1.377.783 1.874a2.69 2.69 0 0 0 1.892.777h10.105v7.075c0 .887-.464 1.192-1.231 1.214h-3.92a4.15 4.15 0 0 0 .837 1.544 4.2 4.2 0 0 0 1.403 1.067 6.215 6.215 0 0 0 2.71.277c1.36-.066 2.967-.826 2.967-3.57v-7.607h11.28c.342 0 .67-.135.91-.374.242-.239.378-.563.378-.902v-1.375H51.449z"></path><path d="M42.614 8.873a2.304 2.304 0 0 0-1.508-.926 2.334 2.334 0 0 0-1.727.405l-.376.272 4.255 5.85 2.24-1.62-2.884-3.98zM57.35 8.68l-3.125 4.097 2.24 1.663 4.517-5.927-.375-.277a2.32 2.32 0 0 0-1.722-.452 2.327 2.327 0 0 0-1.536.896z"></path></svg></a><i class="ColumnPageHeader-Line"></i><div class="ColumnPageHeader-Title"><div class="ColumnPageHeader-TitleName"><span class="ColumnPageHeader-TitleMeta">首发于</span><a class="ColumnLink ColumnPageHeader-TitleColumn" href="https://www.zhihu.com/column/c_1506624979713769473">C++杂谈</a></div></div><div class="ColumnPageHeader-Button"><div class="Popover"><button title="更多" id="Popover1-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover1-content" type="button" class="Button ColumnPageHeader-MenuToggler FEfUrdfMIKpQDJDqkjte Button--plain fEPKGkUK5jyc4fUuT0QP"><svg width="24" height="24" viewBox="0 0 24 24" class="Zi Zi--Dots" fill="currentColor"><path d="M5.165 13.665a1.665 1.665 0 1 0 0-3.33 1.665 1.665 0 0 0 0 3.33ZM13.665 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM18.835 13.665a1.665 1.665 0 1 0 0-3.33 1.665 1.665 0 0 0 0 3.33Z"></path></svg></button></div><button type="button" class="Button ColumnPageHeader-WriteButton FEfUrdfMIKpQDJDqkjte Button--blue JmYzaky7MEPMFcJDLNMG"><svg width="24" height="24" viewBox="0 0 24 24" class="Zi Zi--EditSurround" fill="currentColor"><path fill-rule="evenodd" d="M3.55 5.97a2.415 2.415 0 0 1 2.415-2.416h7.56a.75.75 0 0 1 0 1.5h-7.56a.915.915 0 0 0-.915.915v12.072c0 .505.41.915.915.915h12.074c.506 0 .915-.41.915-.915v-7.557a.75.75 0 0 1 1.5 0v7.557a2.415 2.415 0 0 1-2.415 2.415H5.965A2.415 2.415 0 0 1 3.55 18.04V5.969Z" clip-rule="evenodd"></path><path fill-rule="evenodd" d="M20.239 3.77a.75.75 0 0 1 0 1.06l-8.206 8.206a.75.75 0 0 1-1.06-1.06l8.205-8.206a.75.75 0 0 1 1.06 0Z" clip-rule="evenodd"></path></svg>写文章</button></div></div><div class="ColumnPageHeader-profile"><div class="Popover AppHeader-menu"><button id="Popover4-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover4-content" type="button" class="Button AppHeader-profileEntry FEfUrdfMIKpQDJDqkjte Button--plain fEPKGkUK5jyc4fUuT0QP"><img class="Avatar AppHeader-profileAvatar css-fnnb9l" src="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/v2-abed1a8c04700ba7d72b45195223e0ff_l.jpg" srcset="https://picx.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_l.jpg?source=32738c0c 2x" alt="点击打开hexu1985的主页"></button></div><div class="Popover ddLajxN_Q0AuobBZjX9m AppHeaderProfileMenu-creatorHintPopover"><div class="AppHeaderProfileMenu-creatorHintToggler" id="Popover5-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover5-content"></div></div></div></div><div class="Sticky--holder" style="position: relative; inset: 0px; display: block; float: none; margin: 0px; height: 51.9886px;"></div></div></div><article class="Post-Main Post-NormalMain" tabindex="-1"><header class="Post-Header"><h1 class="Post-Title">你需要了解有关C++17中std::variant的全部信息</h1><div class="Post-Author"><div class="AuthorInfo" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><div class="AuthorInfo"><meta itemprop="name" content="勿忘心安"><meta itemprop="image" content="https://picx.zhimg.com/v2-8352ba83f5aad85676e8527f9e6abdbd_l.jpg?source=172ae18b"><meta itemprop="url" content="https://www.zhihu.com/people/li-cong-lei-62"><meta itemprop="zhihu:followerCount"><span class="UserLink AuthorInfo-avatarWrapper"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/li-cong-lei-62" target="_blank" class="UserLink-link" data-za-detail-view-element_name="User"><img class="Avatar AuthorInfo-avatar css-1syywx2" src="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/v2-8352ba83f5aad85676e8527f9e6abdbd_l.jpg" srcset="https://picx.zhimg.com/v2-8352ba83f5aad85676e8527f9e6abdbd_l.jpg?source=172ae18b 2x" alt="勿忘心安"></a></div></span><div class="AuthorInfo-content"><div class="AuthorInfo-head"><span class="UserLink AuthorInfo-name"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/li-cong-lei-62" target="_blank" class="UserLink-link" data-za-detail-view-element_name="User">勿忘心安</a></div><a href="https://www.zhihu.com/question/48510028" target="_blank" class="css-1nt4zps" aria-label="同济大学 工程硕士" data-tooltip="同济大学 工程硕士"><span class="css-18biwo">​<svg viewBox="0 0 24 24" class="css-1ifz0go" width="18" height="18"><defs><lineargradient id="biz-badges-blue" x1="0" y1="0" x2="100%" y2="73.32%"><stop offset="15%" stop-color="#47D3FF"></stop><stop offset="81.54%" stop-color="#4A7DFF"></stop></lineargradient></defs><svg viewBox="0 0 24 24" x="-3" y="-3" fill="#ffffff" width="30" height="30"><path d="M3.56231227,13.8535307 C2.40051305,12.768677 2.41398885,11.0669203 3.59484487,9.99979213 L3.59222085,9.99654885 C4.26730143,9.45036719 4.79446755,8.21005186 4.7184197,7.34453784 L4.72305873,7.34412719 C4.66942824,5.75539997 5.8824188,4.56066914 7.47188965,4.64242381 L7.47229112,4.6386236 C8.33515314,4.72977993 9.58467253,4.22534048 10.1426329,3.55925173 L10.1462611,3.56228565 C11.2316055,2.40008701 12.9353108,2.41394456 14.0015072,3.59634088 L14.0047263,3.59374004 C14.5498229,4.26841874 15.7896857,4.79521622 16.6545744,4.71844347 L16.6549836,4.72304294 C18.245027,4.66894057 19.4396947,5.88213996 19.3575031,7.47241135 L19.3623099,7.47292747 C19.2704388,8.3358681 19.7742711,9.58421483 20.4407199,10.1424506 L20.437686,10.1460789 C21.5997217,11.2312209 21.5860695,12.9345218 20.4042441,14.0007396 L20.4072865,14.0045125 C19.7325967,14.5495925 19.2055209,15.7896954 19.2815865,16.6561959 L19.2770449,16.6565978 C19.3315454,18.2453037 18.1173775,19.4393568 16.5274188,19.3571512 L16.5269029,19.3619539 C15.6647098,19.270083 14.415408,19.7741709 13.8573671,20.4403558 L13.8537409,20.4373235 C12.76842,21.5995708 11.0650432,21.5864553 9.99899434,20.4039226 L9.99527367,20.406923 C9.45025436,19.7323399 8.21017638,19.2051872 7.34461983,19.2812352 L7.344304,19.2776405 C5.75448683,19.3312904 4.55977145,18.1170085 4.64254978,16.527117 L4.63769921,16.5265942 C4.72957031,15.6644394 4.22547659,14.4151814 3.55928015,13.8571569 L3.56231227,13.8535307 Z"></path></svg><path d="M2.63951518,13.3895441 C3.70763333,14.2842292 4.44777637,16.1226061 4.30075305,17.5023312 L4.32211542,17.3063047 C4.17509209,18.6910561 5.17786655,19.7063729 6.5613937,19.5844846 L6.364106,19.6008202 C7.75140298,19.4789319 9.57474349,20.2554985 10.4468305,21.3349009 L10.3224262,21.1803415 C11.1982831,22.2647703 12.6257916,22.2723098 13.5167278,21.2079863 L13.3898102,21.3600325 C14.2845162,20.2919393 16.1229361,19.5518136 17.5026934,19.6988334 L17.3054057,19.6774716 C18.6914461,19.8244915 19.7067866,18.8217404 19.5836389,17.4395022 L19.6012314,17.6367853 C19.4793403,16.2482641 20.255925,14.4249662 21.3353526,13.5528995 L21.1807897,13.677301 C22.2639871,12.8014646 22.2727834,11.3739894 21.2084351,10.483074 L21.3604848,10.6099886 C20.2923667,9.71530351 19.5522236,7.87818322 19.6992469,6.49720154 L19.6778846,6.69448464 C19.8249079,5.30847665 18.8221335,4.2944164 17.4386063,4.41630468 L17.635894,4.39871256 C16.248597,4.52185742 14.4252565,3.74529084 13.5531695,2.66588842 L13.6775738,2.81919121 C12.8017169,1.73601905 11.3742084,1.72722299 10.4832722,2.79154644 L10.6101898,2.63950024 C9.71548377,3.70759343 7.87706394,4.44771919 6.49730661,4.30195588 L6.69459432,4.32206116 C5.30855394,4.17504128 4.29447,5.17904888 4.41636114,6.56128713 L4.3987686,6.36400404 C4.52065973,7.75126861 3.74407501,9.57456653 2.66464737,10.4478898 L2.81921035,10.3222318 C1.73601288,11.1993248 1.72721662,12.6255433 2.79156494,13.5164587 L2.63951518,13.3895441 Z" fill="url(#biz-badges-blue)"></path><svg class="Zi Zi--Check" fill="#fff" x="6" y="6" viewBox="0 0 24 24" width="12" height="12"><path d="M10.229 17.516c-.318.327-.75.484-1.199.484-.453 0-.884-.16-1.202-.488l-4.335-4.47a1.77 1.77 0 0 1 .007-2.459 1.663 1.663 0 0 1 2.397.01l3.137 3.246 9.072-9.329a1.662 1.662 0 0 1 2.397 0c.663.681.663 1.786 0 2.466L10.23 17.516z" fill-rule="evenodd"></path></svg></svg></span></a></span></div><div class="AuthorInfo-detail"><div class="AuthorInfo-badge"><div class="ztext AuthorInfo-badgeText css-0">同济大学 工程硕士</div></div></div></div></div></div><button type="button" class="Button FollowButton FEfUrdfMIKpQDJDqkjte Button--primary Button--blue epMJl0lFQuYbC7jrwr_o JmYzaky7MEPMFcJDLNMG"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="Zi Zi--Plus FollowButton-icon" fill="currentColor"><path fill-rule="evenodd" d="M13.25 3.25a1.25 1.25 0 1 0-2.5 0v7.5h-7.5a1.25 1.25 0 1 0 0 2.5h7.5v7.5a1.25 1.25 0 1 0 2.5 0v-7.5h7.5a1.25 1.25 0 0 0 0-2.5h-7.5v-7.5Z" clip-rule="evenodd"></path></svg></span>关注他</button></div><div class="LabelContainer-wrapper"></div><div><div class="css-dvccr2"><div class="css-1lr85n">17 人赞同了该文章</div></div></div><span class="Voters"></span></header><div class="Post-RichTextContainer"><div class="css-1yuhvjn"><div class="css-376mun"><div class="css-l44lgl"><div class="css-8e1x4m"><div class="css-s1xz2x"><div><div class="Catalog isCatalogV2 css-17v5fjs" data-za-detail-view-name="正文"><div class="css-8kjoqe"><div class="css-1e6hvbc"><div class="css-zkfaav"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--Catalog24" fill="currentColor"><path d="M10 5a1 1 0 011-1h10a1 1 0 110 2H11a1 1 0 01-1-1zm4 6a1 1 0 100 2h7a1 1 0 100-2h-7zm0 7a1 1 0 100 2h7a1 1 0 100-2h-7zm-8.335.25a.915.915 0 01-.915-.915V12.75H10a.75.75 0 000-1.5H4.75V6.665c0-.505.41-.915.915-.915H7a.75.75 0 000-1.5H5.665A2.415 2.415 0 003.25 6.665v10.67a2.415 2.415 0 002.415 2.415H10a.75.75 0 000-1.5H5.665z"></path></svg></span><div class="css-5287jj">目录</div></div><div class="css-1ifd8ga">收起</div></div></div><div class="css-99phk"><div class="Catalog-content css-a3sv8e"><div class="Catalog-FirstLevelTitle Catalog-Title css-lvmdsl"><div data-catalog-target-id="h_607734474_0" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-byi3it"><div class="css-nj7ofv">union如何更好一些</div></div></div><div class="Catalog-FirstLevelTitle Catalog-Title css-lvmdsl"><div data-catalog-target-id="h_607734474_1" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-byi3it"><div class="css-nj7ofv">std::variant的基本演示案例</div></div></div><div class="Catalog-FirstLevelTitle Catalog-Title css-lvmdsl"><div data-catalog-target-id="h_607734474_2" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-byi3it"><div class="css-nj7ofv">何时使用std::variant</div></div></div><div class="Catalog-FirstLevelTitle Catalog-Title css-lvmdsl"><div data-catalog-target-id="h_607734474_3" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-byi3it"><div class="css-nj7ofv">std::variant的构造</div></div></div><div class="Catalog-FirstLevelTitle Catalog-Title css-lvmdsl"><div data-catalog-target-id="h_607734474_4" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-byi3it"><div class="css-nj7ofv">改变std::variant的值</div></div></div><div class="Catalog-FirstLevelTitle Catalog-Title css-lvmdsl"><div data-catalog-target-id="h_607734474_5" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-byi3it"><div class="css-nj7ofv">访问存储的值</div></div></div><div class="Catalog-FirstLevelTitle Catalog-Title css-lvmdsl"><div data-catalog-target-id="h_607734474_6" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-byi3it"><div class="css-nj7ofv">Visitor for std::variant</div></div></div><div class="Catalog-FirstLevelTitle Catalog-Title css-lvmdsl"><div data-catalog-target-id="h_607734474_7" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-byi3it"><div class="css-nj7ofv">Overload</div></div></div><div class="Catalog-FirstLevelTitle Catalog-Title css-lvmdsl"><div data-catalog-target-id="h_607734474_8" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-byi3it"><div class="css-nj7ofv">std::variant的其他操作</div></div></div><div class="Catalog-FirstLevelTitle Catalog-Title css-lvmdsl"><div data-catalog-target-id="h_607734474_9" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-byi3it"><div class="css-nj7ofv">异常安全保证</div></div></div><div class="Catalog-FirstLevelTitle Catalog-Title css-lvmdsl"><div data-catalog-target-id="h_607734474_10" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-byi3it"><div class="css-nj7ofv">性能和内存注意事项</div></div></div><div class="Catalog-FirstLevelTitle Catalog-Title css-lvmdsl"><div data-catalog-target-id="h_607734474_11" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-byi3it"><div class="css-nj7ofv">迁移自boost::variant</div></div></div><div class="Catalog-FirstLevelTitle Catalog-Title css-lvmdsl"><div data-catalog-target-id="h_607734474_12" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-byi3it"><div class="css-nj7ofv">std::variant的使用案例</div></div></div><div class="Catalog-SecondLevelTitle Catalog-Title css-1nds53c"><div data-catalog-target-id="h_607734474_13" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-h0sxub"><div class="css-nj7ofv">错误处理</div></div></div><div class="Catalog-SecondLevelTitle Catalog-Title css-1nds53c"><div data-catalog-target-id="h_607734474_14" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-h0sxub"><div class="css-nj7ofv">计算方程的根</div></div></div><div class="Catalog-SecondLevelTitle Catalog-Title css-1nds53c"><div data-catalog-target-id="h_607734474_15" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-h0sxub"><div class="css-nj7ofv">解析命令行</div></div></div><div class="Catalog-SecondLevelTitle Catalog-Title css-1nds53c"><div data-catalog-target-id="h_607734474_16" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-h0sxub"><div class="css-nj7ofv">状态机</div></div></div><div class="Catalog-SecondLevelTitle Catalog-Title css-1nds53c"><div data-catalog-target-id="h_607734474_17" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-h0sxub"><div class="css-nj7ofv">实现多态</div></div></div><div class="Catalog-SecondLevelTitle Catalog-Title css-1nds53c"><div data-catalog-target-id="h_607734474_18" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-h0sxub"><div class="css-nj7ofv">其他用途</div></div></div><div class="Catalog-FirstLevelTitle Catalog-Title css-lvmdsl"><div data-catalog-target-id="h_607734474_19" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-byi3it"><div class="css-nj7ofv">C++20和C++23改进</div></div></div><div class="Catalog-FirstLevelTitle Catalog-Title css-lvmdsl"><div data-catalog-target-id="h_607734474_20" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-byi3it"><div class="css-nj7ofv">其他</div></div></div><div class="Catalog-FirstLevelTitle Catalog-Title css-lvmdsl"><div data-catalog-target-id="h_607734474_21" data-za-detail-view-id="9745" data-za-detail-view-action="Click" data-za-detail-view-name="正文" class="css-byi3it"><div class="css-nj7ofv">参考</div></div></div></div></div></div></div></div></div></div><div class="RichText ztext Post-RichText css-olurbu" options="[object Object]"><p data-first-child="" data-pid="pISIY4ar">在C++17标准出现之前，有一些神奇的术语，像"discriminated union"，"type-safe union"和"sum type"。后来它们都意味着相同的类型："variant"。</p><p data-pid="eKsrIurn">本文我们将全面介绍C++17中的std::variant这个全新的类型该如何使用，以及它该在哪里使用。</p><h2 id="h_607734474_0" data-into-catalog-status="">union如何更好一些</h2><p data-pid="kBOEDFri">先和以前的union对比一下（其实union很少在业务代码中使用，在大多数情况下，应避免使用union）。例如，浮点运算有一个“常见的技巧”：</p><div class="highlight"><pre><code class="language-cpp"><span class="k">union</span> <span class="nc">SuperFloat</span> <span class="p">{</span>
    <span class="kt">float</span> <span class="n">f</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">RawMantissa</span><span class="p">(</span><span class="n">SuperFloat</span> <span class="n">f</span><span class="p">)</span> <span class="p">{</span> 
    <span class="k">return</span> <span class="n">f</span><span class="p">.</span><span class="n">i</span> <span class="o">&amp;</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">23</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span> 
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">RawExponent</span><span class="p">(</span><span class="n">SuperFloat</span> <span class="n">f</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">i</span> <span class="o">&gt;&gt;</span> <span class="mi">23</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span> 
<span class="p">}</span>
</code></pre></div><p data-pid="BzzQDARA">然而，尽管上述代码可能在C99中正常工作，但由于更严格的aliasing rules，它在C++中是未定义的行为！</p><p data-pid="ANkIAKDp">在Core Guideline Rule C.183中有一条指南建议：</p><p data-pid="Td9jyPWD"><a href="https://link.zhihu.com/?target=http%3A//isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines%23c183-dont-use-a-union-for-type-punning" class=" wrap external" target="_blank" rel="nofollow noreferrer" data-za-detail-view-id="1043">C.183: 不要将 union 用于类型双关</a></p><p data-pid="1DOr8i9X"><em>读取一个 union 曾写入的成员不同类型的成员是未定义的行为。 这种双关是不可见的，或者至少比具名强制转换更难于找出。 使用 union 的类型双关是一种错误来源。</em></p><p data-pid="W2zMDjmy">union还有一个额外的问题：非常的简单粗暴。你没有办法知道当前使用的类型是什么，更重要的是，它不会调用underlying types的析构函数。下面是一个来自 <a href="https://link.zhihu.com/?target=https%3A//en.cppreference.com/w/cpp/language/union" class=" wrap external" target="_blank" rel="nofollow noreferrer" data-za-detail-view-id="1043">cppreference/union</a> 的示例，清楚地说明了它的使用复杂性：</p><div class="highlight"><pre><code class="language-cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="k">union</span> <span class="nc">S</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">str</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vec</span><span class="p">;</span>
    <span class="o">~</span><span class="n">S</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span> <span class="c1">// what to delete here?
</span><span class="c1"></span><span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">S</span> <span class="n">s</span> <span class="o">=</span> <span class="p">{</span><span class="s">"Hello, world"</span><span class="p">};</span>
    <span class="c1">// at this point, reading from s.vec is undefined behavior
</span><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"s.str = "</span> <span class="o">&lt;&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">str</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>

    <span class="c1">// you have to call destructor of the contained objects!
</span><span class="c1"></span>    <span class="n">s</span><span class="p">.</span><span class="n">str</span><span class="p">.</span><span class="o">~</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">();</span>

    <span class="c1">// and a constructor!
</span><span class="c1"></span>    <span class="k">new</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">.</span><span class="n">vec</span><span class="p">)</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>

    <span class="c1">// now, s.vec is the active member of the union
</span><span class="c1"></span>    <span class="n">s</span><span class="p">.</span><span class="n">vec</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">vec</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>

    <span class="c1">// another destructor
</span><span class="c1"></span>    <span class="n">s</span><span class="p">.</span><span class="n">vec</span><span class="p">.</span><span class="o">~</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div><p data-pid="CRMJ41Rf">运行代码 <a href="https://link.zhihu.com/?target=http%3A//coliru.stacked-crooked.com/a/223359cc5bbd946f" class=" wrap external" target="_blank" rel="nofollow noreferrer" data-za-detail-view-id="1043">@Coliru</a></p><p data-pid="gUHJxmlT">如你所见，union使用时需要编码人员自己进行大量的维护存储。在切换到新的存储对象之前，你必须知道当前哪种类型处于活动状态并调用其析构函数/构造函数。</p><p data-pid="fUKz8_9c">这就是为什么你可能不会看到union中存储使用“高级”类型，例如vector、string或者其他的容器等，union主要还是用于基本类型。</p><p data-pid="nULcAKuq">那怎么样让union会更好用呢？</p><ul><li data-pid="EaV5AhuZ">可以使用复杂类型，包括对其生命周期的支持：如果切换类型，会调用对应的析构函数。</li><li data-pid="s13qygsh">能清楚的知道当前激活的类型</li></ul><p data-pid="2fUqsg5n">在C++17之前，你可以使用一些第三方库，例如boost::variant，但是现在你可以使用标准库中的std::variant。</p><h2 id="h_607734474_1" data-into-catalog-status="">std::variant的基本演示案例</h2><p data-pid="vT9IcVOn">下面是该类型的使用操作演示案例：</p><div class="highlight"><pre><code class="language-cpp"><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;variant&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="k">struct</span> <span class="nc">SampleVisitor</span>
<span class="p">{</span>
    <span class="kt">void</span> <span class="nf">operator</span><span class="p">()(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> 
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"int: "</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span> 
    <span class="p">}</span>
    <span class="kt">void</span> <span class="nf">operator</span><span class="p">()(</span><span class="kt">float</span> <span class="n">f</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> 
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"float: "</span> <span class="o">&lt;&lt;</span> <span class="n">f</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span> 
    <span class="p">}</span>
    <span class="kt">void</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> 
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"string: "</span> <span class="o">&lt;&lt;</span> <span class="n">s</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span> 
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">float</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">intFloatString</span><span class="p">;</span>
    <span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">variant_size_v</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">intFloatString</span><span class="p">)</span><span class="o">&gt;</span> <span class="o">==</span> <span class="mi">3</span><span class="p">);</span>

    <span class="c1">// default initialized to the first alternative, should be 0
</span><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">visit</span><span class="p">(</span><span class="n">SampleVisitor</span><span class="p">{},</span> <span class="n">intFloatString</span><span class="p">);</span>

    <span class="c1">// index will show the currently used 'type'
</span><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"index = "</span> <span class="o">&lt;&lt;</span> <span class="n">intFloatString</span><span class="p">.</span><span class="n">index</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">intFloatString</span> <span class="o">=</span> <span class="mf">100.0f</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"index = "</span> <span class="o">&lt;&lt;</span> <span class="n">intFloatString</span><span class="p">.</span><span class="n">index</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">intFloatString</span> <span class="o">=</span> <span class="s">"hello super world"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"index = "</span> <span class="o">&lt;&lt;</span> <span class="n">intFloatString</span><span class="p">.</span><span class="n">index</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="c1">// try with get_if:
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="n">intPtr</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">get_if</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">intFloatString</span><span class="p">));</span> <span class="n">intPtr</span><span class="p">)</span> 
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"int!"</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">intPtr</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="n">floatPtr</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">get_if</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">intFloatString</span><span class="p">));</span> <span class="n">floatPtr</span><span class="p">)</span> 
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"float!"</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">floatPtr</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">holds_alternative</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">intFloatString</span><span class="p">))</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"the variant holds an int!</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">holds_alternative</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">intFloatString</span><span class="p">))</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"the variant holds a float</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">holds_alternative</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="n">intFloatString</span><span class="p">))</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"the variant holds a string</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>  

    <span class="c1">// try/catch and bad_variant_access
</span><span class="c1"></span>    <span class="k">try</span> 
    <span class="p">{</span>
        <span class="k">auto</span> <span class="n">f</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">intFloatString</span><span class="p">);</span> 
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"float! "</span> <span class="o">&lt;&lt;</span> <span class="n">f</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">bad_variant_access</span><span class="o">&amp;</span><span class="p">)</span> 
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"our variant doesn't hold float at this moment...</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// visit:
</span><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">visit</span><span class="p">(</span><span class="n">SampleVisitor</span><span class="p">{},</span> <span class="n">intFloatString</span><span class="p">);</span>
    <span class="n">intFloatString</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">visit</span><span class="p">(</span><span class="n">SampleVisitor</span><span class="p">{},</span> <span class="n">intFloatString</span><span class="p">);</span>
    <span class="n">intFloatString</span> <span class="o">=</span> <span class="mf">10.0f</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">visit</span><span class="p">(</span><span class="n">SampleVisitor</span><span class="p">{},</span> <span class="n">intFloatString</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p data-pid="aQZ59y_J">运行代码 <a href="https://link.zhihu.com/?target=http%3A//coliru.stacked-crooked.com/a/5405c8f9b7dc8e56" class=" wrap external" target="_blank" rel="nofollow noreferrer" data-za-detail-view-id="1043">@Coliru</a></p><p data-pid="qgE7dHNg">输出如下：</p><div class="highlight"><pre><code class="language-text">int: 0
index = 0
index = 1
allocating 18 bytes
index = 2
the variant holds a string
our variant doesn't hold float at this moment...
string: hello super world
global op delete called
int: 10
float: 10
</code></pre></div><p data-pid="S1i6lyl2">我们在上面的例子中展示了以下几件事：</p><ul><li data-pid="Z4qaro8f">可以通过<code>index()</code>获取当前使用的类型，或者通过<code>holds_alternative</code>来检查当前使用的类型。</li><li data-pid="aG6EuEiF">可以通过<code>get_if</code>或者<code>get</code>（可能会抛出<code>bad_variant_access</code>异常）来访问当前的值。</li><li data-pid="_QatnAOb">类型安全--不允许获取未激活类型的值</li><li data-pid="saRak9Og">如果未使用值来初始化variant，则会使用第一种类型进行初始化。在这种情况下，第一个类型必须具有默认构造函数。</li><li data-pid="6YMvYjXJ">不会发生额外的堆内存分配。</li><li data-pid="H9rcRobm">可以其当前激活的类型上使用visitor来自动执行一些方法。</li><li data-pid="bk2AaR4I">variant会自动调用非平凡类型的析构函数和构造函数。在示例中，string对象在我们切换到新类型之前被释放。</li></ul><h2 id="h_607734474_2" data-into-catalog-status="">何时使用std::variant</h2><p data-pid="Ba0Rg7fN">如果你正在处理一些底层的逻辑，并且只使用基本类型，那么union可能仍然是首选。但是对于其他的使用场景，std::variant是一种更好的方式。</p><p data-pid="ygZiggf7">一些可能使用的场景：</p><ul><li data-pid="hkksdsrb">所有可能为单个变量获得几种类型的地方：解析命令行、ini文件、语言解析器等。</li><li data-pid="u7tAUD0t">有效地表达计算的几种可能结果：例如求解方程的根</li><li data-pid="OQfm8_K2">错误处理：例如，您可以返回<code>variant&lt;Object, ErrorCode&gt;</code>，如果返回值是有效的，则返回<code>Object</code>，否则分配一些错误码（C++23可以使用<code>std::expected</code>）。</li><li data-pid="8vJr4oAs">状态机</li><li data-pid="qCyvL9F-">不使用虚表和继承实现的多态（visiting pattern）</li></ul><h2 id="h_607734474_3" data-into-catalog-status="">std::variant的构造</h2><p data-pid="d_Yxf9fH">以下是std::variant的创建和初始化的几种方法：</p><div class="highlight"><pre><code class="language-cpp"><span class="c1">// default initialization: (type has to has a default ctor)
</span><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">float</span><span class="o">&gt;</span> <span class="n">intFloat</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">intFloat</span><span class="p">.</span><span class="n">index</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">", value "</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">intFloat</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

<span class="c1">// monostate for default initialization:
</span><span class="c1"></span><span class="k">class</span> <span class="nc">NotSimple</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">NotSimple</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">float</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// std::variant&lt;NotSimple, int&gt; cannotInit; // error
</span><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">monostate</span><span class="p">,</span> <span class="n">NotSimple</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">okInit</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">okInit</span><span class="p">.</span><span class="n">index</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

<span class="c1">// pass a value:
</span><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">float</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">intFloatString</span> <span class="p">{</span> <span class="mf">10.5f</span> <span class="p">};</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">intFloatString</span><span class="p">.</span><span class="n">index</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">", value "</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">intFloatString</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

<span class="c1">// ambiguity
</span><span class="c1">// double might convert to float or int, so the compiler cannot decide
</span><span class="c1"></span>
<span class="c1">//std::variant&lt;int, float, std::string&gt; intFloatString { 10.5 };
</span><span class="c1"></span>
<span class="c1">// ambiguity resolved by in_place
</span><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="kt">long</span><span class="p">,</span> <span class="kt">float</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">longFloatString</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">in_place_index</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span> <span class="mf">7.6</span> <span class="p">};</span> <span class="c1">// double!
</span><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">longFloatString</span><span class="p">.</span><span class="n">index</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">", value "</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">longFloatString</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

<span class="c1">// in_place for complex types
</span><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">vecStr</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">in_place_index</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="p">}};</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">vecStr</span><span class="p">.</span><span class="n">index</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">", vector size "</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">vecStr</span><span class="p">).</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

<span class="c1">// copy-initialize from other variant:
</span><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">float</span><span class="o">&gt;</span> <span class="n">intFloatSecond</span> <span class="p">{</span> <span class="n">intFloat</span> <span class="p">};</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">intFloatSecond</span><span class="p">.</span><span class="n">index</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">", value "</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">intFloatSecond</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
</code></pre></div><p data-pid="YeDRBmc2">运行代码 <a href="https://link.zhihu.com/?target=https%3A//godbolt.org/z/W5j83Padv" class=" wrap external" target="_blank" rel="nofollow noreferrer" data-za-detail-view-id="1043">@Compiler Explorer</a></p><p data-pid="5WeMQiSi">输出如下：</p><div class="highlight"><pre><code class="language-text">0, value 0
0
1, value 10.5
1, value 7.6
0, vector size 4
0, value 0
</code></pre></div><p data-pid="Yk2C91VU">知识点：</p><ul><li data-pid="iyblft4X">默认情况下，variant对象使用第一种类型初始化被初始化。如果第一个类型没有默认构造函数时将会初始化失败，编译器会报错。但是在这种情况下，你可以将variant的第一种类型指定为<code>std::monostate</code>。</li><li data-pid="TwRex0FQ">可以使用具体的值来初始化variant，它将会匹配到最佳的类型。如果存在类型匹配的歧义，则可以使用<code>std::in_place_index</code>来显式指定要匹配的类型。</li><li data-pid="B9MMo22Q"><code>std::in_place_index</code>允许创建复杂的类型并将参数传递给该类型对应的构造函数。</li></ul><p data-pid="piqDfUbA"><strong>关于std::monostate</strong></p><p data-pid="qRvATkDi">在代码示例中你可能注意到一个特殊的类型：<code>std::monostate</code>。它只是一个空类型，被用来和variant一起使用来表示空状态。当variant中的第一个类型没有默认构造函数时，建议将<code>std::monostate</code>作为第一个类型来使用。</p><h2 id="h_607734474_4" data-into-catalog-status="">改变std::variant的值</h2><p data-pid="jiGkQ-pM">四种方法可以variant的当前值：</p><ul><li data-pid="NoqE1UNn">赋值操作符</li><li data-pid="jYYHN8ul"><code>emplace</code></li><li data-pid="8F2SQ8jX"><code>get</code>然后给当前激活的类型赋新值</li><li data-pid="iTTMBtix">visitor访问器</li></ul><p data-pid="4KAh_Lm4">这一切都是类型安全的，并且对象生存期也在控制范围之内。</p><div class="highlight"><pre><code class="language-cpp"><span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">float</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">intFloatString</span> <span class="p">{</span> <span class="s">"Hello"</span> <span class="p">};</span>
    
<span class="n">intFloatString</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// we're now an int
</span><span class="c1"></span>    
<span class="n">intFloatString</span><span class="p">.</span><span class="n">emplace</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="s">"Hello"</span><span class="p">));</span> <span class="c1">// we're now string again
</span><span class="c1"></span>    
<span class="c1">// std::get returns a reference, so you can change the value:
</span><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="n">intFloatString</span><span class="p">)</span> <span class="o">+=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="s">" World"</span><span class="p">);</span>
    
<span class="n">intFloatString</span> <span class="o">=</span> <span class="mf">10.1f</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="k">auto</span> <span class="n">pFloat</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">get_if</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">intFloatString</span><span class="p">);</span> <span class="n">pFloat</span><span class="p">)</span>
    <span class="o">*</span><span class="n">pFloat</span> <span class="o">*=</span> <span class="mf">2.0f</span><span class="p">;</span>
</code></pre></div><p data-pid="y5aH3y6Y">查看具体的示例代码 <a href="https://link.zhihu.com/?target=http%3A//coliru.stacked-crooked.com/a/c85ef3108ee72ac0" class=" wrap external" target="_blank" rel="nofollow noreferrer">@Coliru</a></p><div class="highlight"><pre><code class="language-text">Hello
10
Hello
Hello World
20.2
</code></pre></div><p data-pid="xpSqLocN"><strong>对象的生命周期</strong></p><p data-pid="gPQU3Kxf">当使用union时，需要自己管理其内部状态：调用构造函数或析构函数。这特别容易出错。但<code>std::variant</code>会自动处理对象生存期。这意味着，如果它要更改当前存储的类型，则会自动调用其类型对应的析构函数。</p><div class="highlight"><pre><code class="language-cpp"><span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">v</span> <span class="p">{</span> <span class="s">"Hello A Quite Long String"</span> <span class="p">};</span>
<span class="c1">// v allocates some memory for the string
</span><span class="c1"></span><span class="n">v</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// we call destructor for the string!
</span><span class="c1">// no memory leak
</span></code></pre></div><p data-pid="mtKfHe8O">使用自定义类型查看此示例：</p><div class="highlight"><pre><code class="language-cpp"><span class="k">class</span> <span class="nc">MyType</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">MyType</span><span class="p">()</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"MyType::MyType</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span> <span class="p">}</span>
    <span class="o">~</span><span class="n">MyType</span><span class="p">()</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"MyType::~MyType</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">OtherType</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">OtherType</span><span class="p">()</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"OtherType::OtherType</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span> <span class="p">}</span>
    <span class="n">OtherType</span><span class="p">(</span><span class="k">const</span> <span class="n">OtherType</span><span class="o">&amp;</span><span class="p">)</span> <span class="p">{</span> 
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"OtherType::OtherType(const OtherType&amp;)</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span> 
    <span class="p">}</span>
    <span class="o">~</span><span class="n">OtherType</span><span class="p">()</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"OtherType::~OtherType</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="n">MyType</span><span class="p">,</span> <span class="n">OtherType</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">OtherType</span><span class="p">();</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p data-pid="MUjnNssj">输出如下：</p><div class="highlight"><pre><code class="language-text">MyType::MyType
OtherType::OtherType
MyType::~MyType
OtherType::OtherType(const OtherType&amp;)
OtherType::~OtherType
OtherType::~OtherType
</code></pre></div><p data-pid="9HRC_N8i">运行代码 <a href="https://link.zhihu.com/?target=http%3A//coliru.stacked-crooked.com/a/9c5e56e6420dd7d2" class=" wrap external" target="_blank" rel="nofollow noreferrer">@Coliru</a></p><p data-pid="Z3TyijXw">一开始，我们使用<code>MyType</code>的默认值来初始化variant；然后使用<code>OtherType</code>的实例更改variant的值。先调用<code>MyType</code>的析构函数，然后调用<code>OtherType</code>赋值运算符，稍后销毁临时对象，最后程序运行结束时销毁存储在variant中的对象。</p><h2 id="h_607734474_5" data-into-catalog-status="">访问存储的值</h2><p data-pid="WlygClxx">在上面的示例中，你可能已经了解了如何访问该值。但是，让我们总结一下这项重要操作。</p><p data-pid="4KsezjHK">首先，即使你知道当前激活类型是什么，你也无法执行如下代码：</p><div class="highlight"><pre><code class="language-cpp"><span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">float</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">intFloatString</span> <span class="p">{</span> <span class="s">"Hello"</span> <span class="p">};</span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">s</span> <span class="o">=</span> <span class="n">intFloatString</span><span class="p">;</span>

<span class="c1">// error: conversion from 
</span><span class="c1">// 'std::variant&lt;int, float, std::string&gt;' 
</span><span class="c1">// to non-scalar type 'std::string' requested
</span><span class="c1">// std::string s = intFloatString;
</span></code></pre></div><p data-pid="5rV_l7Io">因此，你必须使用辅助函数来访问该值。</p><p data-pid="SByQGKji">你需要使用一个非成员函数<code>std::get&lt;Type|Index&gt;(variant)</code>来访问内部的值。如果所需类型处于激活状态（可以传递类型或索引），则返回对应类型的引用。如果没有，那么你会得到<code>std::bad_variant_access</code>异常。</p><div class="highlight"><pre><code class="language-cpp"><span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">float</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">intFloatString</span><span class="p">;</span>
<span class="k">try</span> 
<span class="p">{</span>
    <span class="k">auto</span> <span class="n">f</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">intFloatString</span><span class="p">);</span> 
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"float! "</span> <span class="o">&lt;&lt;</span> <span class="n">f</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">bad_variant_access</span><span class="o">&amp;</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"our variant doesn't hold float at this moment...</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p data-pid="UJm_SPGh">另外一个函数是<code>std::get_if</code>。它也是非成员函数，但不会引发异常。它返回指向激活类型的指针或者<code>nullptr</code>。</p><p data-pid="CZMKX2zK">注意：<code>std::get</code>返回对variant的引用，<code>std::get_if</code>返回对variant的指针。</p><div class="highlight"><pre><code class="language-cpp"><span class="k">if</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="n">intPtr</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">get_if</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">intFloatString</span><span class="p">))</span> 
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"int!"</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">intPtr</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
</code></pre></div><p data-pid="mRB6ndMG">但是，访问variant中的值的最重要方法是使用访问者来实现。</p><h2 id="h_607734474_6" data-into-catalog-status="">Visitor for std::variant</h2><p data-pid="Wbh4p5P6">我们需要介绍stl中另一个函数<code>std::visit</code>。它可以在所有的variant参数上调用给定的“访问者”。</p><p data-pid="uMNk-yHb">该函数的声明如下：</p><div class="highlight"><pre><code class="language-cpp"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">Visitor</span><span class="p">,</span> <span class="k">class</span><span class="err">... </span><span class="nc">Variants</span><span class="o">&gt;</span>  
<span class="k">constexpr</span> <span class="n">visit</span><span class="p">(</span><span class="n">Visitor</span><span class="o">&amp;&amp;</span> <span class="n">vis</span><span class="p">,</span> <span class="n">Variants</span><span class="o">&amp;&amp;</span><span class="p">...</span> <span class="n">vars</span><span class="p">);</span>
</code></pre></div><p data-pid="FSl2igx_">它会在当前所有的variant的激活类型上调用visitor中的匹配的函数。</p><p data-pid="6e4c_ifs">如果只传递一个variant，则必须对该variant中的类型进行重载。如果给出多个variant，则必须对所有variant中所有可能的类型对进行重载。</p><p data-pid="sLWsIJt0">visitor是“接受每个variant中所有可能的类型的可调用对象”。</p><p data-pid="wgdDLSh4">例如：</p><div class="highlight"><pre><code class="language-cpp"><span class="c1">// a generic lambda:
</span><span class="c1"></span><span class="k">auto</span> <span class="n">PrintVisitor</span> <span class="o">=</span> <span class="p">[](</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">t</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span> <span class="p">};</span>

<span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">float</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">intFloatString</span> <span class="p">{</span> <span class="s">"Hello"</span> <span class="p">};</span>
<span class="n">std</span><span class="o">::</span><span class="n">visit</span><span class="p">(</span><span class="n">PrintVisitor</span><span class="p">,</span> <span class="n">intFloatString</span><span class="p">);</span>
</code></pre></div><p data-pid="tVC7bUf_">在上面的示例中，泛型lambda用于生成所有可能的重载。由于variant中的所有类型都支持<code>&lt;&lt;</code>，因此我们可以成功打印它们。</p><p data-pid="xS872eUk">在另一种情况下，我们可以使用visitor来更改当前的值：</p><div class="highlight"><pre><code class="language-cpp"><span class="k">auto</span> <span class="n">PrintVisitor</span> <span class="o">=</span> <span class="p">[](</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">t</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span> <span class="p">};</span>
<span class="k">auto</span> <span class="n">TwiceMoreVisitor</span> <span class="o">=</span> <span class="p">[](</span><span class="k">auto</span><span class="o">&amp;</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span> <span class="n">t</span><span class="o">*=</span> <span class="mi">2</span><span class="p">;</span> <span class="p">};</span>

<span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">float</span><span class="o">&gt;</span> <span class="n">intFloat</span> <span class="p">{</span> <span class="mf">20.4f</span> <span class="p">};</span>
<span class="n">std</span><span class="o">::</span><span class="n">visit</span><span class="p">(</span><span class="n">PrintVisitor</span><span class="p">,</span> <span class="n">intFloat</span><span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">visit</span><span class="p">(</span><span class="n">TwiceMoreVisitor</span><span class="p">,</span> <span class="n">intFloat</span><span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">visit</span><span class="p">(</span><span class="n">PrintVisitor</span><span class="p">,</span> <span class="n">intFloat</span><span class="p">);</span>
</code></pre></div><p data-pid="iCcf6T3D">如果我们的类型执行相同的逻辑，则泛型lambda可以很好的工作，但在大多数情况下，我们希望根据激活类型的不同，来执行一些不同的相应操作。</p><p data-pid="kKwTfv7p">这样我们可以一个visitor，里面重载多个<code>operator ()</code>：</p><div class="highlight"><pre><code class="language-cpp"><span class="k">struct</span> <span class="nc">MultiplyVisitor</span>
<span class="p">{</span>
    <span class="kt">float</span> <span class="n">mFactor</span><span class="p">;</span>

    <span class="n">MultiplyVisitor</span><span class="p">(</span><span class="kt">float</span> <span class="n">factor</span><span class="p">)</span> <span class="o">:</span> <span class="n">mFactor</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">operator</span><span class="p">()(</span><span class="kt">int</span><span class="o">&amp;</span> <span class="n">i</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
        <span class="n">i</span> <span class="o">*=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">mFactor</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">operator</span><span class="p">()(</span><span class="kt">float</span><span class="o">&amp;</span> <span class="n">f</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
        <span class="n">f</span> <span class="o">*=</span> <span class="n">mFactor</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">operator</span><span class="p">()(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
        <span class="c1">// nothing to do here...
</span><span class="c1"></span>    <span class="p">}</span>
<span class="p">};</span>

<span class="n">std</span><span class="o">::</span><span class="n">visit</span><span class="p">(</span><span class="n">MultiplyVisitor</span><span class="p">(</span><span class="mf">0.5f</span><span class="p">),</span> <span class="n">intFloat</span><span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">visit</span><span class="p">(</span><span class="n">PrintVisitor</span><span class="p">,</span> <span class="n">intFloat</span><span class="p">);</span>
</code></pre></div><p data-pid="MVTTCf5N">在示例中，我们使用了一个状态来保存所需的比例因子。</p><p data-pid="_SzY7EhJ">对于lambda，我们只需要在其使用之前定义好它就行。然后当你需要编写一个单独的类时，你需要在该作用域范围之外定义它。这就是为什么使用overload来构造visitor更方便的原因。</p><h2 id="h_607734474_7" data-into-catalog-status="">Overload</h2><p data-pid="DwH8DTHU">使用此技巧，你可以在一个位置编写多个lambda来匹配variant中的所有类型：</p><div class="highlight"><pre><code class="language-cpp"><span class="n">std</span><span class="o">::</span><span class="n">visit</span>
<span class="p">(</span>
  <span class="n">overload</span>
  <span class="p">(</span>
    <span class="p">[](</span><span class="k">const</span> <span class="kt">int</span><span class="o">&amp;</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span> <span class="n">PRINT</span><span class="p">(</span><span class="s">"int: "</span> <span class="o">+</span> <span class="n">i</span><span class="p">);</span> <span class="p">},</span>
    <span class="p">[](</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span> <span class="n">PRINT</span><span class="p">(</span><span class="s">"it's a string: "</span> <span class="o">+</span> <span class="n">s</span><span class="p">);</span> <span class="p">},</span>
    <span class="p">[](</span><span class="k">const</span> <span class="kt">float</span><span class="o">&amp;</span> <span class="n">f</span><span class="p">)</span> <span class="p">{</span> <span class="n">PRINT</span><span class="p">(</span><span class="s">"float"</span> <span class="o">+</span> <span class="n">f</span><span class="p">);</span> <span class="p">}</span>
  <span class="p">),</span>
  <span class="n">yourVariant</span><span class="p">;</span>
<span class="p">);</span>
</code></pre></div><p data-pid="omBmhXmz">目前，它不是库的一部分，但可能的代码如下所示：</p><div class="highlight"><pre><code class="language-cpp"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span><span class="err">... </span><span class="nc">Ts</span><span class="o">&gt;</span> <span class="k">struct</span> <span class="nc">overload</span> <span class="o">:</span> <span class="n">Ts</span><span class="p">...</span> <span class="p">{</span> <span class="k">using</span> <span class="n">Ts</span><span class="o">::</span><span class="k">operator</span><span class="p">()...;</span> <span class="p">};</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">class</span><span class="err">... </span><span class="nc">Ts</span><span class="o">&gt;</span> <span class="n">overload</span><span class="p">(</span><span class="n">Ts</span><span class="p">...)</span> <span class="o">-&gt;</span> <span class="n">overload</span><span class="o">&lt;</span><span class="n">Ts</span><span class="p">...</span><span class="o">&gt;</span><span class="p">;</span>
</code></pre></div><p data-pid="SJW61cj8">这两行看起来有点魔幻，但是它们做的只是创建一个类，该类继承所有给定的lambda，并重载了所有的<code>Ts::operator()</code>。</p><div class="highlight"><pre><code class="language-cpp"><span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">float</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">intFloatString</span> <span class="p">{</span> <span class="s">"Hello"</span> <span class="p">};</span>
<span class="n">std</span><span class="o">::</span><span class="n">visit</span><span class="p">(</span><span class="n">overload</span><span class="p">{</span>
    <span class="p">[](</span><span class="kt">int</span><span class="o">&amp;</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span> <span class="n">i</span><span class="o">*=</span> <span class="mi">2</span><span class="p">;</span> <span class="p">},</span>
    <span class="p">[](</span><span class="kt">float</span><span class="o">&amp;</span> <span class="n">f</span><span class="p">)</span> <span class="p">{</span> <span class="n">f</span><span class="o">*=</span> <span class="mf">2.0f</span><span class="p">;</span> <span class="p">},</span>
    <span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span> <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">s</span><span class="p">;</span> <span class="p">}</span>
<span class="p">},</span> <span class="n">intFloatString</span><span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">visit</span><span class="p">(</span><span class="n">PrintVisitor</span><span class="p">,</span> <span class="n">intFloatString</span><span class="p">);</span>
<span class="c1">// prints: "HelloHello"
</span></code></pre></div><p data-pid="-gONp3ii">运行代码 <a href="https://link.zhihu.com/?target=http%3A//coliru.stacked-crooked.com/a/666fdd79c5bcb80c" class=" wrap external" target="_blank" rel="nofollow noreferrer">@Coliru</a></p><p data-pid="LHnHvS8u">以下是解释该功能的完整博客文章：<a href="https://link.zhihu.com/?target=https%3A//www.cppstories.com/2019/02/2lines3featuresoverload.html/" class=" wrap external" target="_blank" rel="nofollow noreferrer">2 Lines Of Code and 3 C++17 Features - The overload Pattern - C++ Stories.</a></p><p data-pid="ZZkmNFYR">以及其他的一些文章：</p><ul><li data-pid="WsIgJpNf"><a href="https://link.zhihu.com/?target=https%3A//arne-mertz.de/2018/05/overload-build-a-variant-visitor-on-the-fly/" class=" wrap external" target="_blank" rel="nofollow noreferrer"> SimplifyC++ - Overload: Build a Variant Visitor on the Fly.</a></li><li data-pid="SQv-z5ma"><code>std::overload</code>的提案的论文：<a href="https://link.zhihu.com/?target=https%3A//www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/p0051r3.pdf" class=" wrap external" target="_blank" rel="nofollow noreferrer"> P0051 - C++generic overload function</a></li><li data-pid="KaDT-24t">如果你想知道std::visit是如何工作的，那么你可以看看这篇文章：<a href="https://link.zhihu.com/?target=https%3A//mpark.github.io/programming/2015/07/07/variant-visitation/" class=" wrap external" target="_blank" rel="nofollow noreferrer"> Variant Visitation </a>by Michael Park</li></ul><h2 id="h_607734474_8" data-into-catalog-status="">std::variant的其他操作</h2><ul><li data-pid="5aj1rVRi">你可以比较两个相同类型的variant：如果它们拥有相同的激活类型项，则会调用该类型的比较运算符。否则会根据它们激活类型的索引值大小进行比较。</li><li data-pid="3faCT1-e">variant是一种值类型，因此可以移动它。</li><li data-pid="FFA1dJCU">可以在variant上使用std::hash。</li></ul><h2 id="h_607734474_9" data-into-catalog-status="">异常安全保证</h2><p data-pid="pzzJhwhD">到目前为止，一切看起来都很好，很顺利...但是，如果在variant赋值期间出现异常，会发生什么情况？</p><p data-pid="bQA-TmQ4">举个例子：</p><div class="highlight"><pre><code class="language-cpp"><span class="k">class</span> <span class="nc">ThrowingClass</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="k">explicit</span> <span class="n">ThrowingClass</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">throw</span> <span class="kt">int</span> <span class="p">(</span><span class="mi">10</span><span class="p">);</span> <span class="p">}</span>
    <span class="k">operator</span> <span class="nf">int</span> <span class="p">()</span> <span class="p">{</span> <span class="k">throw</span> <span class="kt">int</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span> <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">ThrowingClass</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>

    <span class="c1">// change the value:
</span><span class="c1"></span>    <span class="k">try</span>
    <span class="p">{</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">ThrowingClass</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(...)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"catch(...)</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
        <span class="c1">// we keep the old state!
</span><span class="c1"></span>        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">valueless_by_exception</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>   
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span> 
    <span class="p">}</span>

    <span class="c1">// inside emplace
</span><span class="c1"></span>    <span class="k">try</span>
    <span class="p">{</span>
        <span class="n">v</span><span class="p">.</span><span class="n">emplace</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ThrowingClass</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span> <span class="c1">// calls the operator int
</span><span class="c1"></span>    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(...)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"catch(...)</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
        <span class="c1">// the old state was destroyed, so we're not in invalid state!
</span><span class="c1"></span>        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">valueless_by_exception</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>   
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p data-pid="hgzrxqDV">运行代码 <a href="https://link.zhihu.com/?target=http%3A//coliru.stacked-crooked.com/a/413ce70317dbd2e5" class=" wrap external" target="_blank" rel="nofollow noreferrer">@Coliru</a></p><p data-pid="uasz-jxr">输出如下：</p><div class="highlight"><pre><code class="language-text">atch(...)
0
0
catch(...)
1
</code></pre></div><p data-pid="mXF_XHLz">第一种情况，在使用赋值运算符时，在类的构造函数中引发异常。该异常发生在variant的旧值被替换之前，因此variant中的状态保持不变，我们仍然可以正常访问它。</p><p data-pid="RqWe7oWq">第二种情况，使用<code>emplace</code>，此时是variant中的旧状态被销毁后引发异常。Emplace调用<code>operator int</code>来替换值，但此时引发异常之后会导致variant处于错误状态，而无法恢复。</p><p data-pid="w3Drs-zt">因异常无值的 variant 被当做在非法态： <code>index</code> 返回 <code>variant_npos</code> ， <code>get</code> 与 <code>visit</code> 抛出 <code>bad_variant_access</code> 。</p><h2 id="h_607734474_10" data-into-catalog-status="">性能和内存注意事项</h2><p data-pid="xC6mIRnB"><code>std::variant</code>和<code>Union</code>的使用内存方式类似：它采用存储类型的最大大小。但是，由于我们需要知道当前variant中激活的类型，因此variant中需要更多的一点存储空间。</p><p data-pid="fkZAKmAo">此外，一切都需要遵守对齐规则。以下是一些储存大小测试数据：</p><div class="highlight"><pre><code class="language-cpp"><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"sizeof string: "</span> 
          <span class="o">&lt;&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"sizeof variant&lt;int, string&gt;: "</span> 
          <span class="o">&lt;&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"sizeof variant&lt;int, float&gt;: "</span> 
          <span class="o">&lt;&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">float</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"sizeof variant&lt;int, double&gt;: "</span> 
          <span class="o">&lt;&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
</code></pre></div><p data-pid="6ktle7Yb">在GCC8.1上，32位的运行程序，输出如下：</p><div class="highlight"><pre><code class="language-text">sizeof string: 32
sizeof variant&lt;int, string&gt;: 40
sizeof variant&lt;int, float&gt;: 8
sizeof variant&lt;int, double&gt;: 16
</code></pre></div><p data-pid="XKwj9Uo6">运行代码 <a href="https://link.zhihu.com/?target=http%3A//coliru.stacked-crooked.com/a/90fcd7d520abcaf3" class=" wrap external" target="_blank" rel="nofollow noreferrer">@Coliru</a></p><p data-pid="a7yYM8P2">variant不会分配任何额外的堆空间，虽然variant为了保证类型安全多占用了几个字节的存储空间，但它不会多花费运行时的性能。</p><h2 id="h_607734474_11" data-into-catalog-status="">迁移自boost::variant</h2><p data-pid="KcOggAsW">Boost Variant 是在 2004 年推出的，因此在<code>std::variant</code>被添加到标准库之前已有 13年的经验。STL借鉴了boost中的经验并对其进行了改进。</p><p data-pid="2YlKBs5z">主要改变如下：</p><table data-draft-node="block" data-draft-type="table" data-size="normal" data-row-style="striped"><tbody><tr><th>特点</th><th>boost::variant(1.67.0)</th><th>std::variant</th></tr><tr><td>额外的内存分配</td><td>可能在赋值时发生, 参见Design Overview - Never Empty</td><td>否</td></tr><tr><td>访问值</td><td>apply_visitor</td><td>std::visit</td></tr><tr><td>按索引获取值</td><td>否</td><td>是</td></tr><tr><td>递归的variant</td><td>是，参加make_recursive_variant</td><td>否</td></tr><tr><td>空值的处理</td><td>boost::blank</td><td>std::monostate</td></tr></tbody></table><p data-pid="LHuHLWEx"><a href="https://link.zhihu.com/?target=https%3A//github.com/CppCon/CppCon2016/tree/master/Presentations/Variants%2520-%2520Past%252C%2520Present%252C%2520and%2520Future" class=" wrap external" target="_blank" rel="nofollow noreferrer">Variants - Past, Present, and Future - David Sankel - CppCon 2016</a> 或者 <a href="https://link.zhihu.com/?target=https%3A//www.youtube.com/watch%3Fv%3Dk3O4EKX4z1c%26t%3D621s" class=" wrap external" target="_blank" rel="nofollow noreferrer">@Youtube</a> 中有更多关于该提案的讨论。</p><h2 id="h_607734474_12" data-into-catalog-status="">std::variant的使用案例</h2><p data-pid="8N393xWf">在我们了解了<code>std::variant</code>的大部分细节之后，在本节中将展示几个实际的使用案例。</p><h3 id="h_607734474_13" data-into-catalog-status="">错误处理</h3><p data-pid="B1G0OFta">基本思想是将ErrorCode错误码包装到variant的返回类型中，这样就可以输出有关错误的更多信息，而不使用异常或输出参数。这类似于 C++23 中的<code>std::expected</code>，参见 <a href="https://link.zhihu.com/?target=https%3A//en.cppreference.com/w/cpp/utility/expected" class=" wrap external" target="_blank" rel="nofollow noreferrer">std::expected - cppreference.com</a>。</p><div class="highlight"><pre><code class="language-cpp"><span class="k">enum</span> <span class="k">class</span> <span class="nc">ErrorCode</span>
<span class="p">{</span>
    <span class="n">Ok</span><span class="p">,</span>
    <span class="n">SystemError</span><span class="p">,</span>
    <span class="n">IoError</span><span class="p">,</span>
    <span class="n">NetworkError</span>
<span class="p">};</span>

<span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">ErrorCode</span><span class="o">&gt;</span> <span class="n">FetchNameFromNetwork</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ErrorCode</span><span class="o">::</span><span class="n">SystemError</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ErrorCode</span><span class="o">::</span><span class="n">NetworkError</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="s">"Hello World!"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
<span class="p">{</span>
    <span class="k">auto</span> <span class="n">response</span> <span class="o">=</span> <span class="n">FetchNameFromNetwork</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">holds_alternative</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">"n"</span><span class="p">;</span>
    <span class="k">else</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Error!</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">FetchNameFromNetwork</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">holds_alternative</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">"n"</span><span class="p">;</span>
    <span class="k">else</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Error!</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p data-pid="jIkUdYJD">运行代码 <a href="https://link.zhihu.com/?target=http%3A//coliru.stacked-crooked.com/a/92da8c748882edd9" class=" wrap external" target="_blank" rel="nofollow noreferrer">@Coliru</a></p><p data-pid="51NPzitD">在示例中，返回值为ErrorCode或有效类型（在本例中为string）。</p><h3 id="h_607734474_14" data-into-catalog-status="">计算方程的根</h3><p data-pid="pXp-4rTN">有时函数的返回值可能会有几个不同选项，例如，求解方程的实根。使用variant，可以包装所有可能的选项，并清楚地表达找到的根值数量。</p><div class="highlight"><pre><code class="language-cpp"><span class="k">using</span> <span class="n">DoublePair</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;</span>
<span class="k">using</span> <span class="n">EquationRoots</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="n">DoublePair</span><span class="p">,</span> <span class="kt">double</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">monostate</span><span class="o">&gt;</span><span class="p">;</span> 

<span class="n">EquationRoots</span> <span class="nf">FindRoots</span><span class="p">(</span><span class="kt">double</span> <span class="n">a</span><span class="p">,</span> <span class="kt">double</span> <span class="n">b</span><span class="p">,</span> <span class="kt">double</span> <span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">nan</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>

    <span class="k">auto</span> <span class="n">d</span> <span class="o">=</span> <span class="n">b</span><span class="o">*</span><span class="n">b</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">c</span><span class="p">;</span> <span class="c1">// discriminant
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">double</span> <span class="n">root1</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="p">);</span>
        <span class="kt">double</span> <span class="n">root2</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">-</span> <span class="n">std</span><span class="o">::</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="n">root1</span><span class="p">,</span> <span class="n">root2</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">monostate</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="nc">RootPrinterVisitor</span>
<span class="p">{</span>
    <span class="kt">void</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">DoublePair</span><span class="o">&amp;</span> <span class="n">arg</span><span class="p">)</span> 
    <span class="p">{</span> 
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"2 roots: "</span> <span class="o">&lt;&lt;</span> <span class="n">arg</span><span class="p">.</span><span class="n">first</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span> <span class="o">&lt;&lt;</span> <span class="n">arg</span><span class="p">.</span><span class="n">second</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span> 
    <span class="p">}</span>
    <span class="kt">void</span> <span class="nf">operator</span><span class="p">()(</span><span class="kt">double</span> <span class="n">arg</span><span class="p">)</span> 
    <span class="p">{</span> 
        <span class="k">if</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">isnan</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"not a quadratic equation!"</span> <span class="o">&lt;&lt;</span> <span class="n">arg</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span> 
        <span class="k">else</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"1 root found: "</span> <span class="o">&lt;&lt;</span> <span class="n">arg</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span> 
    <span class="p">}</span>
    <span class="kt">void</span> <span class="nf">operator</span><span class="p">()(</span><span class="n">std</span><span class="o">::</span><span class="n">monostate</span><span class="p">)</span> 
    <span class="p">{</span> 
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"No real roots found.</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span> 
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">visit</span><span class="p">(</span><span class="n">RootPrinterVisitor</span><span class="p">{},</span> <span class="n">FindRoots</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">));</span>
    <span class="n">std</span><span class="o">::</span><span class="n">visit</span><span class="p">(</span><span class="n">RootPrinterVisitor</span><span class="p">{},</span> <span class="n">FindRoots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
    <span class="n">std</span><span class="o">::</span><span class="n">visit</span><span class="p">(</span><span class="n">RootPrinterVisitor</span><span class="p">{},</span> <span class="n">FindRoots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
    <span class="n">std</span><span class="o">::</span><span class="n">visit</span><span class="p">(</span><span class="n">RootPrinterVisitor</span><span class="p">{},</span> <span class="n">FindRoots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">));</span>
    <span class="n">std</span><span class="o">::</span><span class="n">visit</span><span class="p">(</span><span class="n">RootPrinterVisitor</span><span class="p">{},</span> <span class="n">FindRoots</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div><p data-pid="cxiKJC5k">运行代码 <a href="https://link.zhihu.com/?target=https%3A//godbolt.org/z/WqoKxff1z" class=" wrap external" target="_blank" rel="nofollow noreferrer">@Compiler Explorer</a></p><p data-pid="mGoHXBch">输出如下：</p><div class="highlight"><pre><code class="language-cpp"><span class="mi">2</span> <span class="n">roots</span> <span class="nl">found</span><span class="p">:</span> <span class="mf">0.447214</span> <span class="o">-</span><span class="mf">0.447214</span>
<span class="mi">2</span> <span class="n">roots</span> <span class="nl">found</span><span class="p">:</span> <span class="mf">0.707107</span> <span class="o">-</span><span class="mf">0.707107</span>
<span class="mi">1</span> <span class="n">root</span> <span class="nl">found</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">No</span> <span class="n">real</span> <span class="n">roots</span> <span class="n">found</span><span class="p">.</span>
<span class="n">not</span> <span class="n">a</span> <span class="n">quadratic</span> <span class="n">equation</span><span class="o">!</span> <span class="n">nan</span>
</code></pre></div><h3 id="h_607734474_15" data-into-catalog-status="">解析命令行</h3><p data-pid="OoXk2c3Z">命令行可能包含以几种方式的文本参数：</p><ul><li data-pid="oVir0OMV">整数</li><li data-pid="BJtrUM9f">布尔值</li><li data-pid="yE8Ke41n">字符串</li><li data-pid="h3AO8BkH">...</li></ul><p data-pid="3M3Fpy2v">我们可以构建一个包含所有可能选项的variant，以下示例是一个包含int和string的简单版本。</p><div class="highlight"><pre><code class="language-cpp"><span class="k">class</span> <span class="nc">CmdLine</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="k">using</span> <span class="n">Arg</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">;</span>

<span class="k">private</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">Arg</span><span class="o">&gt;</span> <span class="n">mParsedArgs</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
    <span class="k">explicit</span> <span class="n">CmdLine</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span> <span class="n">ParseArgs</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span> <span class="p">}</span>

    <span class="c1">// ...
</span><span class="c1"></span><span class="p">};</span>
</code></pre></div><div class="highlight"><pre><code class="language-cpp"><span class="n">CmdLine</span><span class="o">::</span><span class="n">Arg</span> <span class="n">TryParseString</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// try with int first
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">iResult</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">auto</span> <span class="n">res</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">from_chars</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">arg</span><span class="o">+</span><span class="n">strlen</span><span class="p">(</span><span class="n">arg</span><span class="p">),</span> <span class="n">iResult</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">ec</span> <span class="o">==</span> <span class="n">std</span><span class="o">::</span><span class="n">errc</span><span class="o">::</span><span class="n">invalid_argument</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// if not possible, then just assume it's a string
</span><span class="c1"></span>        <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">arg</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">iResult</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">CmdLine</span><span class="o">::</span><span class="n">ParseArgs</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// the form: -argName value -argName value
</span><span class="c1"></span>    <span class="c1">// unnamed? later...
</span><span class="c1"></span>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">argc</span><span class="p">;</span> <span class="n">i</span><span class="o">+=</span><span class="mi">2</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">'-'</span><span class="p">)</span> <span class="c1">// super advanced pattern matching! :)
</span><span class="c1"></span>            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">"wrong command name"</span><span class="p">);</span>

        <span class="n">mParsedArgs</span><span class="p">[</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">TryParseString</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p data-pid="mJxJLTBz"><code>std::from_chars</code>在GCC中仅支持整数，在MSVC中支持浮点数。<code>TryParseString</code>函数尝试将输入字符串解析为其最佳匹配的类型，如果它看起来像一个整数，那么我们尝试将其转换为整数。否则，我们将返回一个未解析的字符串。</p><p data-pid="05uDu7Bk">下面展示我们如何使用它：</p><div class="highlight"><pre><code class="language-cpp"><span class="k">try</span>
<span class="p">{</span>
    <span class="n">CmdLine</span> <span class="nf">cmdLine</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>

    <span class="k">auto</span> <span class="n">arg</span> <span class="o">=</span> <span class="n">cmdLine</span><span class="p">.</span><span class="n">Find</span><span class="p">(</span><span class="s">"paramInt"</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">arg</span> <span class="o">&amp;&amp;</span> <span class="n">std</span><span class="o">::</span><span class="n">holds_alternative</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">))</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"paramInt is "</span> 
                  <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

    <span class="n">arg</span> <span class="o">=</span> <span class="n">cmdLine</span><span class="p">.</span><span class="n">Find</span><span class="p">(</span><span class="s">"textParam"</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">arg</span> <span class="o">&amp;&amp;</span> <span class="n">std</span><span class="o">::</span><span class="n">holds_alternative</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">))</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"textParam is "</span> 
                  <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>    
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span> <span class="o">&amp;</span><span class="n">err</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p data-pid="1UX2qHUG">运行代码 <a href="https://link.zhihu.com/?target=http%3A//coliru.stacked-crooked.com/a/084579f913d0d821" class=" wrap external" target="_blank" rel="nofollow noreferrer">@Coliru</a></p><h3 id="h_607734474_16" data-into-catalog-status="">状态机</h3><p data-pid="H3bO_DWa">什么是状态机？例如，门的状态：</p><p></p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-59a5059ee4c0e71ad28a7b2aac7639f9_b.jpg" data-size="normal" class="content_image"/></noscript><div><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;0&#39; height=&#39;0&#39;&gt;&lt;/svg&gt;" data-size="normal" class="content_image lazy" data-actualsrc="https://pic2.zhimg.com/v2-59a5059ee4c0e71ad28a7b2aac7639f9_b.jpg" data-original-token="v2-59a5059ee4c0e71ad28a7b2aac7639f9"></div><figcaption>Image</figcaption></figure><p></p><p data-pid="zpDPNCNU">定义不同类型的状态：</p><div class="highlight"><pre><code class="language-cpp"><span class="k">struct</span> <span class="nc">DoorState</span> 
<span class="p">{</span>
    <span class="k">struct</span> <span class="nc">DoorOpened</span> <span class="p">{};</span>
    <span class="k">struct</span> <span class="nc">DoorClosed</span> <span class="p">{};</span>
    <span class="k">struct</span> <span class="nc">DoorLocked</span> <span class="p">{};</span>

    <span class="k">using</span> <span class="n">State</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="n">DoorOpened</span><span class="p">,</span> <span class="n">DoorClosed</span><span class="p">,</span> <span class="n">DoorLocked</span><span class="o">&gt;</span><span class="p">;</span>

    <span class="kt">void</span> <span class="nf">open</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">m_state</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">visit</span><span class="p">(</span><span class="n">OpenEvent</span><span class="p">{},</span> <span class="n">m_state</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">close</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">m_state</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">visit</span><span class="p">(</span><span class="n">CloseEvent</span><span class="p">{},</span> <span class="n">m_state</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">lock</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">m_state</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">visit</span><span class="p">(</span><span class="n">LockEvent</span><span class="p">{},</span> <span class="n">m_state</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">unlock</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">m_state</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">visit</span><span class="p">(</span><span class="n">UnlockEvent</span><span class="p">{},</span> <span class="n">m_state</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">State</span> <span class="n">m_state</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div><p data-pid="ADBCbOHC">定义不同的event：</p><div class="highlight"><pre><code class="language-cpp"><span class="k">struct</span> <span class="nc">OpenEvent</span> 
<span class="p">{</span>
    <span class="n">State</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">DoorOpened</span><span class="o">&amp;</span><span class="p">){</span> <span class="k">return</span> <span class="n">DoorOpened</span><span class="p">();</span> <span class="p">}</span>
    <span class="n">State</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">DoorClosed</span><span class="o">&amp;</span><span class="p">){</span> <span class="k">return</span> <span class="n">DoorOpened</span><span class="p">();</span> <span class="p">}</span>
    <span class="c1">// cannot open locked doors
</span><span class="c1"></span>    <span class="n">State</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">DoorLocked</span><span class="o">&amp;</span><span class="p">){</span> <span class="k">return</span> <span class="n">DoorLocked</span><span class="p">();</span> <span class="p">}</span> 
<span class="p">};</span>

<span class="k">struct</span> <span class="nc">CloseEvent</span> 
<span class="p">{</span>
    <span class="n">State</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">DoorOpened</span><span class="o">&amp;</span><span class="p">){</span> <span class="k">return</span> <span class="n">DoorClosed</span><span class="p">();</span> <span class="p">}</span>
    <span class="n">State</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">DoorClosed</span><span class="o">&amp;</span><span class="p">){</span> <span class="k">return</span> <span class="n">DoorClosed</span><span class="p">();</span> <span class="p">}</span>
    <span class="n">State</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">DoorLocked</span><span class="o">&amp;</span><span class="p">){</span> <span class="k">return</span> <span class="n">DoorLocked</span><span class="p">();</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="nc">LockEvent</span> 
<span class="p">{</span>
    <span class="c1">// cannot lock opened doors
</span><span class="c1"></span>    <span class="n">State</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">DoorOpened</span><span class="o">&amp;</span><span class="p">){</span> <span class="k">return</span> <span class="n">DoorOpened</span><span class="p">();</span> <span class="p">}</span>
    <span class="n">State</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">DoorClosed</span><span class="o">&amp;</span><span class="p">){</span> <span class="k">return</span> <span class="n">DoorLocked</span><span class="p">();</span> <span class="p">}</span>
    <span class="n">State</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">DoorLocked</span><span class="o">&amp;</span><span class="p">){</span> <span class="k">return</span> <span class="n">DoorLocked</span><span class="p">();</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="nc">UnlockEvent</span> 
<span class="p">{</span>
    <span class="c1">// cannot unlock opened doors
</span><span class="c1"></span>    <span class="n">State</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">DoorOpened</span><span class="o">&amp;</span><span class="p">){</span> <span class="k">return</span> <span class="n">DoorOpened</span><span class="p">();</span> <span class="p">}</span>
    <span class="n">State</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">DoorClosed</span><span class="o">&amp;</span><span class="p">){</span> <span class="k">return</span> <span class="n">DoorClosed</span><span class="p">();</span> <span class="p">}</span>
    <span class="c1">// unlock
</span><span class="c1"></span>    <span class="n">State</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">DoorLocked</span><span class="o">&amp;</span><span class="p">){</span> <span class="k">return</span> <span class="n">DoorClosed</span><span class="p">();</span> <span class="p">}</span> 
<span class="p">};</span>
</code></pre></div><p data-pid="jdYl_s60">示例代码参见：<a href="https://link.zhihu.com/?target=http%3A//coliru.stacked-crooked.com/a/1828b27f5b94e693" class=" wrap external" target="_blank" rel="nofollow noreferrer">@Coliru</a></p><p data-pid="YM_G3XlO">具体更详细关于有限状态机的解析，参见文章： <a href="https://link.zhihu.com/?target=https%3A//www.patreon.com/posts/53399468" class=" wrap external" target="_blank" rel="nofollow noreferrer">the first about "enum style FSM into variant-based" or the second</a>或者<a href="https://link.zhihu.com/?target=https%3A//www.patreon.com/posts/53936285" class=" wrap external" target="_blank" rel="nofollow noreferrer"> the second article</a> 。</p><p data-pid="pgZgH4tU">这个示例想法基于以下的文章博客，可以参考一下：</p><ul><li data-pid="RMwHDg1M"><a href="https://link.zhihu.com/?target=http%3A//mooooo.ooo/sumtypes-and-statemachines/" class=" wrap external" target="_blank" rel="nofollow noreferrer">Sum types and state machines in C++17</a></li><li data-pid="w32YkGqQ"><a href="https://link.zhihu.com/?target=http%3A//khuttun.github.io/2017/02/04/implementing-state-machines-with-std-variant.html" class=" wrap external" target="_blank" rel="nofollow noreferrer">Implementing State Machines with std::variant</a></li></ul><h3 id="h_607734474_17" data-into-catalog-status="">实现多态</h3><p data-pid="4bkk4PKr">在大多数情况下，我们通常会在C++中使用基于虚表的运行时多态。但是采用variant和visit我们可以堆一组没有公共基类的类型实现静态多态的功能。</p><p data-pid="W3bFlMye">示例代码如下：</p><div class="highlight"><pre><code class="language-cpp"><span class="k">class</span> <span class="nc">Triangle</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="kt">void</span> <span class="n">Render</span><span class="p">()</span>  <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Drawing a triangle!</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">Polygon</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="kt">void</span> <span class="n">Render</span><span class="p">()</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Drawing a polygon!</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">Sphere</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="kt">void</span> <span class="n">Render</span><span class="p">()</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Drawing a sphere!</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="n">Triangle</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">,</span> <span class="n">Sphere</span><span class="o">&gt;&gt;</span> <span class="n">objects</span> <span class="p">{</span> 
        <span class="n">Polygon</span><span class="p">(),</span> 
        <span class="n">Triangle</span><span class="p">(),</span>
        <span class="n">Sphere</span><span class="p">(),</span>
        <span class="n">Triangle</span><span class="p">()</span>
    <span class="p">};</span>

    <span class="k">auto</span> <span class="n">CallRender</span> <span class="o">=</span> <span class="p">[](</span><span class="k">auto</span><span class="o">&amp;</span> <span class="n">obj</span><span class="p">)</span> <span class="p">{</span> <span class="n">obj</span><span class="p">.</span><span class="n">Render</span><span class="p">();</span> <span class="p">};</span>

    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span> <span class="nl">obj</span> <span class="p">:</span> <span class="n">objects</span><span class="p">)</span>
        <span class="n">std</span><span class="o">::</span><span class="n">visit</span><span class="p">(</span><span class="n">CallRender</span><span class="p">,</span> <span class="n">obj</span><span class="p">);</span>

<span class="p">}</span>
</code></pre></div><p data-pid="P1_2-dD2">运行代码 <a href="https://link.zhihu.com/?target=http%3A//coliru.stacked-crooked.com/a/2a2bcdb43d89de87" class=" wrap external" target="_blank" rel="nofollow noreferrer">@Coliru</a></p><p data-pid="w2jzzKvT">输出如下；</p><div class="highlight"><pre><code class="language-text">Drawing a polygon!
Drawing a triangle!
Drawing a sphere!
Drawing a triangle!
</code></pre></div><p data-pid="6gqQnNYG">上面的示例中，展示了从一组不相关类型中调用方法的情况。我们将不同的形状类型包装到单个variant中，然后使用visit来调用相应的函数到正确的类型。</p><p data-pid="akt7Cjbm">另一篇文章详细解释了这种多态性：<a href="https://link.zhihu.com/?target=https%3A//www.cppstories.com/2020/04/variant-virtual-polymorphism.html/" class=" wrap external" target="_blank" rel="nofollow noreferrer">Runtime Polymorphism with std::variant and std::visit - C++ Stories</a>。</p><p data-pid="w2CpCwUg">你可以在以下文章来了解此模式的更多信息：</p><ul><li data-pid="1q_AEk97"><a href="https://link.zhihu.com/?target=https%3A//akrzemi1.wordpress.com/2016/02/27/another-polymorphism/" class=" wrap external" target="_blank" rel="nofollow noreferrer">Another polymorphism | Andrzej’s C++ blog</a></li><li data-pid="xzL8ZTQy"><a href="https://link.zhihu.com/?target=http%3A//cpptruths.blogspot.com/2018/02/inheritance-vs-stdvariant-based.html" class=" wrap external" target="_blank" rel="nofollow noreferrer">Inheritance vs std::variant, C++ Truths</a></li></ul><h3 id="h_607734474_18" data-into-catalog-status="">其他用途</h3><p data-pid="NbUZ8mU4">这里还有很多很多例子，请参见以下推特链接：</p><ul><li data-pid="zvqheVsX"><a href="https://link.zhihu.com/?target=https%3A//twitter.com/hashtag/cpp17%3Fsrc%3Dhash%26ref_src%3Dtwsrc%255Etfw" class=" wrap external" target="_blank" rel="nofollow noreferrer">do you have any real-life examples of std::variant?#cpp #cpp17</a></li><li data-pid="6PS3gCUp"><a href="https://link.zhihu.com/?target=https%3A//twitter.com/fenbf/status/999755954005663744%3Fref_src%3Dtwsrc%255Etfw" class=" wrap external" target="_blank" rel="nofollow noreferrer">Bartlomiej Filipek (@fenbf) 24 maja 2018</a></li></ul><h2 id="h_607734474_19" data-into-catalog-status="">C++20和C++23改进</h2><p data-pid="XPSXW_e3">C++20和C++23中<code>std::variant</code>进行了一些小的更新。例如，感谢 <a href="https://link.zhihu.com/?target=https%3A//www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2231r1.html" class=" wrap external" target="_blank" rel="nofollow noreferrer">P2231</a>得以在C++20中实现，我们可以在常量表达式中使用<code>std::variant</code>。</p><div class="highlight"><pre><code class="language-cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;variant&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="k">constexpr</span> <span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;</span> <span class="n">foo</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;</span> <span class="n">oi</span> <span class="p">{</span> <span class="n">x</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="p">};</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">oi</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">oi</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="k">constexpr</span> <span class="k">auto</span> <span class="n">dv</span> <span class="o">=</span> <span class="n">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
   <span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">holds_alternative</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">dv</span><span class="p">));</span>
   <span class="k">constexpr</span> <span class="k">auto</span> <span class="n">iv</span> <span class="o">=</span> <span class="n">foo</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
   <span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">holds_alternative</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">iv</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div><p data-pid="N4kwEYJ6">运行代码 <a href="https://link.zhihu.com/?target=https%3A//godbolt.org/z/3f1zrKnrb" class=" wrap external" target="_blank" rel="nofollow noreferrer">@Compiler Explorer</a></p><p data-pid="vRXscFqP">此外，对于以下情况，还有一个重要的修复：</p><div class="highlight"><pre><code class="language-cpp"><span class="n">variant</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="kt">bool</span><span class="o">&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="s">"abc"</span><span class="p">;</span>             <span class="c1">// holds bool !!
</span></code></pre></div><p data-pid="vyziC9uc">具体可以参见：<a href="https://link.zhihu.com/?target=https%3A//www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/p0608r3.html" class=" wrap external" target="_blank" rel="nofollow noreferrer"> A sane std::variant converting constructor </a>。</p><p data-pid="k9Zo7Xc0">还有一些其他的特性：</p><ul><li data-pid="ZWU4uWiu"><code>std::visit</code>对于继承于<code>std::variant</code>的子类的应用，<a href="https://link.zhihu.com/?target=https%3A//www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2162r2.html" class=" wrap external" target="_blank" rel="nofollow noreferrer">std::visit() for classes derived from std::variant</a></li><li data-pid="7QZSR1vs"><a href="https://link.zhihu.com/?target=https%3A//www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/p0602r4.html" class=" wrap external" target="_blank" rel="nofollow noreferrer">std::variant and std::optional should propagate copy/move triviality</a></li></ul><h2 id="h_607734474_20" data-into-catalog-status="">其他</h2><p data-pid="FrvEEY16">关于<code>std::variant</code>的一些其他文章参考：</p><ul><li data-pid="Ipjj-X6s"><a href="https://link.zhihu.com/?target=http%3A//www.modernescpp.com/index.php/c-17-constructed-in-place" class=" wrap external" target="_blank" rel="nofollow noreferrer">C++17 has a Visitor Modernes C++</a></li><li data-pid="_KU0qzLM"><a href="https://link.zhihu.com/?target=https%3A//www.foonathan.net/2016/12/variant/" class=" wrap external" target="_blank" rel="nofollow noreferrer">My take on variant - Jonathan Müller</a></li></ul><h2 id="h_607734474_21" data-into-catalog-status="">参考</h2><p data-pid="VmtjhOGn"><a href="https://link.zhihu.com/?target=https%3A//www.cppstories.com/2018/06/variant/%23overload" class=" wrap external" target="_blank" rel="nofollow noreferrer">Everything You Need to Know About std::variant from C++17</a></p><p data-pid="h5elNDFN">相关或相似的文章：</p><ul><li data-pid="iL4O1zZo"><a href="https://link.zhihu.com/?target=https%3A//www.cppstories.com/2018/05/errors-and-optional/" class=" wrap external" target="_blank" rel="nofollow noreferrer">Error Handling and std::optional</a></li><li data-pid="hjF16J8Y"><a href="https://link.zhihu.com/?target=https%3A//www.cppstories.com/2019/06/fsm-variant-game/" class=" wrap external" target="_blank" rel="nofollow noreferrer">Space Game: A std::variant-Based State Machine by Example</a></li><li data-pid="Eiu6KOX9"><a href="https://link.zhihu.com/?target=https%3A//www.cppstories.com/2018/08/searchers/" class=" wrap external" target="_blank" rel="nofollow noreferrer">Speeding up Pattern Searches with Boyer-Moore Algorithm from C++17</a></li><li data-pid="QK6YnJ80"><a href="https://link.zhihu.com/?target=https%3A//www.cppstories.com/2018/12/fromchars/" class=" wrap external" target="_blank" rel="nofollow noreferrer">How to Use The Newest C++ String Conversion Routines - std::from_chars</a></li><li data-pid="6BWIyT7v"><a href="https://link.zhihu.com/?target=https%3A//www.cppstories.com/2018/11/pstl/" class=" wrap external" target="_blank" rel="nofollow noreferrer">How to Boost Performance with Intel Parallel STL and C++17 Parallel Algorithms</a></li></ul><blockquote data-pid="jsmGKmVt"><p data-pid="KsRSkL9X">本文使用 <a href="https://zhuanlan.zhihu.com/p/106057556" class="internal">Zhihu On VSCode</a> 创作并发布</p></blockquote></div></div></div></div><div role="button" tabindex="0" class="ContentItem-time">编辑于 2023-02-23 22:58<!-- -->・IP 属地北京</div><div class="Reward"><div><div class="Reward-tagline">「真诚赞赏，手留余香」</div><button class="Reward-rewardBtn">赞赏</button></div><div class="Reward-countZero">还没有人赞赏，快来当第一个赞赏的人吧！</div></div><div class="Post-topicsAndReviewer"><div class="TopicList Post-Topics"><div class="Tag Topic css-ch8ocw" data-za-detail-view-path-module="TopicItem" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Topic&quot;,&quot;token&quot;:&quot;19584970&quot;}}}"><span class="Tag-content"><a class="TopicLink" href="https://www.zhihu.com/topic/19584970" target="_blank"><div class="css-1gomreu">C++</div></a></span></div><div class="Tag Topic css-ch8ocw" data-za-detail-view-path-module="TopicItem" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Topic&quot;,&quot;token&quot;:&quot;26652979&quot;}}}"><span class="Tag-content"><a class="TopicLink" href="https://www.zhihu.com/topic/26652979" target="_blank"><div class="css-1gomreu">C++ STL</div></a></span></div></div></div><div><div class="Sticky RichContent-actions is-fixed is-bottom" style="width: 690px; bottom: 0px; left: 520.909px;"><div class="ContentItem-actions" data-za-detail-view-path-module="BottomBar" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Post&quot;,&quot;id&quot;:&quot;607734474&quot;}}}"><span><button aria-label="赞同 17 " aria-live="polite" type="button" class="Button VoteButton VoteButton--up FEfUrdfMIKpQDJDqkjte"><span style="display:inline-flex;align-items:center">​<svg width="10" height="10" viewBox="0 0 24 24" class="Zi Zi--TriangleUp VoteButton-TriangleUp" fill="currentColor"><path fill-rule="evenodd" d="M13.792 3.681c-.781-1.406-2.803-1.406-3.584 0l-7.79 14.023c-.76 1.367.228 3.046 1.791 3.046h15.582c1.563 0 2.55-1.68 1.791-3.046l-7.79-14.023Z" clip-rule="evenodd"></path></svg></span>赞同 17</button><button aria-label="反对" aria-live="polite" type="button" class="Button VoteButton VoteButton--down FEfUrdfMIKpQDJDqkjte"><span style="display:inline-flex;align-items:center">​<svg width="10" height="10" viewBox="0 0 24 24" class="Zi Zi--TriangleDown" fill="currentColor"><path fill-rule="evenodd" d="M13.792 20.319c-.781 1.406-2.803 1.406-3.584 0L2.418 6.296c-.76-1.367.228-3.046 1.791-3.046h15.582c1.563 0 2.55 1.68 1.791 3.046l-7.79 14.023Z" clip-rule="evenodd"></path></svg></span></button></span><button type="button" class="Button BottomActions-CommentBtn FEfUrdfMIKpQDJDqkjte Button--plain Button--withIcon Button--withLabel fEPKGkUK5jyc4fUuT0QP B46v1Ak6Gj5sL2JTS4PY RuuQ6TOh2cRzJr6WlyQp"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="Zi Zi--Comment Button-zi t2ntD6J1DemdOdvh5FB4" fill="currentColor"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>1 条评论</button><div class="Popover ShareMenu"><div class="ShareMenu-toggler" id="Popover2-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover2-content"><button type="button" class="Button FEfUrdfMIKpQDJDqkjte Button--plain Button--withIcon Button--withLabel fEPKGkUK5jyc4fUuT0QP B46v1Ak6Gj5sL2JTS4PY RuuQ6TOh2cRzJr6WlyQp"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="Zi Zi--Share Button-zi t2ntD6J1DemdOdvh5FB4" fill="currentColor"><path d="M19.47 1.914a.8.8 0 0 1 1.204.778l-1.872 16.386a.9.9 0 0 1-1.204.743l-4.615-1.692a.7.7 0 0 0-.831.28l-1.927 3.02c-.43.674-1.474.369-1.474-.43v-3.865a.8.8 0 0 1 .179-.504l5.808-7.148a.595.595 0 0 0-.897-.781l-5.93 6.354a1.1 1.1 0 0 1-1.258.252L2.57 13.46a.8.8 0 0 1-.08-1.415l16.98-10.13Z"></path></svg></span>分享</button></div></div><button aria-live="polite" type="button" class="Button ContentItem-action FEfUrdfMIKpQDJDqkjte Button--plain Button--withIcon Button--withLabel fEPKGkUK5jyc4fUuT0QP B46v1Ak6Gj5sL2JTS4PY RuuQ6TOh2cRzJr6WlyQp"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="Zi Zi--Heart Button-zi t2ntD6J1DemdOdvh5FB4" fill="currentColor"><path fill-rule="evenodd" d="M12.004 4.934c1.015-.944 2.484-1.618 3.98-1.618 3.48 0 6.53 3.265 6.15 7.614-.11 1.254-.686 2.55-1.458 3.753-.778 1.215-1.79 2.392-2.845 3.419-1.054 1.028-2.168 1.923-3.161 2.566a9.96 9.96 0 0 1-1.41.777c-.418.182-.862.32-1.268.32s-.848-.137-1.267-.317a9.918 9.918 0 0 1-1.407-.771c-.992-.64-2.103-1.53-3.156-2.555-1.052-1.024-2.062-2.2-2.84-3.417-.77-1.208-1.346-2.51-1.456-3.775-.38-4.349 2.67-7.614 6.15-7.614 1.484 0 2.983.673 3.988 1.618Z" clip-rule="evenodd"></path></svg></span>喜欢</button><button type="button" class="Button FEfUrdfMIKpQDJDqkjte Button--plain Button--withIcon Button--withLabel fEPKGkUK5jyc4fUuT0QP B46v1Ak6Gj5sL2JTS4PY RuuQ6TOh2cRzJr6WlyQp"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="Zi Zi--Star Button-zi t2ntD6J1DemdOdvh5FB4" fill="currentColor"><path d="M10.484 3.307c.673-1.168 2.358-1.168 3.032 0l2.377 4.122a.25.25 0 0 0 .165.12l4.655.987c1.319.28 1.84 1.882.937 2.884l-3.186 3.535a.25.25 0 0 0-.063.193l.5 4.733c.142 1.34-1.222 2.33-2.453 1.782l-4.346-1.938a.25.25 0 0 0-.204 0l-4.346 1.938c-1.231.549-2.595-.442-2.453-1.782l.5-4.733a.25.25 0 0 0-.064-.193L2.35 11.42c-.903-1.002-.382-2.604.937-2.884l4.655-.987a.25.25 0 0 0 .164-.12l2.378-4.122Z"></path></svg></span>收藏</button><button type="button" class="Button ContentItem-action FEfUrdfMIKpQDJDqkjte Button--plain Button--withIcon Button--withLabel fEPKGkUK5jyc4fUuT0QP B46v1Ak6Gj5sL2JTS4PY RuuQ6TOh2cRzJr6WlyQp"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="Zi Zi--Deliver Button-zi t2ntD6J1DemdOdvh5FB4" fill="currentColor"><g fill-rule="evenodd" clip-rule="evenodd"><path d="M7.821 12a.75.75 0 0 1 .75-.75h6.857a.75.75 0 0 1 0 1.5H8.571a.75.75 0 0 1-.75-.75ZM8.965 8a.75.75 0 0 1 .75-.75h4.571a.75.75 0 0 1 0 1.5H9.715a.75.75 0 0 1-.75-.75Z"></path><path d="M7.527 3.15a2.35 2.35 0 0 0-2.309 1.91L3.165 15.84a.85.85 0 0 0-.015.16v2.5a2.35 2.35 0 0 0 2.35 2.35h13a2.35 2.35 0 0 0 2.35-2.35V16a.848.848 0 0 0-.015-.16L18.78 5.06a2.35 2.35 0 0 0-2.308-1.91H7.527Zm0 1.7a.65.65 0 0 0-.639.528l-1.88 9.872h13.984l-1.88-9.872a.65.65 0 0 0-.64-.528H7.528Z"></path></g></svg></span>申请转载</button><div class="Post-ActionMenuButton"><div class="Popover"><div id="Popover3-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover3-content"><button type="button" class="Button FEfUrdfMIKpQDJDqkjte Button--plain Button--withIcon Button--iconOnly fEPKGkUK5jyc4fUuT0QP B46v1Ak6Gj5sL2JTS4PY hIwDV_tcL6XN1HprrnAq"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="Zi Zi--Dots Button-zi t2ntD6J1DemdOdvh5FB4" fill="currentColor"><path d="M5.165 13.665a1.665 1.665 0 1 0 0-3.33 1.665 1.665 0 0 0 0 3.33ZM13.665 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM18.835 13.665a1.665 1.665 0 1 0 0-3.33 1.665 1.665 0 0 0 0 3.33Z"></path></svg></span></button></div></div></div></div><div class="Post-SideActions" style="opacity: 1;"><button class="like"><div class="Post-SideActions-icon"><svg width="16" height="16" viewBox="0 0 24 24" class="Zi Zi--TriangleUp Post-SideActions-upIcon" fill="currentColor"><path fill-rule="evenodd" d="M13.792 3.681c-.781-1.406-2.803-1.406-3.584 0l-7.79 14.023c-.76 1.367.228 3.046 1.791 3.046h15.582c1.563 0 2.55-1.68 1.791-3.046l-7.79-14.023Z" clip-rule="evenodd"></path></svg></div><div class="likeCount"><div class="likeCount-inner" data-previous="已赞同 18">赞同 17</div></div></button><div class="Popover ShareMenu"><div class="ShareMenu-toggler" id="Popover9-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover9-content"><button><div class="Post-SideActions-icon"><span style="display: inline-flex; align-items: center;">​<svg width="20" height="20" viewBox="0 0 24 24" class="Zi Zi--Share" fill="currentColor"><path d="M19.47 1.914a.8.8 0 0 1 1.204.778l-1.872 16.386a.9.9 0 0 1-1.204.743l-4.615-1.692a.7.7 0 0 0-.831.28l-1.927 3.02c-.43.674-1.474.369-1.474-.43v-3.865a.8.8 0 0 1 .179-.504l5.808-7.148a.595.595 0 0 0-.897-.781l-5.93 6.354a1.1 1.1 0 0 1-1.258.252L2.57 13.46a.8.8 0 0 1-.08-1.415l16.98-10.13Z"></path></svg></span></div>分享</button></div></div></div></div><div class="Sticky--holder" style="position: static; inset: auto auto 0px 0px; display: block; float: none; margin: 0px 0px 10px; height: 53.8068px;"></div></div></article><div class="Post-Sub Post-NormalSub"><div style="overflow: unset;" data-za-detail-view-path-module="CommentList" data-za-extra-module="{}"><div class="Comments-container css-plbgu"><div class="css-79elbk"><div><div class="css-1fo89v5"><img class="Avatar css-m4psdq" src="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/v2-abed1a8c04700ba7d72b45195223e0ff_l.jpg" srcset="https://picx.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_l.jpg?source=32738c0c 2x"><div class="css-14zbeoe"><div class="css-i6bazn"><div class="css-0"><div class="InputLike css-1rl4wxv Editable"><div class="Dropzone Editable-content RichText RichText--editable RichText--clearBoth ztext" style="min-height: 38px;"><div class="DraftEditor-root"><div class="public-DraftEditorPlaceholder-root"><div class="public-DraftEditorPlaceholder-inner" id="placeholder-m9ej" style="white-space: pre-wrap;">发布一条带图评论吧</div></div><div class="DraftEditor-editorContainer"><div aria-describedby="placeholder-m9ej" class="notranslate public-DraftEditor-content" contenteditable="true" spellcheck="true" tabindex="0" style="outline: none; user-select: text; white-space: pre-wrap; overflow-wrap: break-word;" role="textbox"><div data-contents="true"><div class="Editable-unstyled" data-block="true" data-editor="m9ej" data-offset-key="beqap-0-0"><div data-offset-key="beqap-0-0" class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr"><span data-offset-key="beqap-0-0"><br data-text="true"></span></div></div></div></div></div></div></div><div></div><input multiple="" type="file" accept="image/webp,image/jpg,image/jpeg,image/png,image/gif" style="display: none;"></div></div></div></div></div></div><div class="css-u76jt1"><div class="css-hzocic"><div class="css-r4op92"><div class="css-1k10w8f">1 条评论</div></div><div class="css-59erns"></div><div class="css-97fdvh"><div class="css-m0zh86">默认</div><div class="css-1fjr6cy">最新</div></div></div><div class="css-840pn3"><div class="css-1frn93x"><div data-id="10451065415"><div class="css-194v73m"><div class="css-1jll2aj"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/840c4a758bc87d57c52be040123c6bc6" target="_blank" class="css-19j0adl"><img class="Avatar css-1ljippv" src="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/v2-abed1a8c04700ba7d72b45195223e0ff_l(1).jpg" srcset="https://picx.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_l.jpg?source=06d4cd63 2x" alt="破浪" loading="lazy"></a></div></div><div class="css-14nvvry"><div class="css-z0cc58"><div class="css-swj9d4"><div class="css-1tww9qq"><div class="css-1gomreu"><a href="https://www.zhihu.com/people/840c4a758bc87d57c52be040123c6bc6" target="_blank" class="css-10ub9de">破浪</a></div><div class="css-1qe0v6x"><div class="css-1ssbn0c"></div></div></div></div><svg width="16" height="16" viewBox="0 0 24 24" class="ZDI ZDI--Dots24 css-zgte1c" fill="currentColor"><path d="M5.165 13.665a1.665 1.665 0 1 0 0-3.33 1.665 1.665 0 0 0 0 3.33ZM13.665 12a1.665 1.665 0 1 1-3.33 0 1.665 1.665 0 0 1 3.33 0ZM18.835 13.665a1.665 1.665 0 1 0 0-3.33 1.665 1.665 0 0 0 0 3.33Z"></path></svg></div><div class="CommentContent css-scdjgu"><p>我唯一用过的union一个场合是，两个相同的单片机通信传的数据包格式固定，用一个union封装一个结构体和一个数组，数据写入读出通过结构体成员，输入发送接收用数组···</p></div><div class="css-140jo2"><div class="css-1a5a57m"><div class="css-x1xlu5"><span class="css-12cl38p">02-20</span><span> · </span><span class="css-ntkn7q" href="">IP 属地北京</span></div></div><div class="css-18opwoy"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel css-1ij6qqc"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--ChatBubbleFill24 css-15ro776" fill="currentColor"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button Button--plain Button--grey Button--withIcon Button--withLabel css-1vd72tl" style="transform: none;"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--HeartFill24 css-15ro776" fill="currentColor"><path fill-rule="evenodd" d="M12.004 4.934c1.015-.944 2.484-1.618 3.98-1.618 3.48 0 6.53 3.265 6.15 7.614-.11 1.254-.686 2.55-1.458 3.753-.778 1.215-1.79 2.392-2.845 3.419-1.054 1.028-2.168 1.923-3.161 2.566a9.96 9.96 0 0 1-1.41.777c-.418.182-.862.32-1.268.32s-.848-.137-1.267-.317a9.918 9.918 0 0 1-1.407-.771c-.992-.64-2.103-1.53-3.156-2.555-1.052-1.024-2.062-2.2-2.84-3.417-.77-1.208-1.346-2.51-1.456-3.775-.38-4.349 2.67-7.614 6.15-7.614 1.484 0 2.983.673 3.988 1.618Z" clip-rule="evenodd"></path></svg></span>喜欢</button></div></div></div></div></div><div></div></div></div></div></div></div></div><div class="PostIndex-Contributions" data-za-detail-view-path-module="ColumnList" data-za-detail-view-path-module_name="文章被以下专栏收录" data-za-extra-module="{}"><h3 class="BlockTitle">文章被以下专栏收录</h3><ul><div class="ContentItem Column-ColumnItem"><div class="ContentItem-main"><div class="ContentItem-image"><a class="ColumnLink" href="https://www.zhihu.com/column/c_1506624979713769473"><div class="css-1gomreu"><img class="Avatar css-1u7r5c9" src="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/4b70deef7_l.jpg" srcset="https://pic1.zhimg.com/4b70deef7_l.jpg?source=172ae18b 2x" alt="C++杂谈"></div></a></div><div class="ContentItem-head"><h2 class="ContentItem-title"><span><a class="ColumnLink ColumnItem-Title" href="https://www.zhihu.com/column/c_1506624979713769473"><div class="css-1gomreu">C++杂谈</div></a></span></h2></div></div></div></ul></div><div role="complementary" aria-label="推荐阅读" class="Recommendations-Main" style="width: 1732px;"><h3 class="BlockTitle Recommendations-BlockTitle">推荐阅读</h3><ul class="Recommendations-List"><button class="PagingButton PagingButton-Previous" disabled="" data-za-detail-view-path-module="Unknown" data-za-detail-view-path-module_name="推荐阅读" data-za-extra-module="{}"><svg width="40" height="40" viewBox="0 0 24 24" fill="#d3d3d3" class="Zi Zi--ArrowLeft"><path fill-rule="evenodd" d="m10.752 12 4.025-3.78a.684.684 0 0 0 0-1.01.796.796 0 0 0-1.075 0l-4.42 4.15a.866.866 0 0 0 0 1.28l4.42 4.15a.796.796 0 0 0 1.075 0 .684.684 0 0 0 0-1.01L10.752 12Z" clip-rule="evenodd"></path></svg></button><a href="https://zhuanlan.zhihu.com/p/88806672" class="PostItem"><div><h1 class="PostItem-Title">c++ stl(1)--algorithms直白总结!精彩不容错过!</h1><p class="PostItem-Summary">翻译+改编自: https://www.geeksforgeeks.org/the-c-standard-template-library-stl/https://www.geeksforgeeks.org/stdpartition-in-c-stl/ https://www.geeksforgeeks.org/c-magicians-st…</p><div class="PostItem-Footer"><span>微尘-黄含...</span><span class="PostItem-FooterTitle">发表于编程小白暑...</span></div></div></a><a href="https://zhuanlan.zhihu.com/p/461285071" class="PostItem"><div><h1 class="PostItem-Title">为什么c++需要std::move</h1><p class="PostItem-Summary">之前了解了std::move的作用，以及其实现的一些细节，但是最核心的问题却一直想不通， 就是这个东西有什么用？基本是一种，“我说你这个没用，他说我这个有用，我这个是化劲，传统语言讲究化…</p><div class="PostItem-Footer"><span>做笔记的号</span><span class="PostItem-FooterTitle"></span></div></div></a><a href="https://zhuanlan.zhihu.com/p/36274119" class="PostItem"><div><img src="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/v2-0aa7d503f23b86b14da16c3950696026_250x0.jpg" srcset="https://picx.zhimg.com/v2-0aa7d503f23b86b14da16c3950696026_qhd.jpg?source=172ae18b 2x" class="PostItem-TitleImage" alt="C++一道深坑面试题：STL里sort算法用的是什么排序算法？"><h1 class="PostItem-Title">C++一道深坑面试题：STL里sort算法用的是什么排序算法？</h1><div class="PostItem-Footer"><span>yinnnn</span><span class="PostItem-FooterTitle"></span></div></div></a><a href="https://zhuanlan.zhihu.com/p/23884448" class="PostItem"><div><img src="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/v2-98bcdc38f96696591a3857f4303bcdea_250x0.jpg" srcset="https://pica.zhimg.com/v2-98bcdc38f96696591a3857f4303bcdea_qhd.jpg?source=172ae18b 2x" class="PostItem-TitleImage" alt="Effective Modern C++ ：Item 1:理解模板类型推导"><h1 class="PostItem-Title">Effective Modern C++ ：Item 1:理解模板类型推导</h1><div class="PostItem-Footer"><span>YYang</span><span class="PostItem-FooterTitle"></span></div></div></a><button class="PagingButton PagingButton-Next" data-za-detail-view-path-module="Unknown" data-za-detail-view-path-module_name="推荐阅读" data-za-extra-module="{}"><svg width="40" height="40" viewBox="0 0 24 24" fill="#d3d3d3" class="Zi Zi--ArrowRight"><path fill-rule="evenodd" d="m13.248 12-4.025 3.78a.684.684 0 0 0 0 1.01.796.796 0 0 0 1.075 0l4.42-4.15a.867.867 0 0 0 0-1.28l-4.42-4.15a.796.796 0 0 0-1.075 0 .684.684 0 0 0 0 1.01L13.248 12Z" clip-rule="evenodd"></path></svg></button></ul></div></div></div></main><div role="complementary"><div class="CornerButtons"><div class="CornerAnimayedFlex CornerAnimayedFlex--hidden"><button data-tooltip="回到顶部" data-tooltip-position="left" data-tooltip-will-hide-on-click="true" aria-label="回到顶部" type="button" class="Button CornerButton Button--plain css-4lspwd"><svg width="24" height="24" viewBox="0 0 24 24" aria-hidden="true" class="Zi Zi--BackToTop" fill="currentColor"><path fill-rule="evenodd" d="M13.204 3.107a1.75 1.75 0 0 0-2.408 0L3.806 9.73c-1.148 1.088-.378 3.02 1.204 3.02h2.24V20c0 .966.784 1.75 1.75 1.75h6A1.75 1.75 0 0 0 16.75 20v-7.25h2.24c1.582 0 2.353-1.932 1.204-3.02l-6.99-6.623Z" clip-rule="evenodd"></path></svg></button></div></div></div></div></div><script id="js-clientConfig" type="text/json">{"fetchRoot":{"www":"https:\u002F\u002Fwww.zhihu.com","api":"https:\u002F\u002Fapi.zhihu.com","lens":"https:\u002F\u002Flens.zhihu.com","zhuanlan":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fapi\u002F","walletpay":"https:\u002F\u002Fwalletpay.zhihu.com","captcha":"https:\u002F\u002Fcaptcha.zhihu.com","vzuu":"https:\u002F\u002Fv.vzuu.com","openapi":"https:\u002F\u002Fopenapi.zhihu.com","svip":"https:\u002F\u002Fsvip.zhihu.com"},"host":"zhihu.com","protocol":"https:","wwwHost":"www.zhihu.com","videoHost":"video.zhihu.com","zhuanlanHost":"zhuanlan.zhihu.com","allowSignUp":true,"refreshValidityPeriod":"30","release":"1149-8fa9cf10","currentEntry":"column","isMobileEntry":false,"apollo":{"env":"prod","globalSilence":"","ncgModeSign":"3f8e56febda4fb3bbea72e379d76de1e","topstory_rec_adp":"1","topstory_hot_adp":"1","editor_adapt_native":"0","enable_request_filter":"1","content_publish_pin":"1","content_publish_answer":"1","content_publish_question":"1","content_publish_article":"0","content_publish_zvideo":"1","test_canary":"member|0-100,1-0","use_new_player":"member|0-100,1-0","player_vendor":"member|0-100,1-0,2-0","use_hevc":"member|0-0,1-100","upload_use_signature":"member|0-0,1-100","use_backdrop_blur":"member|0-0,1-100","article_title_imagex":"member|0-0,1-100","play_station":"member|0-0,1-100","use_cached_supported_countries":"device|1-100,0-0","contentItem_cover_imagex":"member|0-0,1-100","use_qrcode_login_v2":"device|1-100,0-0"}}</script><script id="js-initialData" type="text/json">{"initialState":{"common":{"ask":{},"cities":{"cityData":[]}},"loading":{"global":{"count":0},"local":{"env\u002FgetIpinfo\u002F":false,"article\u002Fget\u002F":false,"brand\u002FgetUrl\u002F":false,"article\u002FloadPostSearchEntity\u002F":false}},"entities":{"users":{"c29982ea4958b35f1d733b99ef5bf579":{"uid":1454038455692562400,"userType":"people","id":"c29982ea4958b35f1d733b99ef5bf579"},"li-cong-lei-62":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-8352ba83f5aad85676e8527f9e6abdbd.jpg?source=172ae18b","uid":"628729227072245760","userType":"people","isFollowing":false,"urlToken":"li-cong-lei-62","id":"24c099308d02ba46367d952aba6b9f77","description":"跳出舒适圈，终身学习","name":"勿忘心安","isAdvertiser":false,"headline":"游戏客户端","gender":1,"url":"\u002Fpeople\u002F24c099308d02ba46367d952aba6b9f77","avatarUrl":"https:\u002F\u002Fpicx.zhimg.com\u002Fv2-8352ba83f5aad85676e8527f9e6abdbd_l.jpg?source=172ae18b","isOrg":false,"type":"people","badge":[{"type":"identity","topics":[],"description":"同济大学 工程硕士"}],"badgeV2":{"title":"同济大学 工程硕士","mergedBadges":[{"type":"identity","detailType":"identity","title":"认证","description":"同济大学 工程硕士","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F96956163","sources":[],"icon":"","nightIcon":""}],"detailBadges":[{"type":"identity","detailType":"identity_people","title":"已认证的个人","description":"同济大学 工程硕士","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F96956163","sources":[],"icon":"https:\u002F\u002Fpicx.zhimg.com\u002Fv2-2ddc5cc683982648f6f123616fb4ec09_l.png?source=32738c0c","nightIcon":"https:\u002F\u002Fpica.zhimg.com\u002Fv2-2ddc5cc683982648f6f123616fb4ec09_l.png?source=32738c0c"}],"icon":"https:\u002F\u002Fpicx.zhimg.com\u002Fv2-2ddc5cc683982648f6f123616fb4ec09_l.png?source=32738c0c","nightIcon":"https:\u002F\u002Fpicx.zhimg.com\u002Fv2-2ddc5cc683982648f6f123616fb4ec09_l.png?source=32738c0c"},"exposedMedal":{"medalId":"0","medalName":"","avatarUrl":"","miniAvatarUrl":"","description":"","medalAvatarFrame":null}}},"questions":{},"answers":{},"articles":{"607734474":{"trackUrl":["https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper\u002Fcontent_monitor_log?si=__SESSIONID__&ti=__ATOKEN__&at=view&pf=__OS__&ed=BiBUKF0xBSkqGGpfBWh6CVx3AAGOF_uGOiPJ&idfa=__IDFA__&imei=__IMEI__&androidid=__ANDROIDID__&oaid=__OAID__&ci=__CREATIVEID__&zid=__ZONEID__"],"entityWords":[{"name":"ambiguity","mention":"ambiguity","matchorder":1,"begin":23950,"end":23959,"entityid":-8245791575174401000,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Medical","score":0.0013248725000850475,"attachedInfoBytes":"sgJfCglhbWJpZ3VpdHkSB01lZGljYWwYjrsBIJe7ASgBNVinrTo6B2FydGljbGVAoefI7oGIxMiNAUgAUiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjLyAswBCiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjIaB2FydGljbGUiCTIyMzE4NDEzODoJYW1iaWd1aXR5QKHnyO6BiMTIjQFIAFISYWlfZW50aXR5X3JlY2FsbGVyXVinrTpiXwoJYW1iaWd1aXR5EgdNZWRpY2FsGI67ASCXuwEoATVYp606OgdhcnRpY2xlQKHnyO6BiMTIjQFIAFIkNDJlZWM0ZDUtNWQxNy00Y2MxLTg4MDgtMzE3MzNkNTIyNTIy","isOnAB":false,"isNatural":1,"isDelete":false,"contentType":"","contentId":"","contentToken":""},{"name":"赋值运算符","mention":"赋值运算符","matchorder":1,"begin":37365,"end":37370,"entityid":6951445083892252000,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Unknown","score":0.0007799204189987315,"attachedInfoBytes":"sgJkCg\u002FotYvlgLzov5DnrpfnrKYSB1Vua25vd24Y9aMCIPqjAigBNZNzTDo6B2FydGljbGVA0fihqJPPn7xgSABSJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMvIC2wEKJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMhoHYXJ0aWNsZSIJMjIzMTg0MTM4Og\u002FotYvlgLzov5DnrpfnrKZA0fihqJPPn7xgSAFSF2JhaWR1LWJhaWtlLWl0ZW0tcmVjYWxsXZNzTDpiZAoP6LWL5YC86L+Q566X56ymEgdVbmtub3duGPWjAiD6owIoATWTc0w6OgdhcnRpY2xlQNH4oaiTz5+8YEgAUiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjI=","isOnAB":false,"isNatural":1,"isDelete":false,"contentType":"","contentId":"","contentToken":""},{"name":"type-safe union","mention":"type-safe union","matchorder":1,"begin":81,"end":96,"entityid":-4318125124746916400,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"OtherTerm","score":0.0017369624828424551,"attachedInfoBytes":"sgJjCg90eXBlLXNhZmUgdW5pb24SCU90aGVyVGVybRhRIGAoATXKquM6OgdhcnRpY2xlQM2blZ69gryJxAFIAFIkNDJlZWM0ZDUtNWQxNy00Y2MxLTg4MDgtMzE3MzNkNTIyNTIy8gLWAQokNDJlZWM0ZDUtNWQxNy00Y2MxLTg4MDgtMzE3MzNkNTIyNTIyGgdhcnRpY2xlIgkyMjMxODQxMzg6D3R5cGUtc2FmZSB1bmlvbkDNm5WevYK8icQBSANSEmFpX2VudGl0eV9yZWNhbGxlcl3KquM6YmMKD3R5cGUtc2FmZSB1bmlvbhIJT3RoZXJUZXJtGFEgYCgBNcqq4zo6B2FydGljbGVAzZuVnr2CvInEAUgAUiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjI=","isOnAB":false,"isNatural":1,"isDelete":false,"contentType":"","contentId":"","contentToken":""},{"name":"return f.i","mention":"return f.i","matchorder":1,"begin":304,"end":314,"entityid":-5867742744471981000,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0.001442692692015038,"attachedInfoBytes":"sgJbCgpyZXR1cm4gZi5pEgRNYXRoGLACILoCKAE1vBi9OjoHYXJ0aWNsZUDI5vySgOLlyK4BSABSJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMvICyQEKJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMhoHYXJ0aWNsZSIJMjIzMTg0MTM4OgpyZXR1cm4gZi5pQMjm\u002FJKA4uXIrgFIBFISYWlfZW50aXR5X3JlY2FsbGVyXbwYvTpiWwoKcmV0dXJuIGYuaRIETWF0aBiwAiC6AigBNbwYvTo6B2FydGljbGVAyOb8koDi5ciuAUgAUiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjI=","isOnAB":false,"isNatural":1,"isDelete":false,"contentType":"","contentId":"","contentToken":""},{"name":"默认构造函数","mention":"默认构造函数","matchorder":1,"begin":19413,"end":19419,"entityid":-4265475956060677000,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Computer","score":0.0014250585923124004,"attachedInfoBytes":"sgJpChLpu5jorqTmnoTpgKDlh73mlbASCENvbXB1dGVyGNWXASDblwEoATUIybo6OgdhcnRpY2xlQMe5osj6hv\u002FmxAFIAFIkNDJlZWM0ZDUtNWQxNy00Y2MxLTg4MDgtMzE3MzNkNTIyNTIy8gLfAQokNDJlZWM0ZDUtNWQxNy00Y2MxLTg4MDgtMzE3MzNkNTIyNTIyGgdhcnRpY2xlIgkyMjMxODQxMzg6Eum7mOiupOaehOmAoOWHveaVsEDHuaLI+ob\u002F5sQBSAVSEmFpX2VudGl0eV9yZWNhbGxlcl0Iybo6YmkKEum7mOiupOaehOmAoOWHveaVsBIIQ29tcHV0ZXIY1ZcBINuXASgBNQjJujo6B2FydGljbGVAx7miyPqG\u002F+bEAUgAUiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjI=","isOnAB":false,"isNatural":1,"isDelete":false,"contentType":"","contentId":"","contentToken":""},{"name":"类型安全","mention":"类型安全","matchorder":1,"begin":19317,"end":19321,"entityid":5956113489158862000,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Computer","score":0.0009449891677732539,"attachedInfoBytes":"sgJiCgznsbvlnovlronlhagSCENvbXB1dGVyGPWWASD5lgEoATUmuXc6OgdhcnRpY2xlQLvq59mVtZfUUkgAUiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjLyAtEBCiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjIaB2FydGljbGUiCTIyMzE4NDEzODoM57G75Z6L5a6J5YWoQLvq59mVtZfUUkgGUhJhaV9lbnRpdHlfcmVjYWxsZXJdJrl3OmJiCgznsbvlnovlronlhagSCENvbXB1dGVyGPWWASD5lgEoATUmuXc6OgdhcnRpY2xlQLvq59mVtZfUUkgAUiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjI=","isOnAB":false,"isNatural":1,"isDelete":false,"contentType":"","contentId":"","contentToken":""},{"name":"辅助函数","mention":"辅助函数","matchorder":1,"begin":38567,"end":38571,"entityid":8808951515750377000,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0.000833367462983646,"attachedInfoBytes":"sgJeCgzovoXliqnlh73mlbASBE1hdGgYp60CIKutAigBNVh2Wjo6B2FydGljbGVA787Cn7XX6596SABSJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMvICzQEKJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMhoHYXJ0aWNsZSIJMjIzMTg0MTM4OgzovoXliqnlh73mlbBA787Cn7XX6596SAdSEmFpX2VudGl0eV9yZWNhbGxlcl1Ydlo6Yl4KDOi+heWKqeWHveaVsBIETWF0aBinrQIgq60CKAE1WHZaOjoHYXJ0aWNsZUDvzsKftdfrn3pIAFIkNDJlZWM0ZDUtNWQxNy00Y2MxLTg4MDgtMzE3MzNkNTIyNTIy","isOnAB":false,"isNatural":1,"isDelete":false,"contentType":"","contentId":"","contentToken":""},{"name":"浮点数","mention":"浮点数","matchorder":1,"begin":87021,"end":87024,"entityid":3005512809600111000,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Unknown","score":0.0007263117488641758,"attachedInfoBytes":"sgJeCgnmta7ngrnmlbASB1Vua25vd24Y7acFIPCnBSgBNfVlPjo6B2FydGljbGVAqqXnwJ+\u002F7topSABSJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMvIC1wEKJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMhoHYXJ0aWNsZSIJMjIzMTg0MTM4Ognmta7ngrnmlbBAqqXnwJ+\u002F7topSAhSH25ld19iYWlkdS13aWtpcGVkaWEtaXRlbS1yZWNhbGxd9WU+OmJeCgnmta7ngrnmlbASB1Vua25vd24Y7acFIPCnBSgBNfVlPjo6B2FydGljbGVAqqXnwJ+\u002F7topSABSJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMg==","isOnAB":false,"isNatural":1,"isDelete":false,"contentType":"","contentId":"","contentToken":""},{"name":"参数传递","mention":"参数传递","matchorder":1,"begin":29425,"end":29429,"entityid":-6905589762234123000,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Unknown","score":0.0005343044794433767,"attachedInfoBytes":"sgJiCgzlj4LmlbDkvKDpgJISB1Vua25vd24Y8eUBIPXlASgBNZEQDDo6B2FydGljbGVAs\u002FnXy63WmpWgAUgAUiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjLyAt8BCiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjIaB2FydGljbGUiCTIyMzE4NDEzODoM5Y+C5pWw5Lyg6YCSQLP518ut1pqVoAFICVIfbmV3X2JhaWR1LXdpa2lwZWRpYS1pdGVtLXJlY2FsbF2REAw6YmIKDOWPguaVsOS8oOmAkhIHVW5rbm93bhjx5QEg9eUBKAE1kRAMOjoHYXJ0aWNsZUCz+dfLrdaalaABSABSJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMg==","isOnAB":false,"isNatural":1,"isDelete":false,"contentType":"","contentId":"","contentToken":""},{"name":"void operator","mention":"void operator","matchorder":1,"begin":1633,"end":1646,"entityid":-2699437224209530000,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0.002359315257124295,"attachedInfoBytes":"sgJeCg12b2lkIG9wZXJhdG9yEgRNYXRoGOEMIO4MKAE1vp4aOzoHYXJ0aWNsZUCiiJms2YTrxNoBSABSJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMvICzwEKJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMhoHYXJ0aWNsZSIJMjIzMTg0MTM4Og12b2lkIG9wZXJhdG9yQKKImazZhOvE2gFIClISYWlfZW50aXR5X3JlY2FsbGVyXb6eGjtiXgoNdm9pZCBvcGVyYXRvchIETWF0aBjhDCDuDCgBNb6eGjs6B2FydGljbGVAooiZrNmE68TaAUgAUiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjI=","isOnAB":false,"isNatural":1,"isDelete":false,"contentType":"","contentId":"","contentToken":""},{"name":"具名强制转换","mention":"具名强制转换","matchorder":1,"begin":2276,"end":2282,"entityid":3951028618890706400,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Computer","score":0.0007546773718493452,"attachedInfoBytes":"sgJmChLlhbflkI3lvLrliLbovazmjaISCENvbXB1dGVyGOQRIOoRKAE1i9VFOjoHYXJ0aWNsZUCV\u002FYfzhvO36jZIAFIkNDJlZWM0ZDUtNWQxNy00Y2MxLTg4MDgtMzE3MzNkNTIyNTIy8gLbAQokNDJlZWM0ZDUtNWQxNy00Y2MxLTg4MDgtMzE3MzNkNTIyNTIyGgdhcnRpY2xlIgkyMjMxODQxMzg6EuWFt+WQjeW8uuWItui9rOaNokCV\u002FYfzhvO36jZIC1ISYWlfZW50aXR5X3JlY2FsbGVyXYvVRTpiZgoS5YW35ZCN5by65Yi26L2s5o2iEghDb21wdXRlchjkESDqESgBNYvVRTo6B2FydGljbGVAlf2H84bzt+o2SABSJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMg==","isOnAB":false,"isNatural":1,"isDelete":false,"contentType":"","contentId":"","contentToken":""},{"name":"标准库","mention":"标准库","matchorder":1,"begin":6919,"end":6922,"entityid":-8976511071915641000,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Unknown","score":0.0007151921448673129,"attachedInfoBytes":"sgJdCgnmoIflh4blupMSB1Vua25vd24YhzYgijYoATW7ezs6OgdhcnRpY2xlQIzw7eDV18G2gwFIAFIkNDJlZWM0ZDUtNWQxNy00Y2MxLTg4MDgtMzE3MzNkNTIyNTIy8gLXAQokNDJlZWM0ZDUtNWQxNy00Y2MxLTg4MDgtMzE3MzNkNTIyNTIyGgdhcnRpY2xlIgkyMjMxODQxMzg6Ceagh+WHhuW6k0CM8O3g1dfBtoMBSAxSH25ld19iYWlkdS13aWtpcGVkaWEtaXRlbS1yZWNhbGxdu3s7OmJdCgnmoIflh4blupMSB1Vua25vd24YhzYgijYoATW7ezs6OgdhcnRpY2xlQIzw7eDV18G2gwFIAFIkNDJlZWM0ZDUtNWQxNy00Y2MxLTg4MDgtMzE3MzNkNTIyNTIy","isOnAB":false,"isNatural":1,"isDelete":false,"contentType":"","contentId":"","contentToken":""},{"name":"泛型lambda","mention":"泛型lambda","matchorder":1,"begin":44195,"end":44203,"entityid":-3585303424047084500,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"OtherTerm","score":0.0012375041276955906,"attachedInfoBytes":"sgJkCgzms5vlnotsYW1iZGESCU90aGVyVGVybRij2QIgq9kCKAE1wDOiOjoHYXJ0aWNsZUDYlrqtgbGcn84BSABSJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMvIC1AEKJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMhoHYXJ0aWNsZSIJMjIzMTg0MTM4Ogzms5vlnotsYW1iZGFA2Ja6rYGxnJ\u002FOAUgNUhJhaV9lbnRpdHlfcmVjYWxsZXJdwDOiOmJkCgzms5vlnotsYW1iZGESCU90aGVyVGVybRij2QIgq9kCKAE1wDOiOjoHYXJ0aWNsZUDYlrqtgbGcn84BSABSJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMg==","isOnAB":false,"isNatural":1,"isDelete":false,"contentType":"","contentId":"","contentToken":""},{"name":"解析命令行","mention":"解析命令行","matchorder":1,"begin":19825,"end":19830,"entityid":6572690758210233000,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Computer","score":0.0010202795745156423,"attachedInfoBytes":"sgJlCg\u002Fop6PmnpDlkb3ku6TooYwSCENvbXB1dGVyGPGaASD2mgEoATXnuoU6OgdhcnRpY2xlQOvJ9Ky87bibW0gAUiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjLyAtcBCiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjIaB2FydGljbGUiCTIyMzE4NDEzODoP6Kej5p6Q5ZG95Luk6KGMQOvJ9Ky87bibW0gOUhJhaV9lbnRpdHlfcmVjYWxsZXJd57qFOmJlCg\u002Fop6PmnpDlkb3ku6TooYwSCENvbXB1dGVyGPGaASD2mgEoATXnuoU6OgdhcnRpY2xlQOvJ9Ky87bibW0gAUiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjI=","isOnAB":false,"isNatural":1,"isDelete":false,"contentType":"","contentId":"","contentToken":""},{"name":"成员函数","mention":"成员函数","matchorder":1,"begin":38612,"end":38616,"entityid":2767673746727516700,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Unknown","score":0.0008437734194540851,"attachedInfoBytes":"sgJhCgzmiJDlkZjlh73mlbASB1Vua25vd24Y1K0CINitAigBNa0wXTo6B2FydGljbGVA7PL4\u002Fr2TsLQmSABSJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMvIC1QEKJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMhoHYXJ0aWNsZSIJMjIzMTg0MTM4OgzmiJDlkZjlh73mlbBA7PL4\u002Fr2TsLQmSA9SF2JhaWR1LWJhaWtlLWl0ZW0tcmVjYWxsXa0wXTpiYQoM5oiQ5ZGY5Ye95pWwEgdVbmtub3duGNStAiDYrQIoATWtMF06OgdhcnRpY2xlQOzy+P69k7C0JkgAUiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjI=","isOnAB":false,"isNatural":1,"isDelete":false,"contentType":"","contentId":"","contentToken":""},{"name":"编译器","mention":"编译器","matchorder":1,"begin":29167,"end":29170,"entityid":7259022528704199000,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Unknown","score":0.0006658483107783624,"attachedInfoBytes":"sgJeCgnnvJbor5HlmagSB1Vua25vd24Y7+MBIPLjASgBNVOMLjo6B2FydGljbGVAzvDiv\u002FrQzt5kSABSJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMvIC1wEKJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMhoHYXJ0aWNsZSIJMjIzMTg0MTM4OgnnvJbor5HlmahAzvDiv\u002FrQzt5kSBBSH25ld19iYWlkdS13aWtpcGVkaWEtaXRlbS1yZWNhbGxdU4wuOmJeCgnnvJbor5HlmagSB1Vua25vd24Y7+MBIPLjASgBNVOMLjo6B2FydGljbGVAzvDiv\u002FrQzt5kSABSJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMg==","isOnAB":false,"isNatural":1,"isDelete":false,"contentType":"","contentId":"","contentToken":""},{"name":"lambda","mention":"lambda","matchorder":4,"begin":42854,"end":42860,"entityid":-3366973176090832000,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"OtherTerm","score":0.001633039681720197,"attachedInfoBytes":"sgJeCgZsYW1iZGESCU90aGVyVGVybRjmzgIg7M4CKAQ1uAvWOjoHYXJ0aWNsZUC8p9n2w\u002FeGo9EBSABSJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMvICyAEKJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMhoHYXJ0aWNsZSIJMjIzMTg0MTM4OgZsYW1iZGFAvKfZ9sP3hqPRAUgRUhJhaV9lbnRpdHlfcmVjYWxsZXJduAvWOmJeCgZsYW1iZGESCU90aGVyVGVybRjmzgIg7M4CKAQ1uAvWOjoHYXJ0aWNsZUC8p9n2w\u002FeGo9EBSABSJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMg==","isOnAB":false,"isNatural":1,"isDelete":false,"contentType":"","contentId":"","contentToken":""},{"name":"布尔值","mention":"布尔值","matchorder":1,"begin":81306,"end":81309,"entityid":-938926004731141100,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Unknown","score":0.0005100714932346588,"attachedInfoBytes":"sgJfCgnluIPlsJTlgLwSB1Vua25vd24YmvsEIJ37BCgBNVK2BTo6B2FydGljbGVA7sf+zN\u002F4kPzyAUgAUiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjLyAtEBCiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjIaB2FydGljbGUiCTIyMzE4NDEzODoJ5biD5bCU5YC8QO7H\u002Fszf+JD88gFIElIXYmFpZHUtYmFpa2UtaXRlbS1yZWNhbGxdUrYFOmJfCgnluIPlsJTlgLwSB1Vua25vd24YmvsEIJ37BCgBNVK2BTo6B2FydGljbGVA7sf+zN\u002F4kPzyAUgAUiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjI=","isOnAB":false,"isNatural":1,"isDelete":false,"contentType":"","contentId":"","contentToken":""},{"name":"int main","mention":"int main","matchorder":3,"begin":6961,"end":6969,"entityid":-8103767388346927000,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0.0009890122900951329,"attachedInfoBytes":"sgJZCghpbnQgbWFpbhIETWF0aBixNiC5NigDNb+hgTo6B2FydGljbGVA5e++me\u002FP6MSPAUgAUiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjLyAsUBCiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjIaB2FydGljbGUiCTIyMzE4NDEzODoIaW50IG1haW5A5e++me\u002FP6MSPAUgTUhJhaV9lbnRpdHlfcmVjYWxsZXJdv6GBOmJZCghpbnQgbWFpbhIETWF0aBixNiC5NigDNb+hgTo6B2FydGljbGVA5e++me\u002FP6MSPAUgAUiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjI=","isOnAB":false,"isNatural":1,"isDelete":false,"contentType":"","contentId":"","contentToken":""},{"name":"浮点运算","mention":"浮点运算","matchorder":1,"begin":334,"end":338,"entityid":7745680398306228000,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0.000835472159626989,"attachedInfoBytes":"sgJcCgzmta7ngrnov5DnrpcSBE1hdGgYzgIg0gIoATWWA1s6OgdhcnRpY2xlQMvy\u002FuWK6Yu\u002Fa0gAUiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjLyAssBCiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjIaB2FydGljbGUiCTIyMzE4NDEzODoM5rWu54K56L+Q566XQMvy\u002FuWK6Yu\u002Fa0gUUhJhaV9lbnRpdHlfcmVjYWxsZXJdlgNbOmJcCgzmta7ngrnov5DnrpcSBE1hdGgYzgIg0gIoATWWA1s6OgdhcnRpY2xlQMvy\u002FuWK6Yu\u002Fa0gAUiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjI=","isOnAB":false,"isNatural":1,"isDelete":false,"contentType":"","contentId":"","contentToken":""},{"name":"虚表","mention":"虚表","matchorder":1,"begin":20128,"end":20130,"entityid":-8829663528048506000,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0.0007683526092407897,"attachedInfoBytes":"sgJZCgbomZrooagSBE1hdGgYoJ0BIKKdASgBNUVrSTo6B2FydGljbGVA5pbJo9j5rruFAUgAUiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjLyAsMBCiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjIaB2FydGljbGUiCTIyMzE4NDEzODoG6Jma6KGoQOaWyaPY+a67hQFIFVISYWlfZW50aXR5X3JlY2FsbGVyXUVrSTpiWQoG6Jma6KGoEgRNYXRoGKCdASCinQEoATVFa0k6OgdhcnRpY2xlQOaWyaPY+a67hQFIAFIkNDJlZWM0ZDUtNWQxNy00Y2MxLTg4MDgtMzE3MzNkNTIyNTIy","isOnAB":false,"isNatural":1,"isDelete":false,"contentType":"","contentId":"","contentToken":""},{"name":"比较运算符","mention":"比较运算符","matchorder":1,"begin":55460,"end":55465,"entityid":7924667499335443000,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Unknown","score":0.000576070060869241,"attachedInfoBytes":"sgJkCg\u002Fmr5TovoPov5DnrpfnrKYSB1Vua25vd24YpLEDIKmxAygBNWgDFzo6B2FydGljbGVAyMTj56njhP1tSABSJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMvIC4wEKJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMhoHYXJ0aWNsZSIJMjIzMTg0MTM4Og\u002Fmr5TovoPov5DnrpfnrKZAyMTj56njhP1tSBZSH25ld19iYWlkdS13aWtpcGVkaWEtaXRlbS1yZWNhbGxdaAMXOmJkCg\u002Fmr5TovoPov5DnrpfnrKYSB1Vua25vd24YpLEDIKmxAygBNWgDFzo6B2FydGljbGVAyMTj56njhP1tSABSJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMg==","isOnAB":false,"isNatural":1,"isDelete":false,"contentType":"","contentId":"","contentToken":""},{"name":"测试数据","mention":"测试数据","matchorder":1,"begin":61446,"end":61450,"entityid":7364486678763502000,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Unknown","score":0.0005092768859196507,"attachedInfoBytes":"sgJhCgzmtYvor5XmlbDmja4SB1Vua25vd24YhuADIIrgAygBNf6ABTo6B2FydGljbGVAi\u002FGtxtmz+plmSABSJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMvIC1QEKJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMhoHYXJ0aWNsZSIJMjIzMTg0MTM4OgzmtYvor5XmlbDmja5Ai\u002FGtxtmz+plmSBdSF2JhaWR1LWJhaWtlLWl0ZW0tcmVjYWxsXf6ABTpiYQoM5rWL6K+V5pWw5o2uEgdVbmtub3duGIbgAyCK4AMoATX+gAU6OgdhcnRpY2xlQIvxrcbZs\u002FqZZkgAUiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjI=","isOnAB":false,"isNatural":1,"isDelete":false,"contentType":"","contentId":"","contentToken":""},{"name":"有限状态机","mention":"有限状态机","matchorder":1,"begin":98944,"end":98949,"entityid":3068317754771645400,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Unknown","score":0.0011313610440474575,"attachedInfoBytes":"sgJkCg\u002FmnInpmZDnirbmgIHmnLoSB1Vua25vd24YgIUGIIWFBigBNS1KlDo6B2FydGljbGVAusfAudzXtsoqSABSJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMvIC4wEKJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMhoHYXJ0aWNsZSIJMjIzMTg0MTM4Og\u002FmnInpmZDnirbmgIHmnLpAusfAudzXtsoqSBhSH25ld19iYWlkdS13aWtpcGVkaWEtaXRlbS1yZWNhbGxdLUqUOmJkCg\u002FmnInpmZDnirbmgIHmnLoSB1Vua25vd24YgIUGIIWFBigBNS1KlDo6B2FydGljbGVAusfAudzXtsoqSABSJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMg==","isOnAB":false,"isNatural":1,"isDelete":false,"contentType":"","contentId":"","contentToken":""},{"name":"ini文件","mention":"ini文件","matchorder":1,"begin":19831,"end":19836,"entityid":8236171286517543000,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Unknown","score":0.0009261906798978814,"attachedInfoBytes":"sgJeCglpbmnmlofku7YSB1Vua25vd24Y95oBIPyaASgBNZvLcjo6B2FydGljbGVAvOGZkd7EsKZySABSJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMvIC1wEKJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMhoHYXJ0aWNsZSIJMjIzMTg0MTM4Oglpbmnmlofku7ZAvOGZkd7EsKZySBlSH25ld19iYWlkdS13aWtpcGVkaWEtaXRlbS1yZWNhbGxdm8tyOmJeCglpbmnmlofku7YSB1Vua25vd24Y95oBIPyaASgBNZvLcjo6B2FydGljbGVAvOGZkd7EsKZySABSJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMg==","isOnAB":false,"isNatural":1,"isDelete":false,"contentType":"","contentId":"","contentToken":""},{"name":"返回值","mention":"返回值","matchorder":1,"begin":19986,"end":19989,"entityid":-7031970680018555000,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Unknown","score":0.0005999847272999473,"attachedInfoBytes":"sgJfCgnov5Tlm57lgLwSB1Vua25vd24YkpwBIJWcASgBNUtIHTo6B2FydGljbGVAx9+g1Mb92rSeAUgAUiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjLyAtEBCiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjIaB2FydGljbGUiCTIyMzE4NDEzODoJ6L+U5Zue5YC8QMffoNTG\u002Fdq0ngFIGlIXYmFpZHUtYmFpa2UtaXRlbS1yZWNhbGxdS0gdOmJfCgnov5Tlm57lgLwSB1Vua25vd24YkpwBIJWcASgBNUtIHTo6B2FydGljbGVAx9+g1Mb92rSeAUgAUiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjI=","isOnAB":false,"isNatural":1,"isDelete":false,"contentType":"","contentId":"","contentToken":""},{"name":"函数","mention":"函数","matchorder":17,"begin":2414,"end":2416,"entityid":-6173839061251296000,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0.0005404322115328984,"attachedInfoBytes":"sgJXCgblh73mlbASBE1hdGgY7hIg8BIoETXLqw06OgdhcnRpY2xlQJ3kve3YwoepqgFIAFIkNDJlZWM0ZDUtNWQxNy00Y2MxLTg4MDgtMzE3MzNkNTIyNTIy8gLBAQokNDJlZWM0ZDUtNWQxNy00Y2MxLTg4MDgtMzE3MzNkNTIyNTIyGgdhcnRpY2xlIgkyMjMxODQxMzg6BuWHveaVsECd5L3t2MKHqaoBSBtSEmFpX2VudGl0eV9yZWNhbGxlcl3Lqw06YlcKBuWHveaVsBIETWF0aBjuEiDwEigRNcurDTo6B2FydGljbGVAneS97djCh6mqAUgAUiQ0MmVlYzRkNS01ZDE3LTRjYzEtODgwOC0zMTczM2Q1MjI1MjI=","isOnAB":false,"isNatural":1,"isDelete":false,"contentType":"","contentId":"","contentToken":""},{"name":"构造函数","mention":"构造函数","matchorder":1,"begin":6581,"end":6585,"entityid":-8502803870457382000,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Computer","score":0.0007894597854033493,"attachedInfoBytes":"sgJhCgzmnoTpgKDlh73mlbASCENvbXB1dGVyGLUzILkzKAE1wPNOOjoHYXJ0aWNsZUDl+cjU353+\u002F4kBSABSJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMvIC0QEKJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMhoHYXJ0aWNsZSIJMjIzMTg0MTM4OgzmnoTpgKDlh73mlbBA5fnI1N+d\u002Fv+JAUgcUhJhaV9lbnRpdHlfcmVjYWxsZXJdwPNOOmJhCgzmnoTpgKDlh73mlbASCENvbXB1dGVyGLUzILkzKAE1wPNOOjoHYXJ0aWNsZUDl+cjU353+\u002F4kBSABSJDQyZWVjNGQ1LTVkMTctNGNjMS04ODA4LTMxNzMzZDUyMjUyMg==","isOnAB":false,"isNatural":1,"isDelete":false,"contentType":"","contentId":"","contentToken":""}],"id":607734474,"title":"你需要了解有关C++17中std::variant的全部信息","type":"article","articleType":"normal","excerptTitle":"","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F607734474","imageUrl":"","titleImage":"","excerpt":"在C++17标准出现之前，有一些神奇的术语，像&#34;discriminated union&#34;，&#34;type-safe union&#34;和&#34;sum type&#34;。后来它们都意味着相同的类型：&#34;variant&#34;。 本文我们将全面介绍C++17中的std::variant这个全新的类型该如何使用，以及它该在哪里使用。 union如何更好一些…","created":1676824429,"updated":1677164299,"author":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-8352ba83f5aad85676e8527f9e6abdbd.jpg?source=172ae18b","uid":"628729227072245760","userType":"people","isFollowing":false,"urlToken":"li-cong-lei-62","id":"24c099308d02ba46367d952aba6b9f77","description":"跳出舒适圈，终身学习","name":"勿忘心安","isAdvertiser":false,"headline":"游戏客户端","gender":1,"url":"\u002Fpeople\u002F24c099308d02ba46367d952aba6b9f77","avatarUrl":"https:\u002F\u002Fpicx.zhimg.com\u002Fv2-8352ba83f5aad85676e8527f9e6abdbd_l.jpg?source=172ae18b","isOrg":false,"type":"people","badge":[{"type":"identity","topics":[],"description":"同济大学 工程硕士"}],"badgeV2":{"title":"同济大学 工程硕士","mergedBadges":[{"type":"identity","detailType":"identity","title":"认证","description":"同济大学 工程硕士","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F96956163","sources":[],"icon":"","nightIcon":""}],"detailBadges":[{"type":"identity","detailType":"identity_people","title":"已认证的个人","description":"同济大学 工程硕士","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F96956163","sources":[],"icon":"https:\u002F\u002Fpicx.zhimg.com\u002Fv2-2ddc5cc683982648f6f123616fb4ec09_l.png?source=32738c0c","nightIcon":"https:\u002F\u002Fpica.zhimg.com\u002Fv2-2ddc5cc683982648f6f123616fb4ec09_l.png?source=32738c0c"}],"icon":"https:\u002F\u002Fpicx.zhimg.com\u002Fv2-2ddc5cc683982648f6f123616fb4ec09_l.png?source=32738c0c","nightIcon":"https:\u002F\u002Fpicx.zhimg.com\u002Fv2-2ddc5cc683982648f6f123616fb4ec09_l.png?source=32738c0c"},"exposedMedal":{"medalId":"0","medalName":"","avatarUrl":"","miniAvatarUrl":"","description":"","medalAvatarFrame":null}},"commentPermission":"all","copyrightPermission":"need_review","state":"published","ipInfo":"IP 属地北京","imageWidth":0,"imageHeight":0,"content":"\u003Cp data-pid=\"pISIY4ar\"\u003E在C++17标准出现之前，有一些神奇的术语，像&#34;discriminated union&#34;，&#34;type-safe union&#34;和&#34;sum type&#34;。后来它们都意味着相同的类型：&#34;variant&#34;。\u003C\u002Fp\u003E\u003Cp data-pid=\"eKsrIurn\"\u003E本文我们将全面介绍C++17中的std::variant这个全新的类型该如何使用，以及它该在哪里使用。\u003C\u002Fp\u003E\u003Ch2\u003Eunion如何更好一些\u003C\u002Fh2\u003E\u003Cp data-pid=\"kBOEDFri\"\u003E先和以前的union对比一下（其实union很少在业务代码中使用，在大多数情况下，应避免使用union）。例如，浮点运算有一个“常见的技巧”：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Eunion\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003ESuperFloat\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003ERawMantissa\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ESuperFloat\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E((\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E23\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E \n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003ERawExponent\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ESuperFloat\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&gt;&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E23\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"mh\"\u003E0xFF\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"BzzQDARA\"\u003E然而，尽管上述代码可能在C99中正常工作，但由于更严格的aliasing rules，它在C++中是未定义的行为！\u003C\u002Fp\u003E\u003Cp data-pid=\"ANkIAKDp\"\u003E在Core Guideline Rule C.183中有一条指南建议：\u003C\u002Fp\u003E\u003Cp data-pid=\"Td9jyPWD\"\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fisocpp.github.io\u002FCppCoreGuidelines\u002FCppCoreGuidelines%23c183-dont-use-a-union-for-type-punning\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EC.183: 不要将 union 用于类型双关\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"1DOr8i9X\"\u003E\u003Cem\u003E读取一个 union 曾写入的成员不同类型的成员是未定义的行为。 这种双关是不可见的，或者至少比具名强制转换更难于找出。 使用 union 的类型双关是一种错误来源。\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"W2zMDjmy\"\u003Eunion还有一个额外的问题：非常的简单粗暴。你没有办法知道当前使用的类型是什么，更重要的是，它不会调用underlying types的析构函数。下面是一个来自 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fen.cppreference.com\u002Fw\u002Fcpp\u002Flanguage\u002Funion\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003Ecppreference\u002Funion\u003C\u002Fa\u003E 的示例，清楚地说明了它的使用复杂性：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"cp\"\u003E#include\u003C\u002Fspan\u003E \u003Cspan class=\"cpf\"\u003E&lt;iostream&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E#include\u003C\u002Fspan\u003E \u003Cspan class=\"cpf\"\u003E&lt;string&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E#include\u003C\u002Fspan\u003E \u003Cspan class=\"cpf\"\u003E&lt;vector&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Eunion\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003ES\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evector\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Evec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"o\"\u003E~\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ES\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\"c1\"\u003E\u002F\u002F what to delete here?\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003ES\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Es\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;Hello, world&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n    \u003Cspan class=\"c1\"\u003E\u002F\u002F at this point, reading from s.vec is undefined behavior\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;s.str = &#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Es\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estr\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"sc\"\u003E&#39;\\n&#39;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"c1\"\u003E\u002F\u002F you have to call destructor of the contained objects!\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E    \u003Cspan class=\"n\"\u003Es\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E~\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ebasic_string\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"c1\"\u003E\u002F\u002F and a constructor!\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E    \u003Cspan class=\"k\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Es\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evector\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"c1\"\u003E\u002F\u002F now, s.vec is the active member of the union\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E    \u003Cspan class=\"n\"\u003Es\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epush_back\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E10\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Es\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"sc\"\u003E&#39;\\n&#39;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"c1\"\u003E\u002F\u002F another destructor\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E    \u003Cspan class=\"n\"\u003Es\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E~\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evector\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"CRMJ41Rf\"\u003E运行代码 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fcoliru.stacked-crooked.com\u002Fa\u002F223359cc5bbd946f\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E@Coliru\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"gUHJxmlT\"\u003E如你所见，union使用时需要编码人员自己进行大量的维护存储。在切换到新的存储对象之前，你必须知道当前哪种类型处于活动状态并调用其析构函数\u002F构造函数。\u003C\u002Fp\u003E\u003Cp data-pid=\"fUKz8_9c\"\u003E这就是为什么你可能不会看到union中存储使用“高级”类型，例如vector、string或者其他的容器等，union主要还是用于基本类型。\u003C\u002Fp\u003E\u003Cp data-pid=\"nULcAKuq\"\u003E那怎么样让union会更好用呢？\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli data-pid=\"EaV5AhuZ\"\u003E可以使用复杂类型，包括对其生命周期的支持：如果切换类型，会调用对应的析构函数。\u003C\u002Fli\u003E\u003Cli data-pid=\"s13qygsh\"\u003E能清楚的知道当前激活的类型\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp data-pid=\"2fUqsg5n\"\u003E在C++17之前，你可以使用一些第三方库，例如boost::variant，但是现在你可以使用标准库中的std::variant。\u003C\u002Fp\u003E\u003Ch2\u003Estd::variant的基本演示案例\u003C\u002Fh2\u003E\u003Cp data-pid=\"vT9IcVOn\"\u003E下面是该类型的使用操作演示案例：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"cp\"\u003E#include\u003C\u002Fspan\u003E \u003Cspan class=\"cpf\"\u003E&lt;string&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E#include\u003C\u002Fspan\u003E \u003Cspan class=\"cpf\"\u003E&lt;iostream&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E#include\u003C\u002Fspan\u003E \u003Cspan class=\"cpf\"\u003E&lt;variant&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003ESampleVisitor\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eoperator\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \n        \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;int: &#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eoperator\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \n        \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;float: &#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eoperator\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()(\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Es\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \n        \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;string: &#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Es\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evariant\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Estatic_assert\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evariant_size_v\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Edecltype\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"c1\"\u003E\u002F\u002F default initialized to the first alternative, should be 0\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evisit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ESampleVisitor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{},\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"c1\"\u003E\u002F\u002F index will show the currently used &#39;type&#39;\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;index = &#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eindex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eendl\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mf\"\u003E100.0f\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;index = &#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eindex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eendl\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;hello super world&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;index = &#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eindex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eendl\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"c1\"\u003E\u002F\u002F try with get_if:\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E    \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintPtr\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eget_if\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintPtr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \n        \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;int!&#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EintPtr\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eelse\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EfloatPtr\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eget_if\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EfloatPtr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \n        \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;float!&#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EfloatPtr\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eholds_alternative\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;the variant holds an int!\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eelse\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eholds_alternative\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;the variant holds a float\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eelse\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eholds_alternative\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;the variant holds a string\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E  \n\n    \u003Cspan class=\"c1\"\u003E\u002F\u002F try\u002Fcatch and bad_variant_access\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E    \u003Cspan class=\"k\"\u003Etry\u003C\u002Fspan\u003E \n    \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eget\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E \n        \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;float! &#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Ecatch\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ebad_variant_access\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \n    \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;our variant doesn&#39;t hold float at this moment...\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"c1\"\u003E\u002F\u002F visit:\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evisit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ESampleVisitor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{},\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E10\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evisit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ESampleVisitor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{},\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mf\"\u003E10.0f\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evisit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ESampleVisitor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{},\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"aQZ59y_J\"\u003E运行代码 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fcoliru.stacked-crooked.com\u002Fa\u002F5405c8f9b7dc8e56\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E@Coliru\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"qgE7dHNg\"\u003E输出如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Eint: 0\nindex = 0\nindex = 1\nallocating 18 bytes\nindex = 2\nthe variant holds a string\nour variant doesn&#39;t hold float at this moment...\nstring: hello super world\nglobal op delete called\nint: 10\nfloat: 10\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"S1i6lyl2\"\u003E我们在上面的例子中展示了以下几件事：\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli data-pid=\"Z4qaro8f\"\u003E可以通过\u003Ccode\u003Eindex()\u003C\u002Fcode\u003E获取当前使用的类型，或者通过\u003Ccode\u003Eholds_alternative\u003C\u002Fcode\u003E来检查当前使用的类型。\u003C\u002Fli\u003E\u003Cli data-pid=\"aG6EuEiF\"\u003E可以通过\u003Ccode\u003Eget_if\u003C\u002Fcode\u003E或者\u003Ccode\u003Eget\u003C\u002Fcode\u003E（可能会抛出\u003Ccode\u003Ebad_variant_access\u003C\u002Fcode\u003E异常）来访问当前的值。\u003C\u002Fli\u003E\u003Cli data-pid=\"_QatnAOb\"\u003E类型安全--不允许获取未激活类型的值\u003C\u002Fli\u003E\u003Cli data-pid=\"saRak9Og\"\u003E如果未使用值来初始化variant，则会使用第一种类型进行初始化。在这种情况下，第一个类型必须具有默认构造函数。\u003C\u002Fli\u003E\u003Cli data-pid=\"6YMvYjXJ\"\u003E不会发生额外的堆内存分配。\u003C\u002Fli\u003E\u003Cli data-pid=\"H9rcRobm\"\u003E可以其当前激活的类型上使用visitor来自动执行一些方法。\u003C\u002Fli\u003E\u003Cli data-pid=\"bk2AaR4I\"\u003Evariant会自动调用非平凡类型的析构函数和构造函数。在示例中，string对象在我们切换到新类型之前被释放。\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ch2\u003E何时使用std::variant\u003C\u002Fh2\u003E\u003Cp data-pid=\"Ba0Rg7fN\"\u003E如果你正在处理一些底层的逻辑，并且只使用基本类型，那么union可能仍然是首选。但是对于其他的使用场景，std::variant是一种更好的方式。\u003C\u002Fp\u003E\u003Cp data-pid=\"ygZiggf7\"\u003E一些可能使用的场景：\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli data-pid=\"hkksdsrb\"\u003E所有可能为单个变量获得几种类型的地方：解析命令行、ini文件、语言解析器等。\u003C\u002Fli\u003E\u003Cli data-pid=\"u7tAUD0t\"\u003E有效地表达计算的几种可能结果：例如求解方程的根\u003C\u002Fli\u003E\u003Cli data-pid=\"OQfm8_K2\"\u003E错误处理：例如，您可以返回\u003Ccode\u003Evariant&lt;Object, ErrorCode&gt;\u003C\u002Fcode\u003E，如果返回值是有效的，则返回\u003Ccode\u003EObject\u003C\u002Fcode\u003E，否则分配一些错误码（C++23可以使用\u003Ccode\u003Estd::expected\u003C\u002Fcode\u003E）。\u003C\u002Fli\u003E\u003Cli data-pid=\"8vJr4oAs\"\u003E状态机\u003C\u002Fli\u003E\u003Cli data-pid=\"qCyvL9F-\"\u003E不使用虚表和继承实现的多态（visiting pattern）\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ch2\u003Estd::variant的构造\u003C\u002Fh2\u003E\u003Cp data-pid=\"d_Yxf9fH\"\u003E以下是std::variant的创建和初始化的几种方法：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"c1\"\u003E\u002F\u002F default initialization: (type has to has a default ctor)\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evariant\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eindex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;, value &#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eget\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EintFloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E\u002F\u002F monostate for default initialization:\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003ENotSimple\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Epublic\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003ENotSimple\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E\u002F\u002F std::variant&lt;NotSimple, int&gt; cannotInit; \u002F\u002F error\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evariant\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emonostate\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ENotSimple\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EokInit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EokInit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eindex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E\u002F\u002F pass a value:\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evariant\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"mf\"\u003E10.5f\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eindex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;, value &#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eget\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E\u002F\u002F ambiguity\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u002F\u002F double might convert to float or int, so the compiler cannot decide\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\n\u003Cspan class=\"c1\"\u003E\u002F\u002Fstd::variant&lt;int, float, std::string&gt; intFloatString { 10.5 };\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\n\u003Cspan class=\"c1\"\u003E\u002F\u002F ambiguity resolved by in_place\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evariant\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Elong\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ElongFloatString\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ein_place_index\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mf\"\u003E7.6\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E \u003Cspan class=\"c1\"\u003E\u002F\u002F double!\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ElongFloatString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eindex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;, value &#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eget\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ElongFloatString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E\u002F\u002F in_place for complex types\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evariant\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evector\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EvecStr\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ein_place_index\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E3\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}};\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EvecStr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eindex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;, vector size &#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eget\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evector\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EvecStr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E).\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E\u002F\u002F copy-initialize from other variant:\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evariant\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloatSecond\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloat\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloatSecond\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eindex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;, value &#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eget\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EintFloatSecond\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"YeDRBmc2\"\u003E运行代码 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fgodbolt.org\u002Fz\u002FW5j83Padv\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E@Compiler Explorer\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"5WeMQiSi\"\u003E输出如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E0, value 0\n0\n1, value 10.5\n1, value 7.6\n0, vector size 4\n0, value 0\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"Yk2C91VU\"\u003E知识点：\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli data-pid=\"iyblft4X\"\u003E默认情况下，variant对象使用第一种类型初始化被初始化。如果第一个类型没有默认构造函数时将会初始化失败，编译器会报错。但是在这种情况下，你可以将variant的第一种类型指定为\u003Ccode\u003Estd::monostate\u003C\u002Fcode\u003E。\u003C\u002Fli\u003E\u003Cli data-pid=\"TwRex0FQ\"\u003E可以使用具体的值来初始化variant，它将会匹配到最佳的类型。如果存在类型匹配的歧义，则可以使用\u003Ccode\u003Estd::in_place_index\u003C\u002Fcode\u003E来显式指定要匹配的类型。\u003C\u002Fli\u003E\u003Cli data-pid=\"B9MMo22Q\"\u003E\u003Ccode\u003Estd::in_place_index\u003C\u002Fcode\u003E允许创建复杂的类型并将参数传递给该类型对应的构造函数。\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp data-pid=\"piqDfUbA\"\u003E\u003Cstrong\u003E关于std::monostate\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"qRvATkDi\"\u003E在代码示例中你可能注意到一个特殊的类型：\u003Ccode\u003Estd::monostate\u003C\u002Fcode\u003E。它只是一个空类型，被用来和variant一起使用来表示空状态。当variant中的第一个类型没有默认构造函数时，建议将\u003Ccode\u003Estd::monostate\u003C\u002Fcode\u003E作为第一个类型来使用。\u003C\u002Fp\u003E\u003Ch2\u003E改变std::variant的值\u003C\u002Fh2\u003E\u003Cp data-pid=\"jiGkQ-pM\"\u003E四种方法可以variant的当前值：\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli data-pid=\"NoqE1UNn\"\u003E赋值操作符\u003C\u002Fli\u003E\u003Cli data-pid=\"jYYHN8ul\"\u003E\u003Ccode\u003Eemplace\u003C\u002Fcode\u003E\u003C\u002Fli\u003E\u003Cli data-pid=\"8F2SQ8jX\"\u003E\u003Ccode\u003Eget\u003C\u002Fcode\u003E然后给当前激活的类型赋新值\u003C\u002Fli\u003E\u003Cli data-pid=\"iTTMBtix\"\u003Evisitor访问器\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp data-pid=\"4KAh_Lm4\"\u003E这一切都是类型安全的，并且对象生存期也在控制范围之内。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evariant\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;Hello&#34;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n    \n\u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E10\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"c1\"\u003E\u002F\u002F we&#39;re now an int\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E    \n\u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eemplace\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;Hello&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E \u003Cspan class=\"c1\"\u003E\u002F\u002F we&#39;re now string again\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E    \n\u003Cspan class=\"c1\"\u003E\u002F\u002F std::get returns a reference, so you can change the value:\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eget\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34; World&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \n\u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mf\"\u003E10.1f\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EpFloat\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eget_if\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EpFloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EpFloat\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*=\u003C\u002Fspan\u003E \u003Cspan class=\"mf\"\u003E2.0f\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"y5aH3y6Y\"\u003E查看具体的示例代码 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fcoliru.stacked-crooked.com\u002Fa\u002Fc85ef3108ee72ac0\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E@Coliru\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003EHello\n10\nHello\nHello World\n20.2\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"xpSqLocN\"\u003E\u003Cstrong\u003E对象的生命周期\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"gPQU3Kxf\"\u003E当使用union时，需要自己管理其内部状态：调用构造函数或析构函数。这特别容易出错。但\u003Ccode\u003Estd::variant\u003C\u002Fcode\u003E会自动处理对象生存期。这意味着，如果它要更改当前存储的类型，则会自动调用其类型对应的析构函数。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evariant\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ev\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;Hello A Quite Long String&#34;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\u003Cspan class=\"c1\"\u003E\u002F\u002F v allocates some memory for the string\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ev\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E10\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"c1\"\u003E\u002F\u002F we call destructor for the string!\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u002F\u002F no memory leak\n\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"mtKfHe8O\"\u003E使用自定义类型查看此示例：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003EMyType\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Epublic\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EMyType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;MyType::MyType\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"o\"\u003E~\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EMyType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;MyType::~MyType\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"k\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003EOtherType\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Epublic\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EOtherType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;OtherType::OtherType\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EOtherType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EOtherType\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \n        \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;OtherType::OtherType(const OtherType&amp;)\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"o\"\u003E~\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EOtherType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;OtherType::~OtherType\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evariant\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EMyType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EOtherType\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ev\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Ev\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EOtherType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"MUjnNssj\"\u003E输出如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003EMyType::MyType\nOtherType::OtherType\nMyType::~MyType\nOtherType::OtherType(const OtherType&amp;)\nOtherType::~OtherType\nOtherType::~OtherType\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"9HRC_N8i\"\u003E运行代码 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fcoliru.stacked-crooked.com\u002Fa\u002F9c5e56e6420dd7d2\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E@Coliru\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"Z3TyijXw\"\u003E一开始，我们使用\u003Ccode\u003EMyType\u003C\u002Fcode\u003E的默认值来初始化variant；然后使用\u003Ccode\u003EOtherType\u003C\u002Fcode\u003E的实例更改variant的值。先调用\u003Ccode\u003EMyType\u003C\u002Fcode\u003E的析构函数，然后调用\u003Ccode\u003EOtherType\u003C\u002Fcode\u003E赋值运算符，稍后销毁临时对象，最后程序运行结束时销毁存储在variant中的对象。\u003C\u002Fp\u003E\u003Ch2\u003E访问存储的值\u003C\u002Fh2\u003E\u003Cp data-pid=\"WlygClxx\"\u003E在上面的示例中，你可能已经了解了如何访问该值。但是，让我们总结一下这项重要操作。\u003C\u002Fp\u003E\u003Cp data-pid=\"4KsezjHK\"\u003E首先，即使你知道当前激活类型是什么，你也无法执行如下代码：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evariant\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;Hello&#34;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Es\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c1\"\u003E\u002F\u002F error: conversion from \n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u002F\u002F &#39;std::variant&lt;int, float, std::string&gt;&#39; \n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u002F\u002F to non-scalar type &#39;std::string&#39; requested\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u002F\u002F std::string s = intFloatString;\n\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"5rV_l7Io\"\u003E因此，你必须使用辅助函数来访问该值。\u003C\u002Fp\u003E\u003Cp data-pid=\"SByQGKji\"\u003E你需要使用一个非成员函数\u003Ccode\u003Estd::get&lt;Type|Index&gt;(variant)\u003C\u002Fcode\u003E来访问内部的值。如果所需类型处于激活状态（可以传递类型或索引），则返回对应类型的引用。如果没有，那么你会得到\u003Ccode\u003Estd::bad_variant_access\u003C\u002Fcode\u003E异常。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evariant\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Etry\u003C\u002Fspan\u003E \n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eget\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E \n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;float! &#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Ecatch\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ebad_variant_access\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;our variant doesn&#39;t hold float at this moment...\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"UJm_SPGh\"\u003E另外一个函数是\u003Ccode\u003Estd::get_if\u003C\u002Fcode\u003E。它也是非成员函数，但不会引发异常。它返回指向激活类型的指针或者\u003Ccode\u003Enullptr\u003C\u002Fcode\u003E。\u003C\u002Fp\u003E\u003Cp data-pid=\"CZMKX2zK\"\u003E注意：\u003Ccode\u003Estd::get\u003C\u002Fcode\u003E返回对variant的引用，\u003Ccode\u003Estd::get_if\u003C\u002Fcode\u003E返回对variant的指针。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintPtr\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eget_if\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E \n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;int!&#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EintPtr\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"mRB6ndMG\"\u003E但是，访问variant中的值的最重要方法是使用访问者来实现。\u003C\u002Fp\u003E\u003Ch2\u003EVisitor for std::variant\u003C\u002Fh2\u003E\u003Cp data-pid=\"Wbh4p5P6\"\u003E我们需要介绍stl中另一个函数\u003Ccode\u003Estd::visit\u003C\u002Fcode\u003E。它可以在所有的variant参数上调用给定的“访问者”。\u003C\u002Fp\u003E\u003Cp data-pid=\"uMNk-yHb\"\u003E该函数的声明如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Etemplate\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003EVisitor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eclass\u003C\u002Fspan\u003E\u003Cspan class=\"err\"\u003E... \u003C\u002Fspan\u003E\u003Cspan class=\"nc\"\u003EVariants\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E  \n\u003Cspan class=\"k\"\u003Econstexpr\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Evisit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EVisitor\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Evis\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EVariants\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E...\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Evars\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"FSl2igx_\"\u003E它会在当前所有的variant的激活类型上调用visitor中的匹配的函数。\u003C\u002Fp\u003E\u003Cp data-pid=\"6e4c_ifs\"\u003E如果只传递一个variant，则必须对该variant中的类型进行重载。如果给出多个variant，则必须对所有variant中所有可能的类型对进行重载。\u003C\u002Fp\u003E\u003Cp data-pid=\"sLWsIJt0\"\u003Evisitor是“接受每个variant中所有可能的类型的可调用对象”。\u003C\u002Fp\u003E\u003Cp data-pid=\"wgdDLSh4\"\u003E例如：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"c1\"\u003E\u002F\u002F a generic lambda:\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EPrintVisitor\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[](\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Et\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Et\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evariant\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;Hello&#34;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evisit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EPrintVisitor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"tVC7bUf_\"\u003E在上面的示例中，泛型lambda用于生成所有可能的重载。由于variant中的所有类型都支持\u003Ccode\u003E&lt;&lt;\u003C\u002Fcode\u003E，因此我们可以成功打印它们。\u003C\u002Fp\u003E\u003Cp data-pid=\"xS872eUk\"\u003E在另一种情况下，我们可以使用visitor来更改当前的值：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EPrintVisitor\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[](\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Et\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Et\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ETwiceMoreVisitor\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[](\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Et\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Et\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evariant\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloat\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"mf\"\u003E20.4f\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evisit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EPrintVisitor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evisit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ETwiceMoreVisitor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evisit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EPrintVisitor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"iCcf6T3D\"\u003E如果我们的类型执行相同的逻辑，则泛型lambda可以很好的工作，但在大多数情况下，我们希望根据激活类型的不同，来执行一些不同的相应操作。\u003C\u002Fp\u003E\u003Cp data-pid=\"kKwTfv7p\"\u003E这样我们可以一个visitor，里面重载多个\u003Ccode\u003Eoperator ()\u003C\u002Fcode\u003E：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003EMultiplyVisitor\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EmFactor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"n\"\u003EMultiplyVisitor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efactor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EmFactor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efactor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eoperator\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*=\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Estatic_cast\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EmFactor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eoperator\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EmFactor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eoperator\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"c1\"\u003E\u002F\u002F nothing to do here...\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evisit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EMultiplyVisitor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mf\"\u003E0.5f\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evisit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EPrintVisitor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"MVTTCf5N\"\u003E在示例中，我们使用了一个状态来保存所需的比例因子。\u003C\u002Fp\u003E\u003Cp data-pid=\"_SzY7EhJ\"\u003E对于lambda，我们只需要在其使用之前定义好它就行。然后当你需要编写一个单独的类时，你需要在该作用域范围之外定义它。这就是为什么使用overload来构造visitor更方便的原因。\u003C\u002Fp\u003E\u003Ch2\u003EOverload\u003C\u002Fh2\u003E\u003Cp data-pid=\"DwH8DTHU\"\u003E使用此技巧，你可以在一个位置编写多个lambda来匹配variant中的所有类型：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evisit\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003Eoverload\u003C\u002Fspan\u003E\n  \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E[](\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EPRINT\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;int: &#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E},\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E[](\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Es\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EPRINT\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;it&#39;s a string: &#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Es\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E},\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E[](\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EPRINT\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;float&#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n  \u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003EyourVariant\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"omBmhXmz\"\u003E目前，它不是库的一部分，但可能的代码如下所示：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Etemplate\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Eclass\u003C\u002Fspan\u003E\u003Cspan class=\"err\"\u003E... \u003C\u002Fspan\u003E\u003Cspan class=\"nc\"\u003ETs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003Eoverload\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ETs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E...\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eusing\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ETs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Eoperator\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()...;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Etemplate\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Eclass\u003C\u002Fspan\u003E\u003Cspan class=\"err\"\u003E... \u003C\u002Fspan\u003E\u003Cspan class=\"nc\"\u003ETs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eoverload\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ETs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E...)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eoverload\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ETs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E...\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"SJW61cj8\"\u003E这两行看起来有点魔幻，但是它们做的只是创建一个类，该类继承所有给定的lambda，并重载了所有的\u003Ccode\u003ETs::operator()\u003C\u002Fcode\u003E。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evariant\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;Hello&#34;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evisit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eoverload\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E[](\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E},\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E[](\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*=\u003C\u002Fspan\u003E \u003Cspan class=\"mf\"\u003E2.0f\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E},\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E[](\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Es\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Es\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Es\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Es\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E},\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evisit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EPrintVisitor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EintFloatString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003Cspan class=\"c1\"\u003E\u002F\u002F prints: &#34;HelloHello&#34;\n\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"-gONp3ii\"\u003E运行代码 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fcoliru.stacked-crooked.com\u002Fa\u002F666fdd79c5bcb80c\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E@Coliru\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"LHnHvS8u\"\u003E以下是解释该功能的完整博客文章：\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fwww.cppstories.com\u002F2019\u002F02\u002F2lines3featuresoverload.html\u002F\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E2 Lines Of Code and 3 C++17 Features - The overload Pattern - C++ Stories.\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"ZZkmNFYR\"\u003E以及其他的一些文章：\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli data-pid=\"WsIgJpNf\"\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Farne-mertz.de\u002F2018\u002F05\u002Foverload-build-a-variant-visitor-on-the-fly\u002F\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E SimplifyC++ - Overload: Build a Variant Visitor on the Fly.\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003Cli data-pid=\"SQv-z5ma\"\u003E\u003Ccode\u003Estd::overload\u003C\u002Fcode\u003E的提案的论文：\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fwww.open-std.org\u002Fjtc1\u002Fsc22\u002Fwg21\u002Fdocs\u002Fpapers\u002F2018\u002Fp0051r3.pdf\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E P0051 - C++generic overload function\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003Cli data-pid=\"KaDT-24t\"\u003E如果你想知道std::visit是如何工作的，那么你可以看看这篇文章：\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fmpark.github.io\u002Fprogramming\u002F2015\u002F07\u002F07\u002Fvariant-visitation\u002F\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E Variant Visitation \u003C\u002Fa\u003Eby Michael Park\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ch2\u003Estd::variant的其他操作\u003C\u002Fh2\u003E\u003Cul\u003E\u003Cli data-pid=\"5aj1rVRi\"\u003E你可以比较两个相同类型的variant：如果它们拥有相同的激活类型项，则会调用该类型的比较运算符。否则会根据它们激活类型的索引值大小进行比较。\u003C\u002Fli\u003E\u003Cli data-pid=\"3faCT1-e\"\u003Evariant是一种值类型，因此可以移动它。\u003C\u002Fli\u003E\u003Cli data-pid=\"FFA1dJCU\"\u003E可以在variant上使用std::hash。\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ch2\u003E异常安全保证\u003C\u002Fh2\u003E\u003Cp data-pid=\"pzzJhwhD\"\u003E到目前为止，一切看起来都很好，很顺利...但是，如果在variant赋值期间出现异常，会发生什么情况？\u003C\u002Fp\u003E\u003Cp data-pid=\"bQA-TmQ4\"\u003E举个例子：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003EThrowingClass\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Epublic\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eexplicit\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EThrowingClass\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ethrow\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E10\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eoperator\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ethrow\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E10\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargc\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E**\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evariant\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EThrowingClass\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ev\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"c1\"\u003E\u002F\u002F change the value:\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E    \u003Cspan class=\"k\"\u003Etry\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Ev\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EThrowingClass\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Ecatch\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(...)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;catch(...)\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n        \u003Cspan class=\"c1\"\u003E\u002F\u002F we keep the old state!\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E        \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ev\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evalueless_by_exception\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E   \n        \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eget\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ev\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"c1\"\u003E\u002F\u002F inside emplace\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E    \u003Cspan class=\"k\"\u003Etry\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Ev\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eemplace\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EThrowingClass\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E10\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E \u003Cspan class=\"c1\"\u003E\u002F\u002F calls the operator int\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Ecatch\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(...)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;catch(...)\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n        \u003Cspan class=\"c1\"\u003E\u002F\u002F the old state was destroyed, so we&#39;re not in invalid state!\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E        \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ev\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evalueless_by_exception\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E   \n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"hgzrxqDV\"\u003E运行代码 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fcoliru.stacked-crooked.com\u002Fa\u002F413ce70317dbd2e5\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E@Coliru\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"uasz-jxr\"\u003E输出如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Eatch(...)\n0\n0\ncatch(...)\n1\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"mXF_XHLz\"\u003E第一种情况，在使用赋值运算符时，在类的构造函数中引发异常。该异常发生在variant的旧值被替换之前，因此variant中的状态保持不变，我们仍然可以正常访问它。\u003C\u002Fp\u003E\u003Cp data-pid=\"RqWe7oWq\"\u003E第二种情况，使用\u003Ccode\u003Eemplace\u003C\u002Fcode\u003E，此时是variant中的旧状态被销毁后引发异常。Emplace调用\u003Ccode\u003Eoperator int\u003C\u002Fcode\u003E来替换值，但此时引发异常之后会导致variant处于错误状态，而无法恢复。\u003C\u002Fp\u003E\u003Cp data-pid=\"w3Drs-zt\"\u003E因异常无值的 variant 被当做在非法态： \u003Ccode\u003Eindex\u003C\u002Fcode\u003E 返回 \u003Ccode\u003Evariant_npos\u003C\u002Fcode\u003E ， \u003Ccode\u003Eget\u003C\u002Fcode\u003E 与 \u003Ccode\u003Evisit\u003C\u002Fcode\u003E 抛出 \u003Ccode\u003Ebad_variant_access\u003C\u002Fcode\u003E 。\u003C\u002Fp\u003E\u003Ch2\u003E性能和内存注意事项\u003C\u002Fh2\u003E\u003Cp data-pid=\"xC6mIRnB\"\u003E\u003Ccode\u003Estd::variant\u003C\u002Fcode\u003E和\u003Ccode\u003EUnion\u003C\u002Fcode\u003E的使用内存方式类似：它采用存储类型的最大大小。但是，由于我们需要知道当前variant中激活的类型，因此variant中需要更多的一点存储空间。\u003C\u002Fp\u003E\u003Cp data-pid=\"fkZAKmAo\"\u003E此外，一切都需要遵守对齐规则。以下是一些储存大小测试数据：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;sizeof string: &#34;\u003C\u002Fspan\u003E \n          \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Esizeof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;sizeof variant&lt;int, string&gt;: &#34;\u003C\u002Fspan\u003E \n          \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Esizeof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evariant\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;sizeof variant&lt;int, float&gt;: &#34;\u003C\u002Fspan\u003E \n          \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Esizeof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evariant\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;sizeof variant&lt;int, double&gt;: &#34;\u003C\u002Fspan\u003E \n          \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Esizeof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evariant\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Edouble\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"6ktle7Yb\"\u003E在GCC8.1上，32位的运行程序，输出如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Esizeof string: 32\nsizeof variant&lt;int, string&gt;: 40\nsizeof variant&lt;int, float&gt;: 8\nsizeof variant&lt;int, double&gt;: 16\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"XKwj9Uo6\"\u003E运行代码 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fcoliru.stacked-crooked.com\u002Fa\u002F90fcd7d520abcaf3\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E@Coliru\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"a7yYM8P2\"\u003Evariant不会分配任何额外的堆空间，虽然variant为了保证类型安全多占用了几个字节的存储空间，但它不会多花费运行时的性能。\u003C\u002Fp\u003E\u003Ch2\u003E迁移自boost::variant\u003C\u002Fh2\u003E\u003Cp data-pid=\"KcOggAsW\"\u003EBoost Variant 是在 2004 年推出的，因此在\u003Ccode\u003Estd::variant\u003C\u002Fcode\u003E被添加到标准库之前已有 13年的经验。STL借鉴了boost中的经验并对其进行了改进。\u003C\u002Fp\u003E\u003Cp data-pid=\"2YlKBs5z\"\u003E主要改变如下：\u003C\u002Fp\u003E\u003Ctable data-draft-node=\"block\" data-draft-type=\"table\" data-size=\"normal\" data-row-style=\"striped\"\u003E\u003Ctbody\u003E\u003Ctr\u003E\u003Cth\u003E特点\u003C\u002Fth\u003E\u003Cth\u003Eboost::variant(1.67.0)\u003C\u002Fth\u003E\u003Cth\u003Estd::variant\u003C\u002Fth\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd\u003E额外的内存分配\u003C\u002Ftd\u003E\u003Ctd\u003E可能在赋值时发生, 参见Design Overview - Never Empty\u003C\u002Ftd\u003E\u003Ctd\u003E否\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd\u003E访问值\u003C\u002Ftd\u003E\u003Ctd\u003Eapply_visitor\u003C\u002Ftd\u003E\u003Ctd\u003Estd::visit\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd\u003E按索引获取值\u003C\u002Ftd\u003E\u003Ctd\u003E否\u003C\u002Ftd\u003E\u003Ctd\u003E是\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd\u003E递归的variant\u003C\u002Ftd\u003E\u003Ctd\u003E是，参加make_recursive_variant\u003C\u002Ftd\u003E\u003Ctd\u003E否\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd\u003E空值的处理\u003C\u002Ftd\u003E\u003Ctd\u003Eboost::blank\u003C\u002Ftd\u003E\u003Ctd\u003Estd::monostate\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003C\u002Ftbody\u003E\u003C\u002Ftable\u003E\u003Cp data-pid=\"LHuHLWEx\"\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fgithub.com\u002FCppCon\u002FCppCon2016\u002Ftree\u002Fmaster\u002FPresentations\u002FVariants%2520-%2520Past%252C%2520Present%252C%2520and%2520Future\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EVariants - Past, Present, and Future - David Sankel - CppCon 2016\u003C\u002Fa\u003E 或者 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fwww.youtube.com\u002Fwatch%3Fv%3Dk3O4EKX4z1c%26t%3D621s\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E@Youtube\u003C\u002Fa\u003E 中有更多关于该提案的讨论。\u003C\u002Fp\u003E\u003Ch2\u003Estd::variant的使用案例\u003C\u002Fh2\u003E\u003Cp data-pid=\"8N393xWf\"\u003E在我们了解了\u003Ccode\u003Estd::variant\u003C\u002Fcode\u003E的大部分细节之后，在本节中将展示几个实际的使用案例。\u003C\u002Fp\u003E\u003Ch3\u003E错误处理\u003C\u002Fh3\u003E\u003Cp data-pid=\"B1G0OFta\"\u003E基本思想是将ErrorCode错误码包装到variant的返回类型中，这样就可以输出有关错误的更多信息，而不使用异常或输出参数。这类似于 C++23 中的\u003Ccode\u003Estd::expected\u003C\u002Fcode\u003E，参见 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fen.cppreference.com\u002Fw\u002Fcpp\u002Futility\u002Fexpected\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003Estd::expected - cppreference.com\u003C\u002Fa\u003E。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Eenum\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003EErrorCode\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EOk\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003ESystemError\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EIoError\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003ENetworkError\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evariant\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EErrorCode\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFetchNameFromNetwork\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EErrorCode\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ESystemError\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EErrorCode\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ENetworkError\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;Hello World!&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eresponse\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFetchNameFromNetwork\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eholds_alternative\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eresponse\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eget\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eresponse\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;n&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eelse\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;Error!\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"n\"\u003Eresponse\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFetchNameFromNetwork\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E10\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eholds_alternative\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eresponse\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eget\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eresponse\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;n&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eelse\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;Error!\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"jIkUdYJD\"\u003E运行代码 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fcoliru.stacked-crooked.com\u002Fa\u002F92da8c748882edd9\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E@Coliru\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"51NPzitD\"\u003E在示例中，返回值为ErrorCode或有效类型（在本例中为string）。\u003C\u002Fp\u003E\u003Ch3\u003E计算方程的根\u003C\u002Fh3\u003E\u003Cp data-pid=\"pXp-4rTN\"\u003E有时函数的返回值可能会有几个不同选项，例如，求解方程的实根。使用variant，可以包装所有可能的选项，并清楚地表达找到的根值数量。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Eusing\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDoublePair\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epair\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Edouble\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Edouble\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Eusing\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EEquationRoots\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evariant\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EDoublePair\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Edouble\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emonostate\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \n\n\u003Cspan class=\"n\"\u003EEquationRoots\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003EFindRoots\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Edouble\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Edouble\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eb\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Edouble\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"mf\"\u003E0.0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Enan\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ed\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eb\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eb\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"c1\"\u003E\u002F\u002F discriminant\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E    \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ed\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"mf\"\u003E0.0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"kt\"\u003Edouble\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eroot1\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eb\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esqrt\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ed\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E\u002F\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n        \u003Cspan class=\"kt\"\u003Edouble\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eroot2\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eb\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esqrt\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ed\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E\u002F\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emake_pair\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eroot1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eroot2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eelse\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ed\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"mf\"\u003E0.0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eb\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emonostate\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003ERootPrinterVisitor\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eoperator\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()(\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDoublePair\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Earg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \n    \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \n        \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;2 roots: &#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Earg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efirst\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34; &#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Earg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esecond\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"sc\"\u003E&#39;\\n&#39;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eoperator\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Edouble\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Earg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \n    \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \n        \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eisnan\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Earg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;not a quadratic equation!&#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Earg\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"sc\"\u003E&#39;\\n&#39;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \n        \u003Cspan class=\"k\"\u003Eelse\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;1 root found: &#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Earg\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"sc\"\u003E&#39;\\n&#39;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eoperator\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emonostate\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \n    \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \n        \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;No real roots found.\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evisit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ERootPrinterVisitor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{},\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFindRoots\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E10\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evisit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ERootPrinterVisitor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{},\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFindRoots\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evisit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ERootPrinterVisitor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{},\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFindRoots\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evisit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ERootPrinterVisitor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{},\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFindRoots\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evisit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ERootPrinterVisitor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{},\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFindRoots\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"cxiKJC5k\"\u003E运行代码 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fgodbolt.org\u002Fz\u002FWqoKxff1z\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E@Compiler Explorer\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"mGoHXBch\"\u003E输出如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eroots\u003C\u002Fspan\u003E \u003Cspan class=\"nl\"\u003Efound\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"mf\"\u003E0.447214\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"mf\"\u003E0.447214\u003C\u002Fspan\u003E\n\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eroots\u003C\u002Fspan\u003E \u003Cspan class=\"nl\"\u003Efound\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"mf\"\u003E0.707107\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"mf\"\u003E0.707107\u003C\u002Fspan\u003E\n\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eroot\u003C\u002Fspan\u003E \u003Cspan class=\"nl\"\u003Efound\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003ENo\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ereal\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eroots\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efound\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Enot\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Equadratic\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eequation\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E!\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enan\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Ch3\u003E解析命令行\u003C\u002Fh3\u003E\u003Cp data-pid=\"OoXk2c3Z\"\u003E命令行可能包含以几种方式的文本参数：\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli data-pid=\"oVir0OMV\"\u003E整数\u003C\u002Fli\u003E\u003Cli data-pid=\"BJtrUM9f\"\u003E布尔值\u003C\u002Fli\u003E\u003Cli data-pid=\"yE8Ke41n\"\u003E字符串\u003C\u002Fli\u003E\u003Cli data-pid=\"h3AO8BkH\"\u003E...\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp data-pid=\"3M3Fpy2v\"\u003E我们可以构建一个包含所有可能选项的variant，以下示例是一个包含int和string的简单版本。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003ECmdLine\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Epublic\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eusing\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EArg\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evariant\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"k\"\u003Eprivate\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emap\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EArg\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EmParsedArgs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"k\"\u003Epublic\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eexplicit\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ECmdLine\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargc\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E**\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EParseArgs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargc\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"c1\"\u003E\u002F\u002F ...\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"n\"\u003ECmdLine\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EArg\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ETryParseString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Earg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"c1\"\u003E\u002F\u002F try with int first\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E    \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EiResult\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eres\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efrom_chars\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Earg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Earg\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estrlen\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Earg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EiResult\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eres\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eec\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eerrc\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Einvalid_argument\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"c1\"\u003E\u002F\u002F if not possible, then just assume it&#39;s a string\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E        \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Earg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EiResult\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ECmdLine\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EParseArgs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargc\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E**\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"c1\"\u003E\u002F\u002F the form: -argName value -argName value\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E    \u003Cspan class=\"c1\"\u003E\u002F\u002F unnamed? later...\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E    \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargc\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E+=\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E][\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E!=\u003C\u002Fspan\u003E \u003Cspan class=\"sc\"\u003E&#39;-&#39;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"c1\"\u003E\u002F\u002F super advanced pattern matching! :)\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E            \u003Cspan class=\"k\"\u003Ethrow\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eruntime_error\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;wrong command name&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"n\"\u003EmParsedArgs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ETryParseString\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"mJxJLTBz\"\u003E\u003Ccode\u003Estd::from_chars\u003C\u002Fcode\u003E在GCC中仅支持整数，在MSVC中支持浮点数。\u003Ccode\u003ETryParseString\u003C\u002Fcode\u003E函数尝试将输入字符串解析为其最佳匹配的类型，如果它看起来像一个整数，那么我们尝试将其转换为整数。否则，我们将返回一个未解析的字符串。\u003C\u002Fp\u003E\u003Cp data-pid=\"05uDu7Bk\"\u003E下面展示我们如何使用它：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Etry\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003ECmdLine\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003EcmdLine\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargc\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Earg\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EcmdLine\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EFind\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;paramInt&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Earg\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eholds_alternative\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Earg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;paramInt is &#34;\u003C\u002Fspan\u003E \n                  \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eget\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Earg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"n\"\u003Earg\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EcmdLine\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EFind\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;textParam&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Earg\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eholds_alternative\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Earg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;textParam is &#34;\u003C\u002Fspan\u003E \n                  \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eget\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Earg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E    \n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Ecatch\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eruntime_error\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eerr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eerr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ewhat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"1UX2qHUG\"\u003E运行代码 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fcoliru.stacked-crooked.com\u002Fa\u002F084579f913d0d821\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E@Coliru\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Ch3\u003E状态机\u003C\u002Fh3\u003E\u003Cp data-pid=\"H3bO_DWa\"\u003E什么是状态机？例如，门的状态：\u003C\u002Fp\u003E\u003Cp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-59a5059ee4c0e71ad28a7b2aac7639f9_b.jpg\" data-size=\"normal\" class=\"content_image\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;0&#39; height=&#39;0&#39;&gt;&lt;\u002Fsvg&gt;\" data-size=\"normal\" class=\"content_image lazy\" data-actualsrc=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-59a5059ee4c0e71ad28a7b2aac7639f9_b.jpg\" data-original-token=\"v2-59a5059ee4c0e71ad28a7b2aac7639f9\"\u002F\u003E\u003Cfigcaption\u003EImage\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"zpDPNCNU\"\u003E定义不同类型的状态：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003EDoorState\u003C\u002Fspan\u003E \n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003EDoorOpened\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{};\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003EDoorClosed\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{};\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003EDoorLocked\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{};\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"k\"\u003Eusing\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EState\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evariant\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EDoorOpened\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDoorClosed\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDoorLocked\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eopen\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Em_state\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evisit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EOpenEvent\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{},\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Em_state\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eclose\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Em_state\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evisit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECloseEvent\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{},\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Em_state\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Elock\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Em_state\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evisit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ELockEvent\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{},\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Em_state\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eunlock\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Em_state\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evisit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EUnlockEvent\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{},\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Em_state\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"n\"\u003EState\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Em_state\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"ADBCbOHC\"\u003E定义不同的event：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003EOpenEvent\u003C\u002Fspan\u003E \n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EState\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eoperator\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()(\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDoorOpened\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E){\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDoorOpened\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EState\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eoperator\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()(\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDoorClosed\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E){\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDoorOpened\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"c1\"\u003E\u002F\u002F cannot open locked doors\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E    \u003Cspan class=\"n\"\u003EState\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eoperator\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()(\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDoorLocked\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E){\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDoorLocked\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E \n\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003ECloseEvent\u003C\u002Fspan\u003E \n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EState\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eoperator\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()(\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDoorOpened\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E){\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDoorClosed\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EState\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eoperator\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()(\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDoorClosed\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E){\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDoorClosed\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EState\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eoperator\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()(\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDoorLocked\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E){\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDoorLocked\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003ELockEvent\u003C\u002Fspan\u003E \n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"c1\"\u003E\u002F\u002F cannot lock opened doors\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E    \u003Cspan class=\"n\"\u003EState\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eoperator\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()(\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDoorOpened\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E){\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDoorOpened\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EState\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eoperator\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()(\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDoorClosed\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E){\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDoorLocked\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EState\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eoperator\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()(\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDoorLocked\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E){\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDoorLocked\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003EUnlockEvent\u003C\u002Fspan\u003E \n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"c1\"\u003E\u002F\u002F cannot unlock opened doors\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E    \u003Cspan class=\"n\"\u003EState\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eoperator\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()(\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDoorOpened\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E){\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDoorOpened\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EState\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eoperator\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()(\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDoorClosed\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E){\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDoorClosed\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"c1\"\u003E\u002F\u002F unlock\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E    \u003Cspan class=\"n\"\u003EState\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eoperator\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()(\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDoorLocked\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E){\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDoorClosed\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E \n\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"jdYl_s60\"\u003E示例代码参见：\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fcoliru.stacked-crooked.com\u002Fa\u002F1828b27f5b94e693\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E@Coliru\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"YM_G3XlO\"\u003E具体更详细关于有限状态机的解析，参见文章： \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fwww.patreon.com\u002Fposts\u002F53399468\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003Ethe first about &#34;enum style FSM into variant-based&#34; or the second\u003C\u002Fa\u003E或者\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fwww.patreon.com\u002Fposts\u002F53936285\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E the second article\u003C\u002Fa\u003E 。\u003C\u002Fp\u003E\u003Cp data-pid=\"pgZgH4tU\"\u003E这个示例想法基于以下的文章博客，可以参考一下：\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli data-pid=\"RMwHDg1M\"\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fmooooo.ooo\u002Fsumtypes-and-statemachines\u002F\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003ESum types and state machines in C++17\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003Cli data-pid=\"w32YkGqQ\"\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fkhuttun.github.io\u002F2017\u002F02\u002F04\u002Fimplementing-state-machines-with-std-variant.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EImplementing State Machines with std::variant\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ch3\u003E实现多态\u003C\u002Fh3\u003E\u003Cp data-pid=\"4bkk4PKr\"\u003E在大多数情况下，我们通常会在C++中使用基于虚表的运行时多态。但是采用variant和visit我们可以堆一组没有公共基类的类型实现静态多态的功能。\u003C\u002Fp\u003E\u003Cp data-pid=\"W3bFlMye\"\u003E示例代码如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003ETriangle\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Epublic\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ERender\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E  \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;Drawing a triangle!\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"k\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003EPolygon\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Epublic\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ERender\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;Drawing a polygon!\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"k\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003ESphere\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Epublic\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ERender\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;Drawing a sphere!\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\n\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \n\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evector\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evariant\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ETriangle\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EPolygon\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ESphere\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eobjects\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \n        \u003Cspan class=\"n\"\u003EPolygon\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(),\u003C\u002Fspan\u003E \n        \u003Cspan class=\"n\"\u003ETriangle\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(),\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003ESphere\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(),\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003ETriangle\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ECallRender\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[](\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eobj\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eobj\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ERender\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"nl\"\u003Eobj\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eobjects\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evisit\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECallRender\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eobj\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"P1_2-dD2\"\u003E运行代码 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fcoliru.stacked-crooked.com\u002Fa\u002F2a2bcdb43d89de87\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E@Coliru\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"w2jzzKvT\"\u003E输出如下；\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003EDrawing a polygon!\nDrawing a triangle!\nDrawing a sphere!\nDrawing a triangle!\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"6gqQnNYG\"\u003E上面的示例中，展示了从一组不相关类型中调用方法的情况。我们将不同的形状类型包装到单个variant中，然后使用visit来调用相应的函数到正确的类型。\u003C\u002Fp\u003E\u003Cp data-pid=\"akt7Cjbm\"\u003E另一篇文章详细解释了这种多态性：\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fwww.cppstories.com\u002F2020\u002F04\u002Fvariant-virtual-polymorphism.html\u002F\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003ERuntime Polymorphism with std::variant and std::visit - C++ Stories\u003C\u002Fa\u003E。\u003C\u002Fp\u003E\u003Cp data-pid=\"w2CpCwUg\"\u003E你可以在以下文章来了解此模式的更多信息：\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli data-pid=\"1q_AEk97\"\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fakrzemi1.wordpress.com\u002F2016\u002F02\u002F27\u002Fanother-polymorphism\u002F\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EAnother polymorphism | Andrzej’s C++ blog\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003Cli data-pid=\"xzL8ZTQy\"\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fcpptruths.blogspot.com\u002F2018\u002F02\u002Finheritance-vs-stdvariant-based.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EInheritance vs std::variant, C++ Truths\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ch3\u003E其他用途\u003C\u002Fh3\u003E\u003Cp data-pid=\"NbUZ8mU4\"\u003E这里还有很多很多例子，请参见以下推特链接：\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli data-pid=\"zvqheVsX\"\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Ftwitter.com\u002Fhashtag\u002Fcpp17%3Fsrc%3Dhash%26ref_src%3Dtwsrc%255Etfw\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003Edo you have any real-life examples of std::variant?#cpp #cpp17\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003Cli data-pid=\"6PS3gCUp\"\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Ftwitter.com\u002Ffenbf\u002Fstatus\u002F999755954005663744%3Fref_src%3Dtwsrc%255Etfw\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EBartlomiej Filipek (@fenbf) 24 maja 2018\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ch2\u003EC++20和C++23改进\u003C\u002Fh2\u003E\u003Cp data-pid=\"XPSXW_e3\"\u003EC++20和C++23中\u003Ccode\u003Estd::variant\u003C\u002Fcode\u003E进行了一些小的更新。例如，感谢 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fwww.open-std.org\u002Fjtc1\u002Fsc22\u002Fwg21\u002Fdocs\u002Fpapers\u002F2021\u002Fp2231r1.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EP2231\u003C\u002Fa\u003E得以在C++20中实现，我们可以在常量表达式中使用\u003Ccode\u003Estd::variant\u003C\u002Fcode\u003E。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"cp\"\u003E#include\u003C\u002Fspan\u003E \u003Cspan class=\"cpf\"\u003E&lt;iostream&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E#include\u003C\u002Fspan\u003E \u003Cspan class=\"cpf\"\u003E&lt;variant&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Econstexpr\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evariant\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Edouble\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efoo\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Evariant\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Edouble\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eoi\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"mf\"\u003E0.1\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E10\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Eoi\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eoi\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n   \u003Cspan class=\"k\"\u003Econstexpr\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edv\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efoo\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n   \u003Cspan class=\"k\"\u003Estatic_assert\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eholds_alternative\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Edouble\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Edv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E\n   \u003Cspan class=\"k\"\u003Econstexpr\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eiv\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efoo\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E100\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n   \u003Cspan class=\"k\"\u003Estatic_assert\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eholds_alternative\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eiv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"N4kwEYJ6\"\u003E运行代码 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fgodbolt.org\u002Fz\u002F3f1zrKnrb\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E@Compiler Explorer\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"vRXscFqP\"\u003E此外，对于以下情况，还有一个重要的修复：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"n\"\u003Evariant\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Ebool\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;abc&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E             \u003Cspan class=\"c1\"\u003E\u002F\u002F holds bool !!\n\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"vyziC9uc\"\u003E具体可以参见：\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fwww.open-std.org\u002Fjtc1\u002Fsc22\u002Fwg21\u002Fdocs\u002Fpapers\u002F2018\u002Fp0608r3.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E A sane std::variant converting constructor \u003C\u002Fa\u003E。\u003C\u002Fp\u003E\u003Cp data-pid=\"k9Zo7Xc0\"\u003E还有一些其他的特性：\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli data-pid=\"ZWU4uWiu\"\u003E\u003Ccode\u003Estd::visit\u003C\u002Fcode\u003E对于继承于\u003Ccode\u003Estd::variant\u003C\u002Fcode\u003E的子类的应用，\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fwww.open-std.org\u002Fjtc1\u002Fsc22\u002Fwg21\u002Fdocs\u002Fpapers\u002F2021\u002Fp2162r2.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003Estd::visit() for classes derived from std::variant\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003Cli data-pid=\"7QZSR1vs\"\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fwww.open-std.org\u002Fjtc1\u002Fsc22\u002Fwg21\u002Fdocs\u002Fpapers\u002F2018\u002Fp0602r4.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003Estd::variant and std::optional should propagate copy\u002Fmove triviality\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ch2\u003E其他\u003C\u002Fh2\u003E\u003Cp data-pid=\"FrvEEY16\"\u003E关于\u003Ccode\u003Estd::variant\u003C\u002Fcode\u003E的一些其他文章参考：\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli data-pid=\"Ipjj-X6s\"\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.modernescpp.com\u002Findex.php\u002Fc-17-constructed-in-place\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EC++17 has a Visitor Modernes C++\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003Cli data-pid=\"_KU0qzLM\"\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fwww.foonathan.net\u002F2016\u002F12\u002Fvariant\u002F\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EMy take on variant - Jonathan Müller\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ch2\u003E参考\u003C\u002Fh2\u003E\u003Cp data-pid=\"VmtjhOGn\"\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fwww.cppstories.com\u002F2018\u002F06\u002Fvariant\u002F%23overload\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EEverything You Need to Know About std::variant from C++17\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp data-pid=\"h5elNDFN\"\u003E相关或相似的文章：\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli data-pid=\"iL4O1zZo\"\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fwww.cppstories.com\u002F2018\u002F05\u002Ferrors-and-optional\u002F\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EError Handling and std::optional\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003Cli data-pid=\"hjF16J8Y\"\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fwww.cppstories.com\u002F2019\u002F06\u002Ffsm-variant-game\u002F\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003ESpace Game: A std::variant-Based State Machine by Example\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003Cli data-pid=\"Eiu6KOX9\"\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fwww.cppstories.com\u002F2018\u002F08\u002Fsearchers\u002F\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003ESpeeding up Pattern Searches with Boyer-Moore Algorithm from C++17\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003Cli data-pid=\"QK6YnJ80\"\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fwww.cppstories.com\u002F2018\u002F12\u002Ffromchars\u002F\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EHow to Use The Newest C++ String Conversion Routines - std::from_chars\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003Cli data-pid=\"6BWIyT7v\"\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fwww.cppstories.com\u002F2018\u002F11\u002Fpstl\u002F\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EHow to Boost Performance with Intel Parallel STL and C++17 Parallel Algorithms\u003C\u002Fa\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cblockquote data-pid=\"jsmGKmVt\"\u003E\u003Cp data-pid=\"KsRSkL9X\"\u003E本文使用 \u003Ca href=\"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F106057556\" class=\"internal\"\u003EZhihu On VSCode\u003C\u002Fa\u003E 创作并发布\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E","adminClosedComment":false,"topics":[{"url":"https:\u002F\u002Fwww.zhihu.com\u002Fapi\u002Fv4\u002Ftopics\u002F19584970","type":"topic","id":"19584970","name":"C++"},{"url":"https:\u002F\u002Fwww.zhihu.com\u002Fapi\u002Fv4\u002Ftopics\u002F26652979","type":"topic","id":"26652979","name":"C++ STL"}],"voteupCount":17,"voting":0,"heavyUpStatus":"allow_heavy_up","column":{"description":"","canManage":false,"intro":"","isFollowing":false,"urlToken":"c_1506624979713769473","id":"c_1506624979713769473","articlesCount":16,"acceptSubmission":false,"title":"C++杂谈","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fc_1506624979713769473","commentPermission":"all","created":1651987387,"updated":1677994781,"imageUrl":"https:\u002F\u002Fpic1.zhimg.com\u002F4b70deef7_720w.jpg?source=172ae18b","author":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpicx.zhimg.com\u002Fv2-8352ba83f5aad85676e8527f9e6abdbd.jpg?source=172ae18b","uid":"628729227072245760","userType":"people","isFollowing":false,"urlToken":"li-cong-lei-62","id":"24c099308d02ba46367d952aba6b9f77","description":"跳出舒适圈，终身学习","name":"勿忘心安","isAdvertiser":false,"headline":"游戏客户端","gender":1,"url":"\u002Fpeople\u002F24c099308d02ba46367d952aba6b9f77","avatarUrl":"https:\u002F\u002Fpicx.zhimg.com\u002Fv2-8352ba83f5aad85676e8527f9e6abdbd_l.jpg?source=172ae18b","isOrg":false,"type":"people","badgeV2":{"title":"","mergedBadges":[],"detailBadges":[],"icon":"","nightIcon":""}},"followers":1,"type":"column"},"commentCount":1,"contributions":[{"id":44272683,"state":"accepted","type":"first_publish","column":{"description":"","canManage":false,"intro":"","isFollowing":false,"urlToken":"c_1506624979713769473","id":"c_1506624979713769473","articlesCount":16,"acceptSubmission":false,"title":"C++杂谈","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fc_1506624979713769473","commentPermission":"all","created":1651987387,"updated":1677994781,"imageUrl":"https:\u002F\u002Fpic1.zhimg.com\u002F4b70deef7_720w.jpg?source=172ae18b","author":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpicx.zhimg.com\u002Fv2-8352ba83f5aad85676e8527f9e6abdbd.jpg?source=172ae18b","uid":"628729227072245760","userType":"people","isFollowing":false,"urlToken":"li-cong-lei-62","id":"24c099308d02ba46367d952aba6b9f77","description":"跳出舒适圈，终身学习","name":"勿忘心安","isAdvertiser":false,"headline":"游戏客户端","gender":1,"url":"\u002Fpeople\u002F24c099308d02ba46367d952aba6b9f77","avatarUrl":"https:\u002F\u002Fpicx.zhimg.com\u002Fv2-8352ba83f5aad85676e8527f9e6abdbd_l.jpg?source=172ae18b","isOrg":false,"type":"people","badgeV2":{"title":"","mergedBadges":[],"detailBadges":[],"icon":"","nightIcon":""}},"followers":1,"type":"column"}}],"isTitleImageFullScreen":false,"upvotedFollowees":[],"commercialInfo":{"isCommercial":false,"plugin":{}},"suggestEdit":{"status":false,"reason":"","tip":"","url":"","title":""},"reason":"","annotationAction":[],"canTip":true,"tipjarorsCount":0,"isLabeled":false,"hasPublishingDraft":false,"isFavorited":false,"favlistsCount":37,"isNormal":true,"status":0,"activityToppingInfo":{"state":"untopped"},"shareText":"你需要了解有关C++17中std::variant的全部信息 - 来自知乎专栏「C++杂谈」，作者: 勿忘心安 https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F607734474 （想看更多？下载 @知乎 App：http:\u002F\u002Fweibo.com\u002Fp\u002F100404711598 ）","canComment":{"status":true,"reason":""},"mcnFpShow":-1,"isVisible":true,"isLiked":false,"likedCount":3,"hasColumn":true,"republishers":[],"isNewLinkCard":true,"emojiReaction":{"likeCount":3,"likeHasSet":false},"abParam":{"qaHiddenVoteup":"1","rsInterest1":"","zpZhiStyle":"0"},"attachedInfo":"kgIkCgkyMjMxODQxMzgSCTYwNzczNDQ3NBgHIgpJTUFHRV9URVhU","shareGuide":{"hasPositiveBubble":false,"hasTimeBubble":false,"hitShareGuideCluster":false},"settings":{"tableOfContents":{"enabled":true}},"canReference":false,"reactionInstruction":{}}},"columns":{"c_1506624979713769473":{"description":"","canManage":false,"intro":"","isFollowing":false,"urlToken":"c_1506624979713769473","id":"c_1506624979713769473","articlesCount":16,"acceptSubmission":false,"title":"C++杂谈","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fc_1506624979713769473","commentPermission":"all","created":1651987387,"updated":1677994781,"imageUrl":"https:\u002F\u002Fpic1.zhimg.com\u002F4b70deef7_720w.jpg?source=172ae18b","author":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpicx.zhimg.com\u002Fv2-8352ba83f5aad85676e8527f9e6abdbd.jpg?source=172ae18b","uid":"628729227072245760","userType":"people","isFollowing":false,"urlToken":"li-cong-lei-62","id":"24c099308d02ba46367d952aba6b9f77","description":"跳出舒适圈，终身学习","name":"勿忘心安","isAdvertiser":false,"headline":"游戏客户端","gender":1,"url":"\u002Fpeople\u002F24c099308d02ba46367d952aba6b9f77","avatarUrl":"https:\u002F\u002Fpicx.zhimg.com\u002Fv2-8352ba83f5aad85676e8527f9e6abdbd_l.jpg?source=172ae18b","isOrg":false,"type":"people","badgeV2":{"title":"","mergedBadges":[],"detailBadges":[],"icon":"","nightIcon":""}},"followers":1,"type":"column"}},"topics":{},"roundtables":{},"favlists":{},"comments":{},"notifications":{},"ebooks":{},"activities":{},"feeds":{},"pins":{},"promotions":{},"drafts":{},"chats":{},"posts":{},"zvideos":{},"zvideoContributions":{},"briefs":{},"eduCourses":{}},"currentUser":"c29982ea4958b35f1d733b99ef5bf579","account":{"unlockTicketStatus":false,"unlockTicket":null,"challenge":[],"errorStatus":false,"message":"","isFetching":false,"accountInfo":{},"urlToken":{"loading":false},"cardUserInfo":{"vipInfo":{}},"handleWidget":{},"widgetList":[],"userWidgetId":""},"settings":{"socialBind":null,"inboxMsg":null,"notification":{},"email":{},"privacyFlag":null,"blockedUsers":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"blockedFollowees":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"ignoredTopics":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"restrictedTopics":null,"laboratory":{}},"notification":{},"people":{"profileStatus":{},"activitiesByUser":{},"answersByUser":{},"answersSortByVotesByUser":{},"answersIncludedByUser":{},"votedAnswersByUser":{},"thankedAnswersByUser":{},"voteAnswersByUser":{},"thankAnswersByUser":{},"topicAnswersByUser":{},"zvideosByUser":{},"articlesByUser":{},"articlesSortByVotesByUser":{},"articlesIncludedByUser":{},"pinsByUser":{},"questionsByUser":{},"commercialQuestionsByUser":{},"favlistsByUser":{},"followingByUser":{},"followersByUser":{},"mutualsByUser":{},"followingColumnsByUser":{},"followingQuestionsByUser":{},"followingFavlistsByUser":{},"followingTopicsByUser":{},"publicationsByUser":{},"columnsByUser":{},"allFavlistsByUser":{},"brands":null,"creationsByUser":{},"creationsSortByVotesByUser":{},"creationsFeed":{},"infinity":{},"batchUsers":{},"profileInfinity":null},"env":{"ab":{"config":{},"triggers":{}},"abV2":{"config":{"paramMap":{"ws_publish_post":{"value":"0"},"ws_platform_new":{"value":"1","abId":"author_platform-1"},"uw_pc_pin_pattern":{"value":"1","abId":"pc_pin_pattern-1"},"in_editor_title":{"value":"1","abId":"rl-pineditor_title-1"},"ws_publish_ask":{"value":"0"},"ws_publish_answer":{"value":"0","abId":"pc_publish_answer-0"},"pc_mou_cre_remove":{"value":"1","abId":"rl-mou_create_remove-1"}},"abMap":{"author_platform-1":{"abId":"author_platform-1","layerId":"author_platform_layer","diversionType":2},"pc_pin_pattern-1":{"abId":"pc_pin_pattern-1","layerId":"pc_pin_pattern_layer","diversionType":2},"rl-pineditor_title-1":{"abId":"rl-pineditor_title-1","layerId":"rl-pineditor_title","diversionType":2},"pc_publish_answer-0":{"abId":"pc_publish_answer-0","layerId":"pc_publish_answer_layer","diversionType":2},"rl-mou_create_remove-1":{"abId":"rl-mou_create_remove-1","layerId":"rl-mou_create_remove","diversionType":2}}},"triggers":{}},"userAgent":{"Edge":false,"IE":false,"Wechat":false,"Weibo":false,"QQ":false,"MQQBrowser":false,"Qzone":false,"Mobile":false,"Android":false,"iOS":false,"isAppleDevice":false,"Zhihu":false,"ZhihuHybrid":false,"isBot":false,"Tablet":false,"UC":false,"Quark":false,"Sogou":false,"Qihoo":false,"Baidu":false,"BaiduApp":false,"Safari":false,"GoogleBot":false,"AndroidDaily":false,"iOSDaily":false,"WxMiniProgram":false,"BaiduMiniProgram":false,"QQMiniProgram":false,"JDMiniProgram":false,"isWebView":false,"isMiniProgram":false,"origin":"Mozilla\u002F5.0 (X11; Linux x86_64) AppleWebKit\u002F537.36 (KHTML, like Gecko) Chrome\u002F114.0.0.0 Safari\u002F537.36"},"appViewConfig":{},"ctx":{"path":"\u002Fp\u002F607734474","query":{},"href":"http:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F607734474","host":"zhuanlan.zhihu.com"},"trafficSource":"production","edition":{"beijing":true,"baidu":false,"sogou":false,"baiduBeijing":false,"sogouBeijing":false,"sogouInput":false,"oppoSearch":false,"baiduSearch":false,"googleSearch":false,"shenma":false,"miniProgram":false,"xiaomi":false,"huaweiSearch":false},"theme":"light","appHeaderTheme":{"current":"normal","disable":true,"normal":{"bgColor":"GBK99A"},"custom":{"bgColor":"GBK99A"}},"enableShortcut":true,"referer":"https:\u002F\u002Fcn.bing.com\u002F","xUDId":"AIAe75fvzhSPTpeNw8WYbUTCwgHWLCTfJt8=","mode":"ssr","conf":{},"xTrafficFreeOrigin":"","ipInfo":{"cityName":"北京","countryName":"中国","regionName":"北京","countryCode":"CN"},"logged":true,"vars":{"passThroughHeaders":{}}},"me":{"columnContributions":[]},"label":{},"ecommerce":{},"comments":{"pagination":{},"collapsed":{},"reverse":{},"reviewing":{},"conversation":{},"parent":{}},"commentsV2":{"stickers":[],"commentWithPicPermission":{},"notificationsComments":{},"pagination":{},"collapsed":{},"reverse":{},"reviewing":{},"conversation":{},"conversationMore":{},"parent":{}},"pushNotifications":{"default":{"isFetching":false,"isDrained":false,"ids":[]},"follow":{"isFetching":false,"isDrained":false,"ids":[]},"vote_thank":{"isFetching":false,"isDrained":false,"ids":[]},"currentTab":"default","notificationsCount":{"default":0,"follow":0,"vote_thank":0}},"messages":{"data":{},"currentTab":"common","messageCount":0},"register":{"registerValidateSucceeded":null,"registerValidateErrors":{},"registerConfirmError":null,"sendDigitsError":null,"registerConfirmSucceeded":null},"login":{"loginUnregisteredError":false,"loginBindWechatError":false,"loginConfirmError":null,"sendDigitsError":null,"needSMSIdentify":false,"validateDigitsError":false,"loginConfirmSucceeded":null,"qrcodeLoginToken":"","qrcodeLoginScanStatus":0,"qrcodeLoginError":null,"qrcodeLoginReturnNewToken":false},"switches":{},"captcha":{"captchaNeeded":false,"captchaValidated":false},"sms":{"supportedCountries":[]},"chat":{"chats":{},"inbox":{"recents":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"strangers":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"friends":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"search":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"config":{"newCount":0,"strangerMessageSwitch":false,"strangerMessageUnread":false,"friendCount":0}},"global":{"isChatMqttExisted":false}},"emoticons":{"emoticonGroupList":[],"emoticonGroupDetail":{}},"creator":{"tools":{"question":{"invitationCount":{"questionFolloweeCount":0,"questionTotalCount":0}},"recommend":{"recommendTimes":{}}},"explore":{},"levelUpperLimit":10,"mcn":{},"mcnManage":{},"tasks":{},"announcement":{},"creatorsRecommendInfo":{}},"creators":{"common":{"applyStatus":{},"rightsStatus":{}},"bayesDomains":{"status":{},"options":{"topDomains":null,"allDomains":null,"editable":0},"contents":null},"school":{"tabs":[],"contents":[],"banner":null,"entities":{}},"faq":{"tabs":[],"article":{}},"knowledgeIncome":{},"safeguardRights":{},"analytics":{"all":{},"answer":{},"zvideo":{},"article":{},"pin":{},"singleContent":{}},"account":{"growthLevel":{}},"KMResource":{},"training":{},"ToolsQuestion":{"goodatTopics":[]},"ToolsHotspot":{"domains":[]},"ToolsRecommend":{},"ToolsCustomPromotion":{"itemLists":{},"baseInfo":{}},"ToolsSearchQuestion":{},"editorSetting":{},"MCNManage":{},"knowledgeTasks":{},"incomeAnalysis":{"income":{"aggregation":{}}},"creationManage":{"editModal":{"status":false}},"activity":{},"announcement":{},"home":{"currentCreatorUrlToken":null,"rights":[],"newRights":[],"scoreInfo":{},"menusShowControlByServer":{"bVipRecomend":false,"creationRelationship":false},"newTasks":{"creatorTask":{"tasks":[],"des":[]}},"bannerList":[],"recentlyCreated":[],"homecard":{},"homeData":{}},"videoSupport":{"textBenefit":{}},"videoDistribution":{},"profilePoster":{"creatorPosterConfig":{},"creatorPosterData":{}}},"answers":{"voters":{},"upvoters":{},"copyrightApplicants":{},"favlists":{},"newAnswer":{},"entityWords":{},"paidContent":{},"settings":{},"relationEndorsement":{}},"recommendation":{"homeRecommendations":[]},"shareTexts":{},"articles":{"voters":{},"upvoters":{},"relationEndorsement":{}},"previewPost":{},"favlists":{"relations":{}},"columns":{"voters":{}},"reward":{"answer":{},"article":{},"question":{}},"video":{"data":{},"shareVideoDetail":{},"last":{}},"topstory":{"recommend":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"follow":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"followWonderful":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"sidebar":null,"announcement":{},"hotList":[],"hotListHeadZone":[],"guestFeeds":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"followExtra":{"isNewUser":null,"isFetched":false,"followCount":0,"followers":[]},"hotDaily":{"data":[],"paging":{}},"hotHighlight":{"isFetching":false,"isDrained":false,"data":[],"paging":{}},"banner":{},"commercialBanner":{"show":false,"banner":{},"trackData":{}},"video":{"items":[],"next":null,"isLoading":false,"isDrained":false}},"readStatus":{},"column":{},"requestColumn":{"categories":[],"error":null},"articleContribution":{"contributeRequests":[],"deleteContributeIdList":[],"handledContributeIdList":[],"recommendedColumns":[],"pinnedColumns":[],"sentContributeRequestsIdList":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"c_1506624979713769473"]},"columnContribution":{"contributeRequests":[],"autoInviteEnabled":false,"recommendedContributors":[]},"draftHistory":{"history":{},"drafts":{}},"upload":{},"articleDraft":{"titleImage":"","titleImageSize":{},"isTitleImageFullScreen":false,"canTitleImageFullScreen":false,"title":"","titleImageUploading":false,"error":"","content":"","draftLoading":false,"updating":false,"globalLoading":false,"pendingVideo":{"resource":null,"error":null},"deleteFail":{"fail":false},"recommendTopics":[],"selectedColumn":0,"articleDisclaimers":[]},"articleDrafts":{"isDrained":false,"isLoading":false,"items":[]},"columnAutocomplete":{"users":[],"friends":[]},"columnCollection":{},"userProfit":{"permission":{"permissionStatus":{"zhiZixuan":0,"recommend":-1,"task":0,"plugin":0,"infinity":0},"visible":false},"linkCardLimit":0},"mcn":{"bindInfo":{},"memberCategoryList":[],"producerList":[],"categoryList":[],"lists":{},"banners":{},"protocolStatus":{"isAgreedNew":true,"isAgreedOld":true},"probationCountdownDays":0},"zvideos":{"campaignVideoList":{},"campaigns":{},"tagoreCategory":[],"recommendations":{},"insertable":{},"recruit":{"form":{"platform":"","nickname":"","followerCount":"","domain":"","contact":""},"submited":false,"ranking":[]},"qyActivityData":{},"talkActivityData":{},"party2022ActivityData":{},"batchVideos":{},"contribution":{"selectedContribution":null,"campaign":null,"configs":{},"contributionLists":{},"recommendQuestions":{"isLoading":true,"paging":{"isEnd":false,"isStart":true,"totals":0},"data":[]},"questionSearchResults":{"isLoading":true,"paging":{"isEnd":false,"isStart":true,"totals":0},"data":[]}},"creationReferences":{},"zvideoCollection":{},"zvideoGrant":{},"collectData":{"isFetching":false,"list":[]},"videoSource":{"isLoaded":false}},"republish":{},"commentPermission":{},"creatorRightStatus":{"list":[]},"adPromotion":{"answer":{},"article":{}}},"fetchHost":"www.zhihu.com","subAppName":"column","spanName":"Post","canaryConfig":{"test_canary":"0","use_new_player":"0","player_vendor":"0","use_hevc":"1","upload_use_signature":"1","use_backdrop_blur":"1","article_title_imagex":"1","play_station":"1","use_cached_supported_countries":"1"}}</script><script crossorigin="" src="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/vendor.5f3e51e68d56265eb628.js"></script><script crossorigin="" src="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/react.production.min.js"></script><script crossorigin="" src="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/react-dom.production.min.js"></script><script crossorigin="" src="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/react-dom-server.browser.production.min.js"></script><script crossorigin="" src="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/runtime.app.f9fbf4ccb36b3c1499ec.js"></script><script crossorigin="" src="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/lib-75fc9c18.app.3db651c252e14ef6658e.js"></script><script crossorigin="" src="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/lib-29107295.app.42d07f814b7b05187671.js"></script><script crossorigin="" src="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/lib-79b5cf47.app.8b6b6bf4b6d894db9b07.js"></script><script crossorigin="" src="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/lib-330004dc.app.7437cf54ac28fca0e302.js"></script><script crossorigin="" src="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/lib-0e5ce61e.app.bfc97c459473d6bbad05.js"></script><script crossorigin="" src="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/lib-83b0f42f.app.6bcd41e130a7cc845dab.js"></script><script crossorigin="" src="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/lib-38cf5c11.app.a59df9edceb3cc75ed79.js"></script><script crossorigin="" src="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/lib-2ec050f6.app.c030e52400cb9d69953d.js"></script><script crossorigin="" src="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/3978.app.50d550890c8565ff3c53.js"></script><script crossorigin="" src="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/column.app.46f951d87c5e5572bfd8.js"></script><script defer="" src="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/aria.js" id="ariascripts" wapforceoldfixed="false" loaddata="false"></script><script src="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/hm.js" async=""></script><script crossorigin="" src="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/zap.js"></script><div><div style="display: none;"><i>想来知乎工作？请发送邮件到 jobs@zhihu.com</i></div></div><script src="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/push.js"></script><div><div><div class="css-8pdeid"></div></div></div><script crossorigin="" src="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/js"></script><script crossorigin="" src="./你需要了解有关C++17中std__variant的全部信息 - 知乎_files/emoticon.js"></script><div><div><div class="Editable-languageSuggestions" style="left: -1179px; top: -999px;"><div><div class="Popover"><label class="Editable-languageSuggestionsInput Input-wrapper"><input autocomplete="off" role="combobox" aria-expanded="false" aria-autocomplete="list" aria-activedescendant="AutoComplete7-0" id="Popover6-toggle" aria-haspopup="true" aria-owns="Popover6-content" class="Input" placeholder="选择语言" value=""><svg width="24" height="24" viewBox="0 0 24 24" fill="#afbdcf" class="Zi Zi--Select"><path fill-rule="evenodd" d="M12.53 3.47a.75.75 0 0 0-1.06 0l-5 5a.75.75 0 0 0 1.06 1.06L12 5.06l4.47 4.47a.75.75 0 1 0 1.06-1.06l-5-5Zm-5 11a.75.75 0 0 0-1.06 1.06l5 5a.75.75 0 0 0 1.06 0l5-5a.75.75 0 1 0-1.06-1.06L12 18.94l-4.47-4.47Z" clip-rule="evenodd"></path></svg></label></div></div></div></div></div></body></html>